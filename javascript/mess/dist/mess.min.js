"use strict";$(document).ready(function(){$.urlParam=function(a){var b=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return b[1]||0},part_info.init(),dating_time.init(),tid&&visited.action.save(tid)});var add_contact={sync_taglist:0,init:function(){$(".add_contact").on("click",add_contact.action.add)},ajax:{add:function(a){$.post("/tag/contact/",{tag:a})}},action:{add:function(){$(".add_contact").removeClass("active"),$(this).addClass("active"),add_contact.ajax.add($(this).data("tag"))}}},added_info={init:function(){user_sex&&(!user_name||!user_age||!user_city)},onload:function(){$("#form_post_mess");$("#added_info_btn").click(function(){added_info.show()}),added_info.generate(),added_info.visible(),name_suggest.init()},generate:function(){var a=user_age?user_age:auto_gen.age(human_age),b=user_name?user_name:auto_gen.name(user_sex),c=user_city?user_city:human_city;$("#added_name").val(b),$("#added_city").val(c),$("#added_age").val(a)},visible:function(){added_info.generate(),$("#added_info_btn").show()},show:function(){$("#added_info_btn").hide("blind"),$("#added_info").show("blind")}},anketa={init:function(){$("#anketa_collaps_link").on("click",anketa.action.second_info.toggle)},action:{second_info:{toggle:function(){$("#anketa_second_info").is(":visible")?anketa.action.second_info.hide():anketa.action.second_info.show()},show:function(){$("#anketa_second_info").show("blind"),anketa.option.collaps.up()},hide:function(){$("#anketa_second_info").hide("blind"),anketa.option.collaps.down()}}},option:{collaps:{up:function(){$("#anketa_collaps_link").text("Свернуть анкету")},down:function(){$("#anketa_collaps_link").text("Развернуть анкету")}}}},confirm_block_dn={init:function(){$("#confirm_block_dn").click(function(){confirm_block_dn.hide_block()})},show_block:function(){$("#confirm_block_dn").show("blind")},hide_block:function(){$("#confirm_block_dn").hide("blind")},set_text:function(a){$("#confirm_block_dn").html(a)},show_confirm:function(a){confirm_block_dn.set_text(a),confirm_block_dn.show_block()}},dating_time={init:function(){dating_time.show(),dating_time.load()},show:function(){online<777?$("#button_videochat").show():online<5e5&&"00:00"!=dating&&($("#user_dating_time").text(dating),$("#user_dating_time_block").show())},load:function(){if(uid){$("#dating_time_post_button").on("click",dating_time.ajax.save);var a=cookie_storage.get_cookie("dating_hour");a&&$("#dating_hour :contains('"+a+"')").attr("selected","selected");var b=cookie_storage.get_cookie("dating_minut");b&&$("#dating_minut :contains('"+b+"')").attr("selected","selected")}else $("#set_dating_time input").prop("disabled",!0)},ajax:{save:function(){var a=$("#dating_hour").val().trim()+":"+$("#dating_minut").val().trim();$.get("/ajax/post_abuse.php",{dating_time:a,hash:hash},dating_time.ajax.success)},success:function(a){cookie_storage.set_cookie("dating_hour",$("#dating_hour").val(),259200),cookie_storage.set_cookie("dating_minut",$("#dating_minut").val(),259200),$("#saved_dating").show("fade"),$("#saved_dating").delay(2e3).hide("fade")}}},edit_cont={init:function(){$("#edit_cont_btn").click(function(){edit_cont.show()}),$("#edit_human_btn").click(function(){edit_cont.save()})},show:function(){var a=human_name?human_name:auto_gen.name(human_sex);$("#human_print_name").text().search(/(Парень|Девушка)/)<0&&(a=$("#human_print_name").text()),$("#edit_human_name").val(a),$("human_data_block").is("#edit_cont_elem")||$("#human_data_block").append($("#edit_cont_elem")),$("#edit_cont_elem").toggle("blind"),$("#human_data_print").toggle("blind")},save:function(){human_name=$("#edit_human_name").val(),edit_cont.update(),edit_cont.show(),edit_cont.send()},send:function(){$.post("/contact/extra/",{tid:tid,age:"",name:human_name,city:""})},update:function(){$("#human_print_name").text(human_name)}},FormMess=new Vue({el:"#message_post_form",store:store,data:{message:"",reply:"",code:"",show:!0,process:!1,approve:!0,dirt:!1,tid:null},mounted:function(){var a=this;this.tid=tid,$("#mess-text-area").on("keypress",function(b,c){!b.ctrlKey||10!=b.keyCode&&13!=b.keyCode||a.sendMessage()})},watch:{message:function(){this.isDirt()}},computed:Vuex.mapState({config:function(a){return a.formMess},photo:function(a){return a.formMess.sendPhoto},intimate:function(a){return a.formMess.intimate},user:function(a){return a.user}}),methods:{reset:function(){this.cancelPhoto(),this.show=!0,this.process=!1,this.approve=!0,this.message=""},isDirt:_.debounce(function(){var a=/\w{0,5}[хx]([хx\s\!@#\$%\^&*+-\|\/]{0,6})[уy]([уy\s\!@#\$%\^&*+-\|\/]{0,6})[ёiлeеюийя]\w{0,7}|\w{0,6}[пp]([пp\s\!@#\$%\^&*+-\|\/]{0,6})[iие]([iие\s\!@#\$%\^&*+-\|\/]{0,6})[3зс]([3зс\s\!@#\$%\^&*+-\|\/]{0,6})[дd]\w{0,10}|[сcs][уy]([уy\!@#\$%\^&*+-\|\/]{0,6})[4чkк]\w{1,3}|\w{0,4}[bб]([bб\s\!@#\$%\^&*+-\|\/]{0,6})[lл]([lл\s\!@#\$%\^&*+-\|\/]{0,6})[yя]\w{0,10}|\w{0,8}[её][bб][лске@eыиаa][наи@йвл]\w{0,8}|\w{0,4}[еe]([еe\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[uу]([uу\s\!@#\$%\^&*+-\|\/]{0,6})[н4ч]\w{0,4}|\w{0,4}[еeё]([еeё\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[нn]([нn\s\!@#\$%\^&*+-\|\/]{0,6})[уy]\w{0,4}|\w{0,4}[еe]([еe\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[оoаa@]([оoаa@\s\!@#\$%\^&*+-\|\/]{0,6})[тnнt]\w{0,4}|\w{0,10}[ё]([ё\!@#\$%\^&*+-\|\/]{0,6})[б]\w{0,6}|\w{0,4}[pп]([pп\s\!@#\$%\^&*+-\|\/]{0,6})[иeеi]([иeеi\s\!@#\$%\^&*+-\|\/]{0,6})[дd]([дd\s\!@#\$%\^&*+-\|\/]{0,6})[oоаa@еeиi]([oоаa@еeиi\s\!@#\$%\^&*+-\|\/]{0,6})[рr]\w{0,12}/i;return this.dirt=!!a.test(this.message),this.dirt},700),upload:function(){store.commit("optionDialog","upload")},cancelPhoto:function(){store.commit("sendPhoto",{photo:null,alias:null})},send:function(){this.photo.alias?sendPhoto():sendMessage()},sendPhoto:function(){},sendMessage:function(){var a=this,b={id:this.tid,captcha_code:this.code};this.photo.alias?b.photo=this.photo.alias:(b.mess=this.message,b.re=this.reply),api.messages.send(b).then(function(b){a.onMessageSend(b.data)}),this.process=!0},sendSex:function(a){var b=this;this.$store.dispatch("SAVE_SEX",a).then(function(a){b.sendMessage()}).catch(function(a){b.onError(a)}),this.process=!0},onMessageSend:function(a){!a.saved&&a.error?("need_captcha"==a.error&&this.captcha(),this.onError()):this.sended(a),this.process=!1},sended:function(a){MessList.reload(),$("#mess_shab_text_block").hide(),giper_chat.timer_cut(),this.reset()},captcha:function(){$(".form-message__captcha-img").get(0).src="/secret_pic.php?hash="+hash,this.approve=!1},onError:function(){this.process=!1}}}),form_mess={show_form:function(){$("#message_post_form").show("blind")},hide_form:function(){$("#message_post_form").hide("blind")}},incoming_photo=new Vue({el:"#incoming-photo",store:store,data:{photos:[],user:0,server:null},created:function(){this.server=this.$store.state.photoServer},methods:{loadPhoto:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{tid:tid,hash:hash}};axios.get("http://"+this.server+"/api/v1/users/"+uid+"/sends",b).then(function(b){a.photos=b.data.photos}).catch(function(a){console.log(a)})},show:function(a){var b=this.photos[a],c=b._links;if(c.origin.href){var d={thumb:c.thumb.href,photo:c.origin.href,alias:b.alias,height:b.height,width:b.width};store.commit("viewPhoto",d),store.commit("optionDialog","photo")}}}});$(document).ready(function(){incoming_photo.loadPhoto()});var moderator={init:function(){$("#moder_button").click(function(){moderator.ajax_auth(),$("#moder_block").show("fade")}),$("#moder_block_close").click(function(){moderator.close_block()})},ajax_auth:function(){disabled_with_timeout($(".bun_btn_all"),5),$.post("/moder/auth/",moderator.auth_resp)},ajax_promt:function(){disabled_with_timeout($(".bun_btn_all"),5),$.post("/moder/promt/",moderator.auth_resp)},ajax_press:function(a,b,c,d){disabled_with_timeout($(".bun_btn_all"),5),$.post("/moder/press/",{id:a,secure:b,expire:c,mark:d},moderator.auth_resp)},auth_resp:function(a){a&&($("#moder_block_inner").empty(),$("#moder_block_inner").html(a),moderator.new_sett(),disabled_with_timeout($(".bun_btn_all"),.1))},close_block:function(){$("#moder_block").hide("fade")},new_sett:function(a){$("#moder_agree").click(function(){moderator.ajax_promt()}),$("#moder_close").click(function(){moderator.close_block()});var b=$("#bun_mess_id").val(),c=$("#bun_mess_secure").val(),d=$("#bun_mess_expire").val();$("#bun_ys").click(function(){moderator.ajax_press(b,c,d,1)}),$("#bun_no").click(function(){moderator.ajax_press(b,c,d,-1)}),$("#bun_ig").click(function(){moderator.ajax_press(b,c,d,0)}),$("#bun_next").click(function(){moderator.ajax_press(0,c,d,0)})}},notice_post={show:function(){$("#notice_post").text().trim().length>5&&$("#notice_post").show("clip")},alert:function(){$("#notice_post").toggleClass("notice_post notice_alert")}},part_info={init:function(){$("#part_tip_block").data("name")&&part_info.reset()},reset:function(){$("#part_tip_close").click(function(){return part_info.close(),!1}),$("#part_tip_block form").submit(function(){return part_info.close(),!1})},close:function(){$("#form_post_mess");$("#part_tip_block").hide("blind");var a=$("#part_tip_block").data("name");$.post("/user/closetip/",{tip:a})}},quick_photo={init:function(){quick_photo.ajax.load()},ajax:{load:function(){},success:function(a){a.indexOf("div")>0&&($("#micro_images_hint").html(a),$(".img_list_micro").click(function(){location.href="/mail.php?photo="+$(this).attr("alt")+"&id="+tid}),$("#send_photo_link").mouseover(function(){$("#micro_images_block").show("fade")}),$(document).mouseup(function(a){var b=$("#micro_images_block");b.is(a.target)||0!==b.has(a.target).length||b.hide("fade")}))}}};