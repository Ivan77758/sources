"use strict";$(document).ready(function(){$.urlParam=function(a){var b=new RegExp("[\\?&]"+a+"=([^&#]*)").exec(window.location.href);return b[1]||0},cont_list.init(),lock_user.init(),confirm_block_dn.init(),moderator.init(),edit_cont.init(),added_info.init(),part_info.init(),quick_photo.init(),quick_mess.init(),mess_sett.init(),dating_time.init(),anketa.init(),add_contact.init(),tid&&visited.action.save(tid)}),Vue.http.options.emulateJSON=!0,Vue.component("abuse-form",{template:"#abuse-form",props:["show"],data:function(){return{disabled:!1,isEditorShow:0,isSuggestShow:1,suggest:["Предложение оплаты услуг, вирт за деньги, проституция","Мошенничество, развод на деньги, шантаж, вымогательство","Фото из интернета, вымышленные данные, обман, фейк","Оскорбления, хамство, троллинг, грубые сообщения","Рассылает интим фото, спамит или провоцирует"],text:""}},created:function(){},methods:{choiceText:function(a){this.text=a.target.innerHTML,this.isEditorShow=!0,this.isSuggestShow=!1},post:function(a){simple_hash(),disabled_with_timeout($(".abuse-form__btn"),10),this.$http.post("/abuse/send",{id:tid,text:this.text,captcha:"",hash:hash}).then(function(a){this.response(a.body)})},cancel:function(){this.$emit("cancel"),this.isSuggestShow=!0},response:function(a){if(console.log(a),disabled_with_timeout($(".abuse-form__btn"),.1),!a)return 0;var b=json.parse(a);b.saved?this.success(b.text):confirm_block_dn.show_confirm(b.text)},success:function(a){console.log("ok"),confirm_block_dn.show_confirm(a),this.cancel()}}});var abuse_list=new Vue({el:"#abuse-list-component",data:{abuseStatus:0,isFormShow:0,isListShow:0,isButtonShow:0},mounted:function(){},methods:{showForm:function(a){this.isFormShow?this.hideForm():this.isFormShow=!0,this.isButtonShow=!1},hideForm:function(a){this.isFormShow=!1,this.isButtonShow=!1},showList:function(a){this.isListShow=!this.isListShow},showButton:function(){this.isFormShow||(this.isButtonShow=!0)}}}),add_contact={sync_taglist:0,init:function(){$(".add_contact").on("click",add_contact.action.add)},ajax:{add:function(a){$.post("/tag/contact/",{tag:a})}},action:{add:function(){$(".add_contact").removeClass("active"),$(this).addClass("active"),add_contact.ajax.add($(this).data("tag"))}}},added_info={init:function(){user_sex&&(!user_name||!user_age||!user_city)},onload:function(){$("#form_post_mess");$("#added_info_btn").click(function(){added_info.show()}),added_info.generate(),added_info.visible(),name_suggest.init()},generate:function(){var a=user_age?user_age:auto_gen.age(human_age),b=user_name?user_name:auto_gen.name(user_sex),c=user_city?user_city:human_city;$("#added_name").val(b),$("#added_city").val(c),$("#added_age").val(a)},visible:function(){added_info.generate(),$("#added_info_btn").show()},show:function(){$("#added_info_btn").hide("blind"),$("#added_info").show("blind")}},anketa={init:function(){$("#anketa_collaps_link").on("click",anketa.action.second_info.toggle)},action:{second_info:{toggle:function(){$("#anketa_second_info").is(":visible")?anketa.action.second_info.hide():anketa.action.second_info.show()},show:function(){$("#anketa_second_info").show("blind"),anketa.option.collaps.up()},hide:function(){$("#anketa_second_info").hide("blind"),anketa.option.collaps.down()}}},option:{collaps:{up:function(){$("#anketa_collaps_link").text("Свернуть анкету")},down:function(){$("#anketa_collaps_link").text("Развернуть анкету")}}}},confirm_block_dn={init:function(){$("#confirm_block_dn").click(function(){confirm_block_dn.hide_block()})},show_block:function(){$("#confirm_block_dn").show("blind")},hide_block:function(){$("#confirm_block_dn").hide("blind")},set_text:function(a){$("#confirm_block_dn").html(a)},show_confirm:function(a){confirm_block_dn.set_text(a),confirm_block_dn.show_block()}},cont_list={acttab:"inline",count:0,clear:1,inlist:0,buffer:[],init:function(){$("#contact_update").on("click",cont_list.action.update),$("#list_load_next").on("click",cont_list.action.next),$("#list_show_optn").on("click",cont_list.option.delets.show),$("#list_load_inline").on("click",cont_list.action.tab.inline),$("#list_load_online").on("click",cont_list.action.tab.online),$("#list_load_faline").on("click",cont_list.action.tab.faline),$("#list_load_deline").on("click",cont_list.action.tab.deline),cont_list.ajax.load()},ajax:{load:function(){simple_hash(),setTimeout(function(){$.get("/contact/list/"+cont_list.acttab+"/",{inlist:cont_list.count,hash:hash},cont_list.ajax.success).fail(cont_list.ajax.error)},2e3)},success:function(a){var b=[];a&&(b=JSON.parse(a)),cont_list.inlist=$("#list_contact_block .message_listbox_link").length,cont_list.clear&&cont_list.action.clear(),cont_list.count?($.each(cont_list.buffer,cont_list.action.new_line),cont_list.buffer.length=0,b.length&&$.each(b,cont_list.action.buff_cont)):$.each(b,cont_list.action.new_line),cont_list.count=$("#list_contact_block .message_listbox_link").length,cont_list.count>2&&$("#tip_list_users_block").hide("blind"),cookie_storage.set_cookie("list_count",cont_list.count,259200),cont_list.action.show(),cont_list.clear=1},error:function(){setTimeout(cont_list.ajax.load,7e3)},del_user:function(a){$.post("/human/delete/",{tid:a})},rec_user:function(a){$.post("/human/unlock/",{tid:a})},favorite:function(a){$.post("/human/favorite/",{tid:a})},general:function(a){$.post("/human/general/",{tid:a})}},action:{show:function(){$("#list_contact_block").show("blind")},favorite:function(a){1*$("#listbox_line_"+a).data("fav")?(cont_list.option.favorite.passive(a),cont_list.ajax.general(a)):(cont_list.option.favorite.active(a),cont_list.ajax.favorite(a))},delete_user:function(a){$("#listbox_line_"+a+" .message_listbox_link").hide("blind"),$("#listbox_line_"+a+" .listbox_recover").show("blind"),cont_list.option.updater.show(),cont_list.ajax.del_user(a)},recover_user:function(a){$("#listbox_line_"+a+" .message_listbox_link").show("blind"),$("#listbox_line_"+a+" .listbox_recover").hide("blind"),cont_list.ajax.rec_user(a)},clear:function(){$("#list_contact_block").empty(),cont_list.buffer.length=0},update:function(){cont_list.count=0,cont_list.ajax.load(),cont_list.option.refresh()},next:function(){cont_list.clear=0,cont_list.ajax.load(),cont_list.option.refresh()},buff_cont:function(a,b){cont_list.buffer.push(b)},new_line:function(a,b){if(a>=5)return cont_list.action.buff_cont(a,b),0;var c=$("#listbox_line_ex").clone().attr("id","listbox_line_"+b.cont_id).click(function(){location.href="/"+b.cont_id}).data("num",b.cont_id).data("fav",b.favorite).appendTo("#list_contact_block");$(".icon_list",c).addClass(b.style),$(".user_name",c).text(b.name),$(".cont_list_fav_user",c).click(function(){return cont_list.action.favorite(b.cont_id),!1}),$(".cont_list_del_user",c).click(function(){return cont_list.action.delete_user(b.cont_id),!1}),$(".listbox_recover",c).click(function(){return cont_list.action.recover_user(b.cont_id),!1}),"deline"==cont_list.acttab&&($(".cont_list_fav_user",c).remove(),$(".cont_list_del_user",c).remove()),1*b.favorite&&cont_list.option.favorite.active(b.cont_id),cont_list.option.updater.hide(),b.photo&&($("img",c).get(0).src=b.photo,$("img",c).show("fade")),1*b.unread&&$(".unread_count",c).text("("+b.unread+")")},tab:{show:function(a){a!=cont_list.acttab&&(cont_list.acttab=a,cont_list.count=0,cont_list.ajax.load()),cont_list.option.refresh(),cont_list.action.tab.active()},active:function(){$(".listbox_tab").removeClass("active"),$("#list_load_"+cont_list.acttab).addClass("active")},inline:function(){cont_list.action.tab.show("inline")},faline:function(){cont_list.action.tab.show("faline")},deline:function(){cont_list.action.tab.show("deline")},addition:function(){}}},option:{refresh:function(){cont_list.option.updater.hide(),cont_list.option.delets.hide(),cont_list.option.favorite.show()},updater:{show:function(){$("#contact_update").show("fade")},hide:function(){$("#contact_update").hide("fade")}},delets:{show:function(){$(".cont_list_del_user").toggle("fade"),$(".cont_list_fav_user").toggle("fade")},hide:function(){$(".cont_list_del_user.touch_option").hide("fade")}},favorite:{active:function(a){$("#listbox_line_"+a+" .cont_list_fav_user i").addClass("favorite"),$("#listbox_line_"+a).data("fav",1)},passive:function(a){$("#listbox_line_"+a+" .cont_list_fav_user i").removeClass("favorite"),$("#listbox_line_"+a).data("fav",0)},show:function(){$(".cont_list_fav_user").show("fade")},hide:function(){$(".cont_list_fav_user").hide("fade")}}}},ContactSection=new Vue({methods:{openInit:function(){store.commit("showInitial",1)},openIntim:function(){console.log(111),store.commit("showIntimate",1)},openSends:function(){store.commit("showSends",1)}},store:store,el:"#contact-section"}),dating_time={init:function(){dating_time.show(),dating_time.load()},show:function(){online<777?$("#button_videochat").show():online<5e5&&"00:00"!=dating&&($("#user_dating_time").text(dating),$("#user_dating_time_block").show())},load:function(){if(uid){$("#dating_time_post_button").on("click",dating_time.ajax.save);var a=cookie_storage.get_cookie("dating_hour");a&&$("#dating_hour :contains('"+a+"')").attr("selected","selected");var b=cookie_storage.get_cookie("dating_minut");b&&$("#dating_minut :contains('"+b+"')").attr("selected","selected")}else $("#set_dating_time input").prop("disabled",!0)},ajax:{save:function(){var a=$("#dating_hour").val().trim()+":"+$("#dating_minut").val().trim();$.get("/ajax/post_abuse.php",{dating_time:a,hash:hash},dating_time.ajax.success)},success:function(a){cookie_storage.set_cookie("dating_hour",$("#dating_hour").val(),259200),cookie_storage.set_cookie("dating_minut",$("#dating_minut").val(),259200),$("#saved_dating").show("fade"),$("#saved_dating").delay(2e3).hide("fade")}}},edit_cont={init:function(){$("#edit_cont_btn").click(function(){edit_cont.show()}),$("#edit_human_btn").click(function(){edit_cont.save()})},show:function(){var a=human_name?human_name:auto_gen.name(human_sex);$("#human_print_name").text().search(/(Парень|Девушка)/)<0&&(a=$("#human_print_name").text()),$("#edit_human_name").val(a),$("human_data_block").is("#edit_cont_elem")||$("#human_data_block").append($("#edit_cont_elem")),$("#edit_cont_elem").toggle("blind"),$("#human_data_print").toggle("blind")},save:function(){human_name=$("#edit_human_name").val(),edit_cont.update(),edit_cont.show(),edit_cont.send()},send:function(){$.post("/contact/extra/",{tid:tid,age:"",name:human_name,city:""}),cont_list.option.updater.show()},update:function(){$("#human_print_name").text(human_name)}},FormMess=new Vue({el:"#message_post_form",store:store,data:{message:"",reply:"",code:"",show:!0,process:!1,approve:!0,dirt:!1,tid:null},mounted:function(){var a=this;this.tid=tid,$("#mess-text-area").on("keypress",function(b,c){!b.ctrlKey||10!=b.keyCode&&13!=b.keyCode||a.sendMessage()})},watch:{message:function(){this.isDirt()}},computed:Vuex.mapState({config:function(a){return a.formMess},photo:function(a){return a.formMess.sendPhoto},intimate:function(a){return a.formMess.intimate},user:function(a){return a.user}}),methods:{reset:function(){this.cancelPhoto(),this.show=!0,this.process=!1,this.approve=!0,this.message=""},isDirt:_.debounce(function(){var a=/\w{0,5}[хx]([хx\s\!@#\$%\^&*+-\|\/]{0,6})[уy]([уy\s\!@#\$%\^&*+-\|\/]{0,6})[ёiлeеюийя]\w{0,7}|\w{0,6}[пp]([пp\s\!@#\$%\^&*+-\|\/]{0,6})[iие]([iие\s\!@#\$%\^&*+-\|\/]{0,6})[3зс]([3зс\s\!@#\$%\^&*+-\|\/]{0,6})[дd]\w{0,10}|[сcs][уy]([уy\!@#\$%\^&*+-\|\/]{0,6})[4чkк]\w{1,3}|\w{0,4}[bб]([bб\s\!@#\$%\^&*+-\|\/]{0,6})[lл]([lл\s\!@#\$%\^&*+-\|\/]{0,6})[yя]\w{0,10}|\w{0,8}[её][bб][лске@eыиаa][наи@йвл]\w{0,8}|\w{0,4}[еe]([еe\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[uу]([uу\s\!@#\$%\^&*+-\|\/]{0,6})[н4ч]\w{0,4}|\w{0,4}[еeё]([еeё\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[нn]([нn\s\!@#\$%\^&*+-\|\/]{0,6})[уy]\w{0,4}|\w{0,4}[еe]([еe\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[оoаa@]([оoаa@\s\!@#\$%\^&*+-\|\/]{0,6})[тnнt]\w{0,4}|\w{0,10}[ё]([ё\!@#\$%\^&*+-\|\/]{0,6})[б]\w{0,6}|\w{0,4}[pп]([pп\s\!@#\$%\^&*+-\|\/]{0,6})[иeеi]([иeеi\s\!@#\$%\^&*+-\|\/]{0,6})[дd]([дd\s\!@#\$%\^&*+-\|\/]{0,6})[oоаa@еeиi]([oоаa@еeиi\s\!@#\$%\^&*+-\|\/]{0,6})[рr]\w{0,12}/i;return this.dirt=!!a.test(this.message),this.dirt},700),upload:function(){store.commit("optionDialog","upload")},cancelPhoto:function(){store.commit("sendPhoto",{photo:null,alias:null})},send:function(){this.photo.alias?sendPhoto():sendMessage()},sendPhoto:function(){},sendMessage:function(){var a=this,b={id:this.tid,captcha_code:this.code};this.photo.alias?b.photo=this.photo.alias:(b.mess=this.message,b.re=this.reply),api.messages.send(b).then(function(b){a.onMessageSend(b.data)}),this.process=!0},sendSex:function(a){var b=this;this.$store.dispatch("SAVE_SEX",a).then(function(a){b.sendMessage()}).catch(function(a){b.onError(a)}),this.process=!0},onMessageSend:function(a){!a.saved&&a.error?("need_captcha"==a.error&&this.captcha(),this.onError()):this.sended(a),this.process=!1},sended:function(a){MessList.reload(),$("#mess_shab_text_block").hide(),giper_chat.timer_cut(),this.reset()},captcha:function(){$(".form-message__captcha-img").get(0).src="/secret_pic.php?hash="+hash,this.approve=!1},onError:function(){this.process=!1}}}),form_mess={show_form:function(){$("#message_post_form").show("blind")},hide_form:function(){$("#message_post_form").hide("blind")}},incoming_photo=new Vue({el:"#incoming-photo",store:store,data:{photos:[],user:0,server:null},created:function(){this.server=this.$store.state.photoServer},methods:{loadPhoto:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{tid:tid,hash:hash}};axios.get("http://"+this.server+"/api/v1/users/"+uid+"/sends",b).then(function(b){a.photos=b.data.photos}).catch(function(a){console.log(a)})},show:function(a){var b=this.photos[a],c=b._links;if(c.origin.href){var d={thumb:c.thumb.href,photo:c.origin.href,alias:b.alias,height:b.height,width:b.width};store.commit("viewPhoto",d),store.commit("optionDialog","photo")}}}});$(document).ready(function(){incoming_photo.loadPhoto()});var lock_user={init:function(){lock_user.set_lock(),$("#unlock_inform_block").click(function(){$(this).hide("blind")})},set_lock:function(){$("#lock_user_link").unbind("click"),$("#lock_user_link").click(function(){lock_user.post_lock()}),lock_user.red_link(0),MessList.attention=!1,lock_user.link_text("Заблокировать")},set_unlock:function(){$("#lock_user_link").unbind("click"),$("#lock_user_link").click(function(){lock_user.post_unlock()}),lock_user.red_link(1),MessList.attention=!0,lock_user.link_text("Разблокировать")},show_link:function(){$("#lock_user_link").show("fade")},hide_link:function(){$("#lock_user_link").hide("fade")},ajax_send:function(a){simple_hash();var b=a?"lock":"unlock";$.post("/human/"+b+"/",{tid:tid,hash:hash})},post_lock:function(){lock_user.inform_lock(),lock_user.set_unlock(),lock_user.ajax_send(1)},post_unlock:function(){lock_user.inform_unlock(),lock_user.set_lock(),lock_user.ajax_send(0)},red_link:function(a){a?$("#lock_user_link").addClass("red_link"):$("#lock_user_link").removeClass("red_link")},link_text:function(a){$("#lock_user_link").text(a)},inform_lock:function(){$("#unlock_inform_block").hide("blind"),$("#lock_inform_block").show("blind")},inform_unlock:function(){$("#lock_inform_block").hide("blind"),$("#unlock_inform_block").show("blind")}},MessList=new Vue({el:"#user-dialog",store:store,data:{messages:[],response:null,error:0,next:0,newCount:0,batch:15,received:0,attention:!1,uid:null,tid:null,date:null,toSlow:!1},mounted:function(){this.tid=tid,this.load()},methods:{reload:function(){this.next=0,this.newCount=0,this.messages=[],this.load(),fdate=null,prev=null},load:function(){var a=this;this.response=0;var b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{id:this.tid,next:this.next,hash:hash}};axios.get("/ajax/messages_load.php",b).then(function(b){a.onLoad(b)}).catch(function(b){a.error=10,console.log(b)}),setTimeout(function(){return a.toSlow=!0},7e3)},onLoad:function(a){var b=a.data.messages;this.received=b?b.length:0,b||this.messages.length?(this.received&&(this.messages=_.union(this.messages,b)),lock_user.show_link(),this.next+=this.batch):this.noMessages(),this.response=200,this.toSlow=!1},noMessages:function(){quick_mess.ajax_load(),notice_post.show(),store.commit("intimated",!1)},setDate:function(a){},remove:function(a){console.log("remove("+a+")"),this.messages.splice(a,1)},admit:function(){console.log("itOk false"),this.attention=!1},setNew:function(){console.log("new"),this.newCount+=1}},computed:{more:function(){return!(!this.received||this.received!=this.batch)},uid:function(){return(void 0).store.user.uid}}}),mess_sett={init:function(){$("#post_mail_setting").on("click",mess_sett.ajax_post),mess_sett.print(cookie_storage.get_data("mail_sett")),$("#mail_setting_hide").on("click",mess_sett.hide),$("#mail_setting_show").on("click",mess_sett.show)},print:function(a){a.who?$("#opt_who").val(a.who):$("#opt_who").val(0),1*a.town&&$("#opt_town").attr("checked","checked"),1*a.virt&&$("#opt_virt").attr("checked","checked"),a.up>0&&$("#opt_up").val(a.up),a.to>0&&$("#opt_to").val(a.to)},show:function(){$("#form_mail_setting").show("blind"),$("#mail_setting_show").hide("fade"),cookie_storage.del_cookie("hide_mail_setting")},hide:function(){$("#form_mail_setting").hide("blind"),$("#mail_setting_show").show("fade"),cookie_storage.set_cookie("hide_mail_setting",1,259200)},on_save:function(){$("#saved_setting").show("fade"),$("#saved_setting").delay(2e3).hide("fade")},ajax_post:function(){var a=$("#form_mail_setting").serialize();return $.post("/msett/save/",a),mess_sett.on_save(),!1}},moderator={init:function(){$("#moder_button").click(function(){moderator.ajax_auth(),$("#moder_block").show("fade")}),$("#moder_block_close").click(function(){moderator.close_block()})},ajax_auth:function(){disabled_with_timeout($(".bun_btn_all"),5),$.post("/moder/auth/",moderator.auth_resp)},ajax_promt:function(){disabled_with_timeout($(".bun_btn_all"),5),$.post("/moder/promt/",moderator.auth_resp)},ajax_press:function(a,b,c,d){disabled_with_timeout($(".bun_btn_all"),5),$.post("/moder/press/",{id:a,secure:b,expire:c,mark:d},moderator.auth_resp)},auth_resp:function(a){a&&($("#moder_block_inner").empty(),$("#moder_block_inner").html(a),moderator.new_sett(),disabled_with_timeout($(".bun_btn_all"),.1))},close_block:function(){$("#moder_block").hide("fade")},new_sett:function(a){$("#moder_agree").click(function(){moderator.ajax_promt()}),$("#moder_close").click(function(){moderator.close_block()});var b=$("#bun_mess_id").val(),c=$("#bun_mess_secure").val(),d=$("#bun_mess_expire").val();$("#bun_ys").click(function(){moderator.ajax_press(b,c,d,1)}),$("#bun_no").click(function(){moderator.ajax_press(b,c,d,-1)}),$("#bun_ig").click(function(){moderator.ajax_press(b,c,d,0)}),$("#bun_next").click(function(){moderator.ajax_press(0,c,d,0)})}},notice_post={show:function(){$("#notice_post").text().trim().length>5&&$("#notice_post").show("clip")},alert:function(){$("#notice_post").toggleClass("notice_post notice_alert")}},part_info={init:function(){$("#part_tip_block").data("name")&&part_info.reset()},reset:function(){$("#part_tip_close").click(function(){return part_info.close(),!1}),$("#part_tip_block form").submit(function(){return part_info.close(),!1})},close:function(){$("#form_post_mess");$("#part_tip_block").hide("blind");var a=$("#part_tip_block").data("name");$.post("/user/closetip/",{tip:a})}},quick_mess={tab:"public",more:0,init:function(){$(".quick_mess_tab").on("click",quick_mess.tabs_link),$("#mess_shab_more").on("click",quick_mess.more_link)},show:function(a){var b=a?$(".message_list_save","#message_block_"+a):$(".message_list_save");b.show("fade",100)},tabs_link:function(){quick_mess.more=0,quick_mess.tab=$(this).data("tab"),quick_mess.ajax_load()},more_link:function(){if(quick_mess.more++,quick_mess.ajax_load(),quick_mess.more>=2)return $("#mess_shab_more").hide(),!1},ajax_load:function(){$("#mess_shab_more").show("fade");var a="/ajax/html/mess_link_shab_text_"+quick_mess.tab+quick_mess.more+".htm";$.get(a,quick_mess.on_load)},print:function(){var a=$(this).text().trim();$("#mess-text-area").val(a),FormMess.message=a},on_load:function(a){quick_mess.more||$("#mess_shab_wrap").empty(),$(a).filter(".link_shab_text").on("click",quick_mess.print).appendTo("#mess_shab_wrap"),$("#mess_shab_text_block").show("fade")}},quick_photo={init:function(){quick_photo.ajax.load()},ajax:{load:function(){},success:function(a){a.indexOf("div")>0&&($("#micro_images_hint").html(a),$(".img_list_micro").click(function(){location.href="/mail.php?photo="+$(this).attr("alt")+"&id="+tid}),$("#send_photo_link").mouseover(function(){$("#micro_images_block").show("fade")}),$(document).mouseup(function(a){var b=$("#micro_images_block");b.is(a.target)||0!==b.has(a.target).length||b.hide("fade")}))}}};