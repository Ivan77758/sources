"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function simple_hash(){var a=new Date;hash=a.getTime()}function disabled_with_timeout(a,b){a.prop("disabled",!0),setTimeout(function(){a.prop("disabled",!1)},1e3*b)}function get_cookie(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");return b?unescape(b[2]):null}function del_cookie(a){var b=new Date;b.setTime(b.getTime()-1e3),document.cookie=a+"=; expires="+b.toGMTString()+"; path=/"}function set_cookie(a,b,c){var d=new Date;d.setTime(d.getTime()+6e4*c),document.cookie=a+"="+b+"; expires="+d.toGMTString()+"; path=/"}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();$(document).ready(function(){userinfo.init(),slider.init(),storage.init(),giper_chat.init(),notepad.init(),mailsett.init(),report.init(),navigate.init(),name_suggest.init(),city_suggest.init(),option_static.init(),option_sex.init(),option_email.init(),profile_alert.init(),profile_option.init(),user_tag.init(),desire_clip.init(),result_list.init(),visited.init()}),moment.locale("ru");var ls=lscache,Api=function a(b,c){_classCallCheck(this,a),this.root=b+"/",this.key=c,this.config={baseURL:this.root,headers:{Authorization:"Bearer "+c}}},ApiMessages=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"send",value:function(a,b,c){console.log(this),axios.post("mailer/post/",a,this.config).then(function(a){b(a.data)}).catch(function(a){console.log(a)}),console.log("ApiMessages send !!!")}}]),b}(Api),ApiUser=function(a){function b(){return _classCallCheck(this,b),_possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return _inherits(b,a),_createClass(b,[{key:"saveSex",value:function(a,b,c){axios.post("/option/sex/",a,this.config).then(function(a){a.data.sex&&(store.commit("loadUser",{sex:a.data.sex}),b())}).catch(function(a){console.log(a),c()})}}]),b}(Api),apiMessages=new ApiMessages("",1234),apiUser=new ApiUser("",1234),store=new Vuex.Store({state:{apiToken:"",photoServer:"195.154.54.70",count:0,optionStatic:{view:null},photoView:{thumb:null,photo:null,height:null},uploadView:{show:!1},contactView:{show:!1},formMess:{sendTo:null,sendPhoto:{thumb:null,photo:null,height:null,width:null},intimate:!0},accepts:{photo:!1},user:{uid:0,sex:0}},actions:{LOAD_USER:function(a){var b=a.commit;b("loadUser",{sex:user_sex,uid:uid})},LOAD_API_TOKEN:function(a){var b=a.commit;b("setApiToken",{apiToken:get_cookie("jwt")})},LOAD_ACCEPTS:function(a){var b=a.commit,c=ls.get("accepts");c&&c.photo&&b("approveViewPhoto")}},mutations:{loadUser:function(a,b){_.extend(a.user,b)},setApiToken:function(a,b){b&&_.extend(a,b)},viewPhoto:function(a,b){_.extend(a.photoView,b)},viewUpload:function(a,b){a.uploadView.show=b===!0},sendPhoto:function(a,b){_.extend(a.formMess.sendPhoto,b)},approveViewPhoto:function(a){a.accepts.photo=!0,ls.set("accepts",_.extend(a.accepts,{photo:!0}))},intimated:function(a,b){a.formMess.intimate=b===!0},optionDialog:function(a,b){a.optionStatic.view=b?b:null}},getters:{accept:function(){}}});store.dispatch("LOAD_API_TOKEN"),store.dispatch("LOAD_ACCEPTS"),store.dispatch("LOAD_USER");var hash,auto_gen={name:function a(b){var a=[];a[0]=["Онилиона","Безимени","Неуказано","Хуисзиз","Незнаю","Неизвестно","Несонено"],a[1]=["Саша","Дима","Сергей","Иван","Максим","Валера","Николай"],a[2]=["Оля","Юля","Настя","Алена","Катя","Маргарита","Татьяна"];var c=Math.floor(7*Math.random());return a[b][c]},age:function a(b){var a=[];a[0]=[18,21,24,25,27,28,31],a[1]=[b+3,b+2,b+1,b,b-1,b-2,b-3];var c=b?1:0,d=Math.floor(7*Math.random());return a[c][d]}},cookie_storage={enabled:0,init:function(){},get_cookie:function(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");return b?unescape(b[2]):null},del_cookie:function(a){var b=new Date;b.setTime(b.getTime()-1e3),document.cookie=a+"=; expires="+b.toGMTString()+"; path=/"},set_cookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+6e4*c),document.cookie=a+"="+b+"; expires="+d.toGMTString()+"; path=/"},get_data:function(a){var b=get_cookie(a),c=null;if(b)try{c=JSON.parse(b)}catch(a){}return c},set_data:function(){}},desire_clip={sync_taglist:0,init:function(){desire_clip.action.set(),desire_clip.ajax.sync()},ajax:{sync:function(){$.get("/sync/taglist/",desire_clip.ajax.parse)},parse:function(a){a=json.parse(a),a&&a.id&&user_tag.sync!=a.id&&(user_tag.sync=a.id,user_tag.action.store(),desire_clip.ajax.load())},load:function(){$.get("/tag/user/",desire_clip.ajax.on_load)},on_load:function(a){a=json.parse(a),void 0!=a.tags&&(user_tag.list=a.tags,user_tag.option.set_count(),user_tag.action.store()),a.tags.length>0&&desire_clip.action.set()},add:function(a){$.post("/tag/add/",{tag:a})}},action:{set:function(){user_tag.action.ids(),$(".desire_clip").each(function(a,b){$(b).off("click"),$(b).removeClass("desire_user"),user_tag.idls.indexOf($(b).data("id"))>=0?$(b).addClass("desire_user"):$(b).on("click",desire_clip.action.add)}),user_tag.option.set_count()},add:function(){desire_clip.ajax.add($(this).data("tag")),desire_clip.option.toggle(this);var a={tag:$(this).data("tag"),id:$(this).data("id")};user_tag.list.push(a)},del:function(){option_tag.ajax.del($(this).data("id")),desire_clip.option.toggle(this),user_tag.list.splice($(this).data("num"),1),$(this).on("click",desire_clip.action.add)}},option:{toggle:function(a){$(a).off("click"),$(a).toggleClass("desire_user")}}},device={init:function(){},width:function(){return $(window).width()},height:function(){return $(window).height()}},active_textarea,giper_chat={open_mess:0,idle_round:0,count_unread:0,cascade:0,round_time:0,round_open:1,timer_id:null,mess_block:null,mess_stock:[],prev_title:null,init:function(){device.width()>1200&&(giper_chat.mess_stock=storage.array.load("mess_stock"),giper_chat.remind()),$('<div id="block_timer" class="timer">').appendTo("body"),giper_chat.timer_set(),giper_chat.new_round(),$("#giper_reply .post").on("click",giper_chat.reply_show),storage.load("reply_all")&&$("#giper_reply textarea").val(storage.load("reply_all")),giper_chat.prev_title=document.title},set_unread:function(){giper_chat.count_unread>0?($("#menu_message_unread b").text(giper_chat.count_unread),$("#menu_message_unread").show(),$("#menu_message").attr("title","Новых сообщений "+giper_chat.count_unread)):($("#menu_message_unread").text(""),$("#menu_message_unread").hide(),$("#menu_message").attr("title","Новых сообщений нет"))},on_timer:function(){giper_chat.title_blink(),giper_chat.round_open&&0==giper_chat.cascade&&giper_chat.round_time--,giper_chat.trace(),giper_chat.round_time<1&&giper_chat.new_round()},new_round:function(){giper_chat.timer_stop(),giper_chat.ajax_new()},trace:function(){$("#block_timer").text(giper_chat.round_time)},ajax_new:function(){simple_hash(),giper_chat.round_open=0,$.get("/ajax/new_mess.php",{hash:hash},giper_chat.on_load).always(function(){giper_chat.round_open=1})},on_load:function(a){if(a){var b=json.parse(a);giper_chat.route_xz(b),giper_chat.count_unread=b.count_unread,giper_chat.set_unread()}setTimeout(function(){giper_chat.timer_set()},5e3)},route_xz:function(a){if(device.width()>1200&&a.type&&giper_chat.open_mess<9){if(("air_user"==a.type||"new_client"==a.type)&&(visited.action.load_cache(),visited.list.length&&visited.list.indexOf(a.user+"")>=0))return giper_chat.reply_enable(),giper_chat.idle_round=0,setTimeout(function(){giper_chat.timer_set()},5e3),0;giper_chat.mess_stock.push(a),giper_chat.stock.store(),giper_chat.new_message(a)}},reply_enable:function(){0==giper_chat.cascade&&(giper_chat.open_mess>2&&$("#giper_reply").show("blind"),giper_chat.open_mess>5&&$("#giper_reply textarea").show("blind")),giper_chat.open_mess<3&&$("#giper_reply").hide("blind"),0==giper_chat.open_mess&&(giper_chat.cascade=0)},reply_show:function(){var a=$("#giper_reply textarea");$(a).is(":visible")?giper_chat.reply_all():(active_textarea=a,a.show("blind"),a.focus(),notepad.show())},reply_all:function(){var a=$("#giper_reply textarea"),b=a.val();if(b){var c=$("#giper_stock").children().filter(":first");giper_chat.cascade=b,storage.save("reply_all",b),$("textarea",c).val(b),$(".post",c).click(),a.hide("blind")}giper_chat.reply_enable()},new_message:function(a){giper_chat.open_mess++,giper_chat.reply_enable();var b=giper_chat.create_message(a);b.prependTo($("#giper_stock")),b.show("blind"),setTimeout(function(){$(".sound",b).show()},500),giper_chat.idle_round=0},remind:function(){jQuery.each(giper_chat.mess_stock,function(a,b){giper_chat.new_message(b)})},stock:{store:function(){storage.array.save("mess_stock",giper_chat.mess_stock)},remove:function(a){var b=null;jQuery.each(giper_chat.mess_stock,function(c,d){d.mess_id==a&&(b=c)}),(b||0==b)&&(giper_chat.mess_stock.splice(b,1),giper_chat.mess_stock.length-$(".new_message").length>1&&(giper_chat.mess_stock=[]),giper_chat.stock.store())}},create_message:function(a){a.reply||(a.reply="");var b=$("#new_message_ex").clone().attr("id",a.type+"_"+a.mess_id).data("number",a.mess_id).data("user",a.user).addClass(a.type);return $(".mess_text",b).html(a.text),$(".close",b).click(function(){giper_chat.close_message($(b))}),"new_message"!=a.type&&"old_message"!=a.type||("old_message"==a.type&&($(".title",b).text("Есть сообщение без ответа"),$(".sound",b).remove()),$(".post",b).click(function(){giper_chat.post_mess(a)}),$("textarea",b).val(a.reply),$(".user_name",b).text(a.name+":"),$(".history",b).click(function(){giper_chat.follow_message(a.user,a.mess_id)}),$(".bunn",b).click(function(){giper_chat.ajax_bun(a.user,a.mess_id,a.type),giper_chat.open_mess--}),"new_message"==a.type&&$("#contact_update").show("fade")),"server_mess"==a.type&&($(".sound",b).remove(),$(".title",b).text(a.reply),$(".bunn",b).remove(),$(".post",b).val("Хорошо"),$(".post",b).click(function(){send_serv_mess($("#"+a.type+"_"+a.mess_id),"tip_user_bun_close")}),$(".history",b).text("Подробнее..."),$(".history",b).attr("href","/блог/наказывайте-кого-следует/"),$(".history",b).attr("target","_blank")),"air_user"!=a.type&&"new_client"!=a.type||("air_user"==a.type&&$(".title",b).text("Сейчас на сайте"),"new_client"==a.type&&$(".title",b).text("Зарегистрировалась сегодня"),$(".mess_text",b).html(a.age+" "+a.city+" "+a.text),$(".sound",b).remove(),$(".bunn",b).remove(),$(".user_name",b).text(a.name+","),$(".user_name",b).text(a.name+","),$(".post",b).val("Написать"),$(".post",b).click(function(){giper_chat.post_mess(a)}),$(".history",b).text("Смотреть анкету"),$(".history",b).click(function(){giper_chat.follow_message(a.user,a.mess_id)}),"new_client"==a.type),$(b).draggable({handle:".title",stop:function(a,c){$(".sound",b).remove();var d=$(this).offset().top-$(window).scrollTop(),e=$(this).offset().left;$(this).css("top",d).css("left",e).css("position","fixed"),$(this).appendTo("body")}}),b},close_message:function(a){$(".sound",a).remove(),a.hide("blind"),giper_chat.open_mess--,giper_chat.stock.remove(a.data("number")),setTimeout(function(){a.remove()},500)},close_all:function(a){},follow_message:function(a,b){giper_chat.stock.remove(b),location.href="/"+a},ajax_bun:function(a,b,c){giper_chat.close_message($("#"+c+"_"+b)),$.post("/mess/bun/",{id:b,tid:a})},timer_set:function(){giper_chat.timer_stop(),0==giper_chat.idle_round?giper_chat.round_time=10:1==giper_chat.idle_round?giper_chat.round_time=10:2==giper_chat.idle_round?giper_chat.round_time=5:3==giper_chat.idle_round?giper_chat.round_time=25:4==giper_chat.idle_round?giper_chat.round_time=35:giper_chat.idle_round>11?giper_chat.round_time=300:giper_chat.idle_round>4&&(giper_chat.round_time=60),giper_chat.idle_round++,giper_chat.timer_id=window.setInterval("giper_chat.on_timer()",1e3)},timer_stop:function(){window.clearInterval(giper_chat.timer_id)},timer_cut:function(){giper_chat.idle_round>0&&giper_chat.round_time>10&&(giper_chat.round_time=10),giper_chat.idle_round=0},toggle_text:function(){var a=$("textarea",giper_chat.mess_block),b=$(a).val();return $(a).is(":visible")?b:(active_textarea=a,$(a).show("blind"),$(a).focus(),notepad.show(),0)},post_mess:function(a){giper_chat.mess_block=$("#"+a.type+"_"+a.mess_id);var b,c;0!=giper_chat.cascade?(b=giper_chat.cascade,c=""):(b=giper_chat.toggle_text(),c=b),b&&(simple_hash(),$.post("/mailer/post/",{mess:b,id:a.user,re:c,captcha_code:$(".code",giper_chat.mess_block).val(),hash:hash},giper_chat.on_post),disabled_with_timeout($(".post",giper_chat.mess_block),5),giper_chat.timer_cut())},on_post:function(a){if(!a)return 0;var b=JSON.parse(a);"captcha"==b.error&&($("textarea",giper_chat.mess_block).show("blind"),$(".captcha_block",giper_chat.mess_block).show("blind"),$(".captcha",giper_chat.mess_block).get(0).src="/secret_pic.php?hash="+hash),"1"==b.saved&&(giper_chat.idle_round=0,$("#contact_update").show("fade"),giper_chat.close_message(giper_chat.mess_block),notepad.hide(),visited.action.save(giper_chat.mess_block.data("user")),setTimeout(function(){0!=giper_chat.cascade&&giper_chat.reply_all()},700)),"reload"==b.error&&(giper_chat.idle_round=0,location.href="/"+user+"?text="+text),disabled_with_timeout($(".post",giper_chat.mess_block),.05)},title_blink:function(){return 0==giper_chat.count_unread?(document.title=giper_chat.prev_title,!1):void("Вам сообщение!"!=document.title?document.title="Вам сообщение!":document.title=" * * * * * * * * * * * * ")},post_serv:function(a,b){giper_chat.close_message($(a)),set_cookie("user_bun","1",259200)}};$(document).ready(function(){}),function(a){"function"==typeof define&&define.amd?define(["jquery","jquery-ui/ui/widget"],a):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?a(require("jquery"),require("./vendor/jquery.ui.widget")):a(window.jQuery)}(function(a){function b(b){var c="dragover"===b;return function(d){d.dataTransfer=d.originalEvent&&d.originalEvent.dataTransfer;var e=d.dataTransfer;e&&a.inArray("Files",e.types)!==-1&&this._trigger(b,a.Event(b,{delegatedEvent:d}))!==!1&&(d.preventDefault(),c&&(e.dropEffect="copy"))}}a.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||a('<input type="file">').prop("disabled")),a.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),a.support.xhrFormDataFileUpload=!!window.FormData,a.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),a.widget("blueimp.fileupload",{options:{dropZone:a(document),pasteZone:void 0,fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(b,c){return b=this.messages[b]||b.toString(),c&&a.each(c,function(a,c){b=b.replace("{"+a+"}",c)}),b},formData:function(a){return a.serializeArray()},add:function(b,c){return!b.isDefaultPrevented()&&void((c.autoUpload||c.autoUpload!==!1&&a(this).fileupload("option","autoUpload"))&&c.process().done(function(){c.submit()}))},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:a.support.blobSlice&&function(){var a=this.slice||this.webkitSlice||this.mozSlice;return a.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(a,b,c){var d=a-this.timestamp;return(!this.bitrate||!c||d>c)&&(this.bitrate=(b-this.loaded)*(1e3/d)*8,this.loaded=b,this.timestamp=a),this.bitrate}},_isXHRUpload:function(b){return!b.forceIframeTransport&&(!b.multipart&&a.support.xhrFileUpload||a.support.xhrFormDataFileUpload)},_getFormData:function(b){var c;return"function"===a.type(b.formData)?b.formData(b.form):a.isArray(b.formData)?b.formData:"object"===a.type(b.formData)?(c=[],a.each(b.formData,function(a,b){c.push({name:a,value:b})}),c):[]},_getTotal:function(b){var c=0;return a.each(b,function(a,b){c+=b.size||1}),c},_initProgressObject:function(b){var c={loaded:0,total:0,bitrate:0};b._progress?a.extend(b._progress,c):b._progress=c},_initResponseObject:function(a){var b;if(a._response)for(b in a._response)a._response.hasOwnProperty(b)&&delete a._response[b];else a._response={}},_onProgress:function(b,c){if(b.lengthComputable){var d,e=Date.now?Date.now():(new Date).getTime();if(c._time&&c.progressInterval&&e-c._time<c.progressInterval&&b.loaded!==b.total)return;c._time=e,d=Math.floor(b.loaded/b.total*(c.chunkSize||c._progress.total))+(c.uploadedBytes||0),this._progress.loaded+=d-c._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(e,this._progress.loaded,c.bitrateInterval),c._progress.loaded=c.loaded=d,c._progress.bitrate=c.bitrate=c._bitrateTimer.getBitrate(e,d,c.bitrateInterval),this._trigger("progress",a.Event("progress",{delegatedEvent:b}),c),this._trigger("progressall",a.Event("progressall",{delegatedEvent:b}),this._progress)}},_initProgressListener:function(b){var c=this,d=b.xhr?b.xhr():a.ajaxSettings.xhr();d.upload&&(a(d.upload).bind("progress",function(a){var d=a.originalEvent;a.lengthComputable=d.lengthComputable,a.loaded=d.loaded,a.total=d.total,c._onProgress(a,b)}),b.xhr=function(){return d})},_isInstanceOf:function(a,b){return Object.prototype.toString.call(b)==="[object "+a+"]"},_initXHRData:function(b){var c,d=this,e=b.files[0],f=b.multipart||!a.support.xhrFileUpload,g="array"===a.type(b.paramName)?b.paramName[0]:b.paramName;b.headers=a.extend({},b.headers),b.contentRange&&(b.headers["Content-Range"]=b.contentRange),f&&!b.blob&&this._isInstanceOf("File",e)||(b.headers["Content-Disposition"]='attachment; filename="'+encodeURI(e.name)+'"'),f?a.support.xhrFormDataFileUpload&&(b.postMessage?(c=this._getFormData(b),b.blob?c.push({name:g,value:b.blob}):a.each(b.files,function(d,e){c.push({name:"array"===a.type(b.paramName)&&b.paramName[d]||g,value:e})})):(d._isInstanceOf("FormData",b.formData)?c=b.formData:(c=new FormData,a.each(this._getFormData(b),function(a,b){c.append(b.name,b.value)})),b.blob?c.append(g,b.blob,e.name):a.each(b.files,function(e,f){(d._isInstanceOf("File",f)||d._isInstanceOf("Blob",f))&&c.append("array"===a.type(b.paramName)&&b.paramName[e]||g,f,f.uploadName||f.name)})),b.data=c):(b.contentType=e.type||"application/octet-stream",b.data=b.blob||e),b.blob=null},_initIframeSettings:function(b){var c=a("<a></a>").prop("href",b.url).prop("host");b.dataType="iframe "+(b.dataType||""),b.formData=this._getFormData(b),b.redirect&&c&&c!==location.host&&b.formData.push({name:b.redirectParamName||"redirect",value:b.redirect})},_initDataSettings:function(a){this._isXHRUpload(a)?(this._chunkedUpload(a,!0)||(a.data||this._initXHRData(a),this._initProgressListener(a)),a.postMessage&&(a.dataType="postmessage "+(a.dataType||""))):this._initIframeSettings(a)},_getParamName:function(b){var c=a(b.fileInput),d=b.paramName;return d?a.isArray(d)||(d=[d]):(d=[],c.each(function(){for(var b=a(this),c=b.prop("name")||"files[]",e=(b.prop("files")||[1]).length;e;)d.push(c),e-=1}),d.length||(d=[c.prop("name")||"files[]"])),d},_initFormSettings:function(b){b.form&&b.form.length||(b.form=a(b.fileInput.prop("form")),b.form.length||(b.form=a(this.options.fileInput.prop("form")))),b.paramName=this._getParamName(b),b.url||(b.url=b.form.prop("action")||location.href),b.type=(b.type||"string"===a.type(b.form.prop("method"))&&b.form.prop("method")||"").toUpperCase(),"POST"!==b.type&&"PUT"!==b.type&&"PATCH"!==b.type&&(b.type="POST"),b.formAcceptCharset||(b.formAcceptCharset=b.form.attr("accept-charset"))},_getAJAXSettings:function(b){var c=a.extend({},this.options,b);return this._initFormSettings(c),this._initDataSettings(c),c},_getDeferredState:function(a){return a.state?a.state():a.isResolved()?"resolved":a.isRejected()?"rejected":"pending"},_enhancePromise:function(a){return a.success=a.done,a.error=a.fail,a.complete=a.always,a},_getXHRPromise:function(b,c,d){var e=a.Deferred(),f=e.promise();return c=c||this.options.context||f,b===!0?e.resolveWith(c,d):b===!1&&e.rejectWith(c,d),f.abort=e.promise,this._enhancePromise(f)},_addConvenienceMethods:function(b,c){var d=this,e=function(b){return a.Deferred().resolveWith(d,b).promise()};c.process=function(b,f){return(b||f)&&(c._processQueue=this._processQueue=(this._processQueue||e([this])).then(function(){return c.errorThrown?a.Deferred().rejectWith(d,[c]).promise():e(arguments)}).then(b,f)),this._processQueue||e([this])},c.submit=function(){return"pending"!==this.state()&&(c.jqXHR=this.jqXHR=d._trigger("submit",a.Event("submit",{delegatedEvent:b}),this)!==!1&&d._onSend(b,this)),this.jqXHR||d._getXHRPromise()},c.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",d._trigger("fail",null,this),d._getXHRPromise(!1))},c.state=function(){return this.jqXHR?d._getDeferredState(this.jqXHR):this._processQueue?d._getDeferredState(this._processQueue):void 0},c.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===d._getDeferredState(this._processQueue)},c.progress=function(){return this._progress},c.response=function(){return this._response}},_getUploadedBytes:function(a){var b=a.getResponseHeader("Range"),c=b&&b.split("-"),d=c&&c.length>1&&parseInt(c[1],10);return d&&d+1},_chunkedUpload:function(b,c){b.uploadedBytes=b.uploadedBytes||0;var d,e,f=this,g=b.files[0],h=g.size,i=b.uploadedBytes,j=b.maxChunkSize||h,k=this._blobSlice,l=a.Deferred(),m=l.promise();return!(!(this._isXHRUpload(b)&&k&&(i||j<h))||b.data)&&(!!c||(i>=h?(g.error=b.i18n("uploadedBytes"),this._getXHRPromise(!1,b.context,[null,"error",g.error])):(e=function(){var c=a.extend({},b),m=c._progress.loaded;c.blob=k.call(g,i,i+j,g.type),c.chunkSize=c.blob.size,c.contentRange="bytes "+i+"-"+(i+c.chunkSize-1)+"/"+h,f._initXHRData(c),f._initProgressListener(c),d=(f._trigger("chunksend",null,c)!==!1&&a.ajax(c)||f._getXHRPromise(!1,c.context)).done(function(d,g,j){i=f._getUploadedBytes(j)||i+c.chunkSize,m+c.chunkSize-c._progress.loaded&&f._onProgress(a.Event("progress",{lengthComputable:!0,loaded:i-c.uploadedBytes,total:i-c.uploadedBytes}),c),b.uploadedBytes=c.uploadedBytes=i,c.result=d,c.textStatus=g,c.jqXHR=j,f._trigger("chunkdone",null,c),f._trigger("chunkalways",null,c),i<h?e():l.resolveWith(c.context,[d,g,j])}).fail(function(a,b,d){c.jqXHR=a,c.textStatus=b,c.errorThrown=d,f._trigger("chunkfail",null,c),f._trigger("chunkalways",null,c),l.rejectWith(c.context,[a,b,d])})},this._enhancePromise(m),m.abort=function(){return d.abort()},e(),m)))},_beforeSend:function(a,b){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(b),this._initProgressObject(b),b._progress.loaded=b.loaded=b.uploadedBytes||0,b._progress.total=b.total=this._getTotal(b.files)||1,b._progress.bitrate=b.bitrate=0,this._active+=1,this._progress.loaded+=b.loaded,this._progress.total+=b.total},_onDone:function(b,c,d,e){var f=e._progress.total,g=e._response;e._progress.loaded<f&&this._onProgress(a.Event("progress",{lengthComputable:!0,loaded:f,total:f}),e),g.result=e.result=b,g.textStatus=e.textStatus=c,g.jqXHR=e.jqXHR=d,this._trigger("done",null,e)},_onFail:function(a,b,c,d){var e=d._response;d.recalculateProgress&&(this._progress.loaded-=d._progress.loaded,this._progress.total-=d._progress.total),e.jqXHR=d.jqXHR=a,e.textStatus=d.textStatus=b,e.errorThrown=d.errorThrown=c,this._trigger("fail",null,d)},_onAlways:function(a,b,c,d){this._trigger("always",null,d)},_onSend:function(b,c){c.submit||this._addConvenienceMethods(b,c);var d,e,f,g,h=this,i=h._getAJAXSettings(c),j=function(){return h._sending+=1,i._bitrateTimer=new h._BitrateTimer,d=d||((e||h._trigger("send",a.Event("send",{delegatedEvent:b}),i)===!1)&&h._getXHRPromise(!1,i.context,e)||h._chunkedUpload(i)||a.ajax(i)).done(function(a,b,c){h._onDone(a,b,c,i)}).fail(function(a,b,c){h._onFail(a,b,c,i)}).always(function(a,b,c){if(h._onAlways(a,b,c,i),h._sending-=1,h._active-=1,i.limitConcurrentUploads&&i.limitConcurrentUploads>h._sending)for(var d=h._slots.shift();d;){if("pending"===h._getDeferredState(d)){d.resolve();break}d=h._slots.shift()}0===h._active&&h._trigger("stop")})};return this._beforeSend(b,i),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(f=a.Deferred(),this._slots.push(f),g=f.then(j)):(this._sequence=this._sequence.then(j,j),g=this._sequence),g.abort=function(){return e=[void 0,"abort","abort"],d?d.abort():(f&&f.rejectWith(i.context,e),j())},this._enhancePromise(g)):j()},_onAdd:function(b,c){var d,e,f,g,h=this,i=!0,j=a.extend({},this.options,c),k=c.files,l=k.length,m=j.limitMultiFileUploads,n=j.limitMultiFileUploadSize,o=j.limitMultiFileUploadSizeOverhead,p=0,q=this._getParamName(j),r=0;if(!l)return!1;if(n&&void 0===k[0].size&&(n=void 0),(j.singleFileUploads||m||n)&&this._isXHRUpload(j))if(j.singleFileUploads||n||!m)if(!j.singleFileUploads&&n)for(f=[],d=[],g=0;g<l;g+=1)p+=k[g].size+o,(g+1===l||p+k[g+1].size+o>n||m&&g+1-r>=m)&&(f.push(k.slice(r,g+1)),e=q.slice(r,g+1),e.length||(e=q),d.push(e),r=g+1,p=0);else d=q;else for(f=[],d=[],g=0;g<l;g+=m)f.push(k.slice(g,g+m)),e=q.slice(g,g+m),e.length||(e=q),d.push(e);else f=[k],d=[q];return c.originalFiles=k,a.each(f||k,function(e,g){var j=a.extend({},c);return j.files=f?g:[g],j.paramName=d[e],h._initResponseObject(j),h._initProgressObject(j),h._addConvenienceMethods(b,j),i=h._trigger("add",a.Event("add",{delegatedEvent:b}),j)}),i},_replaceFileInput:function(b){var c=b.fileInput,d=c.clone(!0),e=c.is(document.activeElement);b.fileInputClone=d,a("<form></form>").append(d)[0].reset(),c.after(d).detach(),e&&d.focus(),a.cleanData(c.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(a,b){return b===c[0]?d[0]:b}),c[0]===this.element[0]&&(this.element=d)},_handleFileTreeEntry:function(b,c){var d,e=this,f=a.Deferred(),g=[],h=function(a){a&&!a.entry&&(a.entry=b),f.resolve([a])},i=function(a){e._handleFileTreeEntries(a,c+b.name+"/").done(function(a){f.resolve(a)}).fail(h)},j=function a(){d.readEntries(function(b){b.length?(g=g.concat(b),a()):i(g)},h)};return c=c||"",b.isFile?b._file?(b._file.relativePath=c,f.resolve(b._file)):b.file(function(a){a.relativePath=c,f.resolve(a)},h):b.isDirectory?(d=b.createReader(),j()):f.resolve([]),f.promise()},_handleFileTreeEntries:function(b,c){var d=this;return a.when.apply(a,a.map(b,function(a){return d._handleFileTreeEntry(a,c)})).then(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(b){b=b||{};var c=b.items;return c&&c.length&&(c[0].webkitGetAsEntry||c[0].getAsEntry)?this._handleFileTreeEntries(a.map(c,function(a){var b;return a.webkitGetAsEntry?(b=a.webkitGetAsEntry(),b&&(b._file=a.getAsFile()),b):a.getAsEntry()})):a.Deferred().resolve(a.makeArray(b.files)).promise()},_getSingleFileInputFiles:function(b){b=a(b);var c,d,e=b.prop("webkitEntries")||b.prop("entries");if(e&&e.length)return this._handleFileTreeEntries(e);if(c=a.makeArray(b.prop("files")),c.length)void 0===c[0].name&&c[0].fileName&&a.each(c,function(a,b){b.name=b.fileName,b.size=b.fileSize});else{if(d=b.prop("value"),!d)return a.Deferred().resolve([]).promise();c=[{name:d.replace(/^.*\\/,"")}]}return a.Deferred().resolve(c).promise()},_getFileInputFiles:function(b){return b instanceof a&&1!==b.length?a.when.apply(a,a.map(b,this._getSingleFileInputFiles)).then(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(b)},_onChange:function(b){var c=this,d={fileInput:a(b.target),form:a(b.target.form)};this._getFileInputFiles(d.fileInput).always(function(e){d.files=e,c.options.replaceFileInput&&c._replaceFileInput(d),c._trigger("change",a.Event("change",{delegatedEvent:b}),d)!==!1&&c._onAdd(b,d)})},_onPaste:function(b){var c=b.originalEvent&&b.originalEvent.clipboardData&&b.originalEvent.clipboardData.items,d={files:[]};c&&c.length&&(a.each(c,function(a,b){var c=b.getAsFile&&b.getAsFile();c&&d.files.push(c)}),this._trigger("paste",a.Event("paste",{delegatedEvent:b}),d)!==!1&&this._onAdd(b,d))},_onDrop:function(b){b.dataTransfer=b.originalEvent&&b.originalEvent.dataTransfer;var c=this,d=b.dataTransfer,e={};d&&d.files&&d.files.length&&(b.preventDefault(),this._getDroppedFiles(d).always(function(d){e.files=d,c._trigger("drop",a.Event("drop",{delegatedEvent:b}),e)!==!1&&c._onAdd(b,e)}))},_onDragOver:b("dragover"),_onDragEnter:b("dragenter"),_onDragLeave:b("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste})),a.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_destroy:function(){this._destroyEventHandlers()},_setOption:function(b,c){var d=a.inArray(b,this._specialOptions)!==-1;d&&this._destroyEventHandlers(),this._super(b,c),d&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var b=this.options;void 0===b.fileInput?b.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):b.fileInput instanceof a||(b.fileInput=a(b.fileInput)),b.dropZone instanceof a||(b.dropZone=a(b.dropZone)),b.pasteZone instanceof a||(b.pasteZone=a(b.pasteZone))},_getRegExp:function(a){var b=a.split("/"),c=b.pop();return b.shift(),new RegExp(b.join("/"),c)},_isRegExpOption:function(b,c){return"url"!==b&&"string"===a.type(c)&&/^\/.*\/[igm]{0,3}$/.test(c)},_initDataAttributes:function(){var b=this,c=this.options,d=this.element.data();a.each(this.element[0].attributes,function(a,e){var f,g=e.name.toLowerCase();/^data-/.test(g)&&(g=g.slice(5).replace(/-[a-z]/g,function(a){return a.charAt(1).toUpperCase()}),f=d[g],b._isRegExpOption(g,f)&&(f=b._getRegExp(f)),c[g]=f)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(b){var c=this;b&&!this.options.disabled&&(b.fileInput&&!b.files?this._getFileInputFiles(b.fileInput).always(function(a){b.files=a,c._onAdd(null,b)}):(b.files=a.makeArray(b.files),
this._onAdd(null,b)))},send:function(b){if(b&&!this.options.disabled){if(b.fileInput&&!b.files){var c,d,e=this,f=a.Deferred(),g=f.promise();return g.abort=function(){return d=!0,c?c.abort():(f.reject(null,"abort","abort"),g)},this._getFileInputFiles(b.fileInput).always(function(a){if(!d){if(!a.length)return void f.reject();b.files=a,c=e._onSend(null,b),c.then(function(a,b,c){f.resolve(a,b,c)},function(a,b,c){f.reject(a,b,c)})}}),this._enhancePromise(g)}if(b.files=a.makeArray(b.files),b.files.length)return this._onSend(null,b)}return this._getXHRPromise(!1,b&&b.context)}})}),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a("object"===("undefined"==typeof exports?"undefined":_typeof(exports))?require("jquery"):window.jQuery)}(function(a){var b=0;a.ajaxTransport("iframe",function(c){if(c.async){var d,e,f,g=c.initialIframeSrc||"javascript:false;";return{send:function(h,i){d=a('<form style="display:none;"></form>'),d.attr("accept-charset",c.formAcceptCharset),f=/\?/.test(c.url)?"&":"?","DELETE"===c.type?(c.url=c.url+f+"_method=DELETE",c.type="POST"):"PUT"===c.type?(c.url=c.url+f+"_method=PUT",c.type="POST"):"PATCH"===c.type&&(c.url=c.url+f+"_method=PATCH",c.type="POST"),b+=1,e=a('<iframe src="'+g+'" name="iframe-transport-'+b+'"></iframe>').bind("load",function(){var b,f=a.isArray(c.paramName)?c.paramName:[c.paramName];e.unbind("load").bind("load",function(){var b;try{if(b=e.contents(),!b.length||!b[0].firstChild)throw new Error}catch(a){b=void 0}i(200,"success",{iframe:b}),a('<iframe src="'+g+'"></iframe>').appendTo(d),window.setTimeout(function(){d.remove()},0)}),d.prop("target",e.prop("name")).prop("action",c.url).prop("method",c.type),c.formData&&a.each(c.formData,function(b,c){a('<input type="hidden"/>').prop("name",c.name).val(c.value).appendTo(d)}),c.fileInput&&c.fileInput.length&&"POST"===c.type&&(b=c.fileInput.clone(),c.fileInput.after(function(a){return b[a]}),c.paramName&&c.fileInput.each(function(b){a(this).prop("name",f[b]||c.paramName)}),d.append(c.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data"),c.fileInput.removeAttr("form")),d.submit(),b&&b.length&&c.fileInput.each(function(c,d){var e=a(b[c]);a(d).prop("name",e.prop("name")).attr("form",e.attr("form")),e.replaceWith(d)})}),d.append(e).appendTo(document.body)},abort:function(){e&&e.unbind("load").prop("src",g),d&&d.remove()}}}}),a.ajaxSetup({converters:{"iframe text":function(b){return b&&a(b[0].body).text()},"iframe json":function(b){return b&&a.parseJSON(a(b[0].body).text())},"iframe html":function(b){return b&&a(b[0].body).html()},"iframe xml":function(b){var c=b&&b[0];return c&&a.isXMLDoc(c)?c:a.parseXML(c.XMLDocument&&c.XMLDocument.xml||a(c.body).html())},"iframe script":function(b){return b&&a.globalEval(a(b[0].body).text())}}})});var json={parse:function(a){var b=null;try{b=JSON.parse(a)}catch(a){}return b},encode:function(a){return JSON.stringify(a)}},mailsett={init:function(){$("#link_virt_turn").on("click",mailsett.turn_virt),$("#link_close_turn").on("click",mailsett.turn_close)},turn_virt:function(){var a=$("#text_virt_turn").text();"неприемлемо"==a?($("#text_virt_turn").text("возможен"),mailsett.send_virt(1)):($("#text_virt_turn").text("неприемлемо"),mailsett.send_virt(0))},turn_close:function(){var a=$("#text_close_turn").text();"ограничить"==a?($("#text_close_turn").text("разрешить"),mailsett.send_close(0)):($("#text_close_turn").text("ограничить"),mailsett.send_close(1))},send_close:function(a){function b(a){}$.post("/msett/close/",{option_mess_town:a},b)},send_virt:function(a){function b(a){}$.post("/msett/virt/",{option_virt_accept:a},b)}},master_info={init:function(){userinfo.data.sex?!userinfo.data.city&&$("#human_print_city").text()?master_info.ajax.load_city():userinfo.data.age?userinfo.data.second>300&&userinfo.data.contact.mc<20&&master_info.ajax.load_contact():master_info.ajax.load_age():master_info.ajax.load_sex()},ajax:{load_contact:function(){$("#anketa_master_info").load("/static/htm/master_contact.html",master_info.ajax.on_contact)},on_contact:function(){master_contact.action.sett(0),master_contact.option.print()},load_city:function(){$("#anketa_master_info").load("/static/htm/master_city.html",master_info.ajax.on_city)},on_city:function(){master_city.init(),option_static.init()},load_age:function(){$("#anketa_master_info").load("/static/htm/master_age.html",master_info.ajax.on_age)},on_age:function(){master_age.init(),option_static.init()},load_sex:function(){$("#anketa_master_info").load("/static/htm/master_sex.html",master_info.ajax.on_sex)},on_sex:function(){master_sex.init(),option_static.init()}}},navigate={enable:0,init:function(){$(document).on("keydown",function(){navigate.through(event)})},post_form:function(a,b){!a.ctrlKey||10!=a.keyCode&&13!=a.keyCode||b.submit()},through:function(a){if(window.event&&(a=window.event),a.ctrlKey){var b=null;switch(a.keyCode?a.keyCode:a.which?a.which:null){case 37:b="#previous_page";break;case 39:b="#next_page";break;case 38:b="#up_page";break;case 40:b="#down_page";break;case 36:b="#home_page"}$("a").is(b)&&(document.location=$(b).attr("href"))}}},notepad={note_block:null,last_click:null,disibled:0,create:0,init:function(){device.width()<1e3&&(notepad.disibled=1),notepad.disibled=1*get_cookie("note_vis")?1:0,active_textarea=$("#mess_text_val"),notepad.note_block=$(".notepad"),$("textarea").click(function(){active_textarea=this,notepad.show()}),$("#notepad_on").click(function(){notepad.toggle_disable("on"),notepad.show("force")}),$(".close",notepad.note_block).click(function(){notepad.hide()}),$(".post",notepad.note_block).click(function(){notepad.toggle_disable("off"),notepad.hide()}),$(".bunn",notepad.note_block).click(function(){notepad.toggle_disable("off"),notepad.hide()})},hide:function(){notepad.note_block.hide("fade")},show:function(a){notepad.disibled||(a||active_textarea&&notepad.last_click!=active_textarea)&&(notepad.create?(notepad.note_block.show("fade"),notepad.last_click=active_textarea):notepad.ajax_load())},toggle_disable:function(a){"off"==a&&(notepad.disibled=1),"on"==a&&(notepad.disibled=0),a&&set_cookie("note_vis",notepad.disibled,259200)},ajax_load:function(){simple_hash(),$.get("/ajax/load_notepad.php",{hash:hash},notepad.on_load)},remind:function(){var a=storage.load("notepad_top"),b=storage.load("notepad_left");a&&a<40&&(a=50),b&&b<10&&(b=10),a>device.height()-300&&(a=0),b>device.width()-300&&(b=0),a&&notepad.note_block.css("top",a+"px"),b&&notepad.note_block.css("left",b+"px")},on_load:function(a){a.indexOf("div")>0&&(notepad.create=1,$(".notes",notepad.note_block).html(a),$(".note_line",notepad.note_block).click(function(){var a=$(this).text();$(active_textarea).val(a).focus(),"mess-text-area"==$(active_textarea).attr("id")&&(FormMess.message=a)}),notepad.remind(),notepad.note_block.draggable({handle:".title",stop:function(a,b){var c=$(this).offset().top-$(window).scrollTop();notepad.note_block.css("top",c),storage.save("notepad_top",c),storage.save("notepad_left",$(this).offset().left)}}),notepad.show())}},option_age={init:function(){$("#option_age_value").val(userinfo.data.age),$("#option_age_button").off("click").on("click",option_age.action.send_age),$(".opt_age_val").off("click").on("click",option_age.action.send_link)},ajax:{on_save:function(a){a=json.parse(a),a.age&&(userinfo.data.age=a.age,userinfo.action.set_age(a.say))}},action:{save:function(a){userinfo.data.age=a,userinfo.ajax.save.age(option_age.ajax.on_save),userinfo.action.set_age(),option_static.action.close()},send_link:function(){option_age.action.save($(this).text())},send_age:function(){option_age.action.save($("#option_age_value").val())}}},option_anketa={anketa:{growth:0,weight:0,figure:0},init:function(){$("#option_anketa input").prop("disabled",!0),$("#option_anketa input:radio").on("click",option_anketa.action.set),$("#option_anketa_button").on("click",option_anketa.action.send),option_anketa.ajax.load()},ajax:{load:function(){$.get("/sync/anketa/",option_anketa.ajax.on_load)},on_load:function(a){option_anketa.action.print(json.parse(a))},save:function(a){$.post("/option/anketa/",{anketa:a},option_anketa.ajax.on_save),option_static.action.close()},on_save:function(a){a=json.parse(a),void 0!=a.alert&&(profile_alert.option.show(a.alert),option_anketa.action.set_anketa(a.text))}},action:{set_anketa:function(a){$("#user_anketa_option").text(a)},set:function(){option_anketa.anketa.figure=$(this).val()},send:function(){option_anketa.anketa.growth=$("#option_anketa_growth").val(),option_anketa.anketa.weight=$("#option_anketa_weight").val(),option_anketa.ajax.save(option_anketa.anketa)},print:function(a){if(void 0!=a.figure){option_anketa.anketa=a;var b=$("#option_anketa input:radio[name=figure]");b.filter("[value="+1*a.figure+"]").prop("checked",!0),$("#option_anketa_growth").val(1*a.growth),$("#option_anketa_weight").val(1*a.weight)}$("#option_anketa input").prop("disabled",!1)}}},option_chlogin={init:function(){$(".option_chlogin_toggle").on("click",option_chlogin.option.toggle),$("#option_chpass_send").on("click",option_chlogin.action.chpass),$("#option_chlogin_send").on("click",option_chlogin.action.chlogin)},ajax:{chpass:function(a){$.post("/option/auth/",{pass:a},option_chlogin.ajax.on_pass)},chlogin:function(a){$.post("/option/auth/",{login:a},option_chlogin.ajax.on_login)},on_pass:function(a){option_chlogin.ajax.on_err(a),disabled_with_timeout($("#option_chpass_send"),.5)},on_login:function(a){option_chlogin.ajax.on_err(a),disabled_with_timeout($("#option_chlogin_send"),.5)},on_err:function(a){a=json.parse(a),void 0!=a.err&&a.err>0?option_chlogin.option.text(a.say):option_static.action.close()}},action:{chlogin:function(){option_chlogin.option.text(""),disabled_with_timeout($("#option_chlogin_send"),5),option_chlogin.ajax.chlogin($("#option_chlogin_value").val())},chpass:function(){option_chlogin.option.text(""),disabled_with_timeout($("#option_chpass_send"),5),option_chlogin.ajax.chpass($("#option_chpass_value").val())}},option:{toggle:function(){option_chlogin.option.text(""),$("#option_tab_chlogin").toggle("blind"),$("#option_tab_chpass").toggle("blind")},text:function(a){function b(b){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){$(".option_chlogin_text").text(a)})}},option_city={init:function(){$("#option_city_value").val(userinfo.data.city),$("#option_city_button").off("click").on("click",option_city.action.send_city),$(".opt_city_val").off("click").on("click",option_city.action.send_link)},ajax:{on_save:function(a){a=json.parse(a),a.city&&(userinfo.data.city=a.city,userinfo.data.city_id=a.city_id,userinfo.data.verify=a.verify,userinfo.action.set_city())}},action:{save:function(a){userinfo.data.city=a,userinfo.ajax.save.city(option_city.ajax.on_save),userinfo.action.set_city(),option_static.action.close()},send_link:function(){option_city.action.save($(this).text())},send_city:function(){option_city.action.save($("#option_city_value").val())}}},option_contact={init:function(){$("#option_contact input").prop("disabled",!0),$("#option_contact input:checkbox").on("click",option_contact.action.set),$("#option_contact_button").on("click",option_contact.action.send),option_contact.action.print()},ajax:{save:function(a){$.post("/option/contact/",{contact:a},option_contact.ajax.on_save)},on_save:function(a){mess=json.parse(a),$("#user_contact_option").text(mess.count),profile_alert.option.show(mess.alert),option_static.action.close()}},action:{set:function(){userinfo.data.contact[$(this).data("val")]=1*$(this).prop("checked")},send:function(){option_contact.ajax.save(userinfo.data.contact)},print:function(){void 0!=userinfo.data.contact&&($("#option_contact_em").prop("checked",1*userinfo.data.contact.em),$("#option_contact_vk").prop("checked",1*userinfo.data.contact.vk),$("#option_contact_ok").prop("checked",1*userinfo.data.contact.ok),$("#option_contact_fb").prop("checked",1*userinfo.data.contact.fb),$("#option_contact_go").prop("checked",1*userinfo.data.contact.go),$("#option_contact_sk").prop("checked",1*userinfo.data.contact.sk),$("#option_contact_ph").prop("checked",1*userinfo.data.contact.ph),$("#option_contact input").prop("disabled",!1))}}},option_email={init:function(){$(".option_email_button").off("click"),$(".option_email_button").on("click",option_email.action.send_email),userinfo.data.email&&$(".option_email_value").val(userinfo.data.email),option_email.ajax.load()},ajax:{load:function(){$.post("/sync/email/",option_email.ajax.on_load)},post:function(a){$.post("/option/email/",{email:a},option_email.ajax.on_save),userinfo.data.email=data.email,userinfo.action.set_email(),option_static.action.close()},on_save:function(a){profile_alert.option.show(json.parse(a))},on_load:function(a){a=json.parse(a),a&&""!=a.email&&(userinfo.data.email=a.email,userinfo.action.set_email())}},action:{send_email:function(){option_email.ajax.post($(".option_email_value").val())}}},option_intro={name:"",city:"",age:0,sex:0,init:function(){$("#option_intro input").prop("disabled",!0),$("#option_intro input:radio").on("click",option_intro.action.set_sex),$("#option_intro_button").on("click",option_intro.action.send),option_intro.action.print()},action:{set_sex:function(){var a=$(this).val();a!=userinfo.data.sex&&(userinfo.data.sex=a,userinfo.ajax.save.sex(option_sex.ajax.on_save),userinfo.action.set_sex())},set_name:function(){var a=$("#option_intro_name").val();a!=userinfo.data.name&&(userinfo.data.name=a,userinfo.ajax.save.name(option_name.ajax.on_save),userinfo.action.set_name())},set_city:function(){var a=$("#option_intro_city").val();a!=userinfo.data.city&&(userinfo.data.city=a,userinfo.ajax.save.city(option_city.ajax.on_save),userinfo.action.set_city())},set_age:function(){var a=$("#option_intro_age").val();a!=userinfo.data.age&&(userinfo.data.age=a,userinfo.ajax.save.age(option_age.ajax.on_save),userinfo.action.set_age())},send:function(){option_intro.action.set_name(),option_intro.action.set_city(),option_intro.action.set_age(),option_static.action.close()},print:function(){option_intro.name=userinfo.data.name,option_intro.city=userinfo.data.city,option_intro.age=userinfo.data.age,option_intro.sex=userinfo.data.sex,$("#option_intro_name").val(userinfo.data.name),$("#option_intro_city").val(userinfo.data.city),$("#option_intro_age").val(userinfo.data.age);var a=$("#option_intro input:radio[name=sex]");a.filter("[value="+1*userinfo.data.sex+"]").prop("checked",!0),$("#option_intro input").prop("disabled",!1)}}},option_login={init:function(){$("#hide_char").on("click",option_login.action.hide_char),$("#option_login_send").on("click",option_login.action.send),$("#option_remind_send").on("click",option_login.action.remind),$(".option_login_toggle").on("click",option_login.option.toggle),$("#option_login_reset").on("click",option_login.option.reset)},ajax:{send:function(a,b,c){$.post("/sync/login/",{login:a,pass:b,captcha:c},option_login.ajax.on_save)},on_save:function(a){a=json.parse(a),void 0!=a.err&&("0"!=a.err?(option_login.option.captcha.reload(),option_login.option.captcha.show(),option_login.option.say_login(a.say)):(option_login.option.say_login(a.say),location.href=location.href)),disabled_with_timeout($("#option_login_send"),.1)},remind:function(a){$.post("/sync/remind/",{email:a},option_login.ajax.on_load)},on_load:function(a){a=json.parse(a),void 0!=a.err&&("0"!=a.err?option_login.option.say_remind(a.say):option_login.option.posted()),disabled_with_timeout($("#option_remind_send"),.1)}},action:{hide_char:function(){var a=$("#password_input"),b=a.attr("type");"password"==b?a.attr("type","text"):a.attr("type","password")},send:function(){var a=$("#login_input").val(),b=$("#password_input").val(),c=$("#captcha_input").val();disabled_with_timeout($("#option_login_send"),7),option_login.ajax.send(a,b,c)},remind:function(){var a=$("#option_remind_email").val();disabled_with_timeout($("#option_remind_send"),7),option_login.ajax.remind(a)}},option:{captcha:{show:function(){$("#captcha_pass_block").show()},reload:function(){$("#captcha_code").is(":visible")&&($("#captcha_code").get(0).src="/capcha_pic.php?hash="+hash)}},say_login:function(a){$("#option_login_text").text(a)},say_remind:function(a){$("#option_remind_text").text(a)},toggle:function(){$("#option_tab_login").toggle("blind"),$("#option_tab_remind").toggle("blind"),$("#option_tab_posted").hide("blind")},posted:function(){$("#option_tab_posted").show("blind"),$("#option_tab_remind").hide("blind"),$("#option_tab_login").hide("blind")},reset:function(){$("#option_tab_posted").hide("blind"),$("#option_tab_remind").hide("blind"),$("#option_tab_login").show("blind")}}},option_name={init:function(){$("#option_name_value").val(userinfo.data.name),$("#option_name_button").off("click").on("click",option_name.action.send_name),option_name.option.namelist()},ajax:{on_save:function(a){a=json.parse(a),a.name&&(userinfo.data.name=a.name,userinfo.action.set_name())}},action:{save:function(a){userinfo.data.name=a,userinfo.ajax.save.name(option_name.ajax.on_save),userinfo.action.set_name(),option_static.action.close()},send_link:function(){option_name.action.save($(this).text())},send_name:function(){option_name.action.save($("#option_name_value").val())}},option:{namelist:function(){1==userinfo.data.sex&&$("#man_opt_name").show(),2==userinfo.data.sex&&$("#woman_opt_name").show(),!userinfo.data.sex,$(".opt_name_val").on("click",option_name.action.send_link)}}},option_sex={init:function(){$(".option_sex_change").off("click").on("click",option_sex.action.send_sex)},ajax:{on_save:function(a){userinfo.data.name=auto_gen.name(userinfo.data.sex),userinfo.ajax.save.name(option_name.ajax.on_save),a=json.parse(a),a.sex&&(userinfo.data.sex=a.sex,userinfo.action.set_sex())}},action:{send_sex:function(){0==userinfo.data.sex?userinfo.data.sex=2:1==userinfo.data.sex?userinfo.data.sex=2:2==userinfo.data.sex&&(userinfo.data.sex=1),userinfo.ajax.save.sex(option_sex.ajax.on_save),userinfo.action.set_sex()},save:function(a){userinfo.data.sex=a,userinfo.ajax.save.sex(option_sex.ajax.on_save),userinfo.action.set_sex()}}};Vue.component("initial-dialog",{data:function(){return{contacts:[],response:null,slow:!1,next:0,batch:10,received:0}},methods:{close:function(){this.$emit("close")},load:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{hash:hash}};axios.get("/contact/list/initial/",b).then(function(b){var c=b.data;a.received=c?c.length:0,a.received&&(a.contacts=_.union(a.contacts,c)),a.next+=a.batch,a.response=200,a.slow=!1}).catch(function(a){console.log(a)}),setTimeout(function(){return a.slow=!0},3e3)}},mounted:function(){this.load()},template:"#contact-dialog"}),Vue.component("sends-dialog",{data:function(){return{contacts:[],response:null,slow:!1,next:0,batch:10,received:0}},methods:{close:function(){this.$emit("close")},load:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{hash:hash}};axios.get("/contact/list/sends/",b).then(function(b){var c=b.data;a.received=c?c.length:0,a.received&&(a.contacts=_.union(a.contacts,c)),a.next+=a.batch,a.response=200,a.slow=!1}).catch(function(a){console.log(a)}),setTimeout(function(){return a.slow=!0},3e3)}},mounted:function(){this.load()},template:"#contact-dialog"}),Vue.component("photo-view",{props:["photo","thumb","width","height","bypass"],methods:{approve:function(){store.commit("approveViewPhoto")}},computed:Vuex.mapState({accept:function(a){return!(!a.accepts.photo&&!this.bypass)}}),template:"#photo-view"}),Vue.component("photo-dialog",{methods:{close:function(){this.$emit("close"),store.commit("viewPhoto",{photo:null})}},computed:Vuex.mapState({config:function(a){return a.photoView}}),template:"#photo-dialog"}),Vue.component("upload-dialog",{template:"#upload-dialog",data:function(){return{photos:[],server:null}},created:function(){this.server=this.$store.state.photoServer},methods:{loadPhoto:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{hash:hash}};axios.get("http://"+this.server+"/api/v1/users/"+uid+"/photos",b).then(function(b){var c=b.data.photos;c&&c.length&&(a.photos=b.data.photos)}).catch(function(a){console.log(a)})},upload:function(a){$("#fileupload").click()},show:function(a){this.preview(this.photos[a])},preview:function(a){var b=a._links;if(b.origin.href){var c={photo:b.origin.href,thumb:b.thumb.href,alias:a.alias,height:a.height,width:a.width};store.commit("sendPhoto",c)}this.close()},close:function(){this.$emit("close")}},mounted:function(){console.log("fileupload");var a=this;$("#fileupload").fileupload({dataType:"json",add:function(b,c){c.url="http://"+a.server+"/api/v1/users/"+uid+"/photos?jwt="+a.$store.state.apiToken,c.submit()},done:function(b,c){a.preview(c.result.photo)}}),this.loadPhoto()}}),Vue.component("option-dialog",{template:"#option-static__dialog-window",methods:{close:function(){this.$emit("close")}},created:function(){var a=this;document.addEventListener("keydown",function(){a.show&&27===event.keyCode&&a.close()})},updated:function(){this.show&&$("html, body").animate({scrollTop:0},"slow")}});var OptionStaticViewer=new Vue({el:"#option-static__viewer",store:store,computed:Vuex.mapState({view:function(a){return a.optionStatic.view}}),methods:{close:function(){store.commit("optionDialog",!1)}}}),option_static={click_enable:null,active_elem:null,timer_id:null,form:null,init:function(){return $(".option_static").length?($(".option_static").each(function(a,b){b=$(b),b.data("active")||(b.on("click",option_static.action.preload),b.data("active",1))}),void $("#option-static__close").on("click",option_static.action.close)):null},ajax:{load:function(a){option_static.option.form.trash(),$("#option-static__container").load("/static/htm/option_"+a+".html",option_static.ajax.on_load)},on_load:function(a){a&&(option_static.action.router(),option_static.action.show_form(),$("html, body").animate({scrollTop:0},"slow"))},save:function(a){}},option:{loader:{show:function(){$("#option-static__loader").delay(1e3).show("fade")},hide:function(){$("#option-static__loader").clearQueue(),$("#option-static__loader").hide("fade")}},form:{show:function(){$("#option-static__container").show("fade")},hide:function(){$("#option-static__container").hide("fade")},trash:function(){$("#option-static__container").empty()}},block:{show:function(){$("#option-static").show("fade")},hide:function(){$("#option-static").hide("fade")}}},action:{show_form:function(){option_static.option.form.show(),option_static.option.loader.hide()},preload:function(){var a=$(this).data("option");option_static.form=a,a&&(option_static.ajax.load(a),option_static.option.block.show(),option_static.option.loader.show())},close:function(){option_static.option.form.hide(),option_static.option.loader.hide(),option_static.option.block.hide()},router:function(){"login"==option_static.form&&option_login.init(),"contact"==option_static.form&&option_contact.init(),"age"==option_static.form&&option_age.init(),"name"==option_static.form&&(option_name.init(),name_suggest.init(),city_suggest.init()),"city"==option_static.form&&(option_city.init(),city_suggest.init()),"hidepass"==option_static.form&&option_email.init(),"anketa"==option_static.form&&(option_anketa.init(),name_suggest.init(),city_suggest.init()),"chlogin"==option_static.form&&option_chlogin.init(),"introduce"==option_static.form&&(option_intro.init(),name_suggest.init(),city_suggest.init()),"desire"==option_static.form&&(option_tag.init(),tag_suggest.init())}}},option_tag={loaded:0,init:function(){$("#option_tag input").prop("disabled",!0),$("#option_tag_button").on("click",option_tag.action.send),option_tag.action.remind(),option_tag.ajax.load()},ajax:{load:function(){$.get("/tag/user/",option_tag.ajax.on_load)},on_load:function(a){a=json.parse(a),a.tags.length>0&&(option_tag.action.print(a.tags),user_tag.list=a.tags,user_tag.action.store()),$("#option_tag input").prop("disabled",!1)},add:function(a){$.post("/tag/add/",{tag:a},option_tag.ajax.on_save)},on_save:function(a){a=json.parse(a),a.id?(user_tag.list[user_tag.list.length-1].id=a.id,user_tag.option.set_count(),option_tag.action.remind()):option_tag.option.error(option_tag.loaded),$("#option_tag_value").val(""),user_tag.action.store()},del:function(a){$.post("/tag/del/",{id:a})}},action:{remind:function(){user_tag.list.length>0&&option_tag.action.print(user_tag.list)},send:function(){var a=$("#option_tag_value").val(),b={tag:a,id:0};user_tag.list.push(b),option_tag.action.remind(),option_tag.ajax.add(a)},set:function(){userinfo.data.contact[$(this).data("val")]=1*$(this).prop("checked")},print:function(a){$("#option_tag_list").empty();for(var b=0;b<a.length;b++){var c=$('<i class="desire_tag">').text(a[b].tag);a[b].id||c.addClass("desire_onload"),c.data("id",a[b].id),c.data("num",b),c.data("tag",a[b].tag),c.attr("id","utag"+b),c.on("click",option_tag.action.del),$("#option_tag_list").append(c)}},add:function(){option_tag.ajax.add($(this).data("tag")),option_tag.option.toggle(this),$(this).on("click",option_tag.action.del);var a={tag:$(this).data("tag"),id:$(this).data("id")};user_tag.list.splice($(this).data("num"),0,a)},del:function(){option_tag.ajax.del($(this).data("id")),option_tag.option.toggle(this),user_tag.list.splice($(this).data("num"),1),user_tag.option.set_count(),$(this).on("click",option_tag.action.add)},ids:function(){user_tag.idls=[];for(var a=0;a<user_tag.list;a++)user_tag.list[a].id&&user_tag.idls.push(user_tag.list[a].id);return user_tag.idls}},option:{toggle:function(a){$(a).off("click"),$(a).toggleClass("deleted_tag")},error:function(a){$("#utag"+[a]).off("click"),$("#utag"+[a]).toggleClass("error_tag")}}},profile_alert={init:function(){$("#profile_alert").on("click",profile_alert.option.hide)},option:{show:function(a){if(a){var b=$("#profile_alert");b.clearQueue(),b.html(a),$("#profile_alert").show("fade"),$("html, body").animate({scrollTop:0},"slow"),b.delay(5e3).queue(profile_alert.option.hide)}},hide:function(){var a=$("#profile_alert");a.clearQueue(),a.hide("fade"),a.delay(500).queue(profile_alert.option.clear)},clear:function(){$("#profile_alert").empty()}}},profile_option={init:function(){$("#profile_auth_button").on("click",profile_option.action.send_auth),$("#profile_send_pass").on("click",profile_option.action.send_pass),$("#profile_del_email").on("click",profile_option.action.del_email),$("#profile_subscr_send").on("click",profile_option.action.subscr)},ajax:{post:function(a,b){$.post("/option/auth/",{login:a,pass:b},profile_option.ajax.on_save)},on_save:function(a){a=json.parse(a),void 0!=a.err&&profile_alert.option.show(a.say)},send_pass:function(){$.post("/option/passend/",profile_option.ajax.alert)},del_email:function(){$.post("/option/demail/",profile_option.ajax.alert)},subscr:function(a){$.post("/option/subscr/",profile_option.ajax.error)},alert:function(a){a=json.parse(a),void 0!=a.err&&profile_alert.option.show(a.say)},error:function(a){a=json.parse(a),void 0!=a.err&&a.err>1&&profile_alert.option.show(a.say)}},action:{send_email:function(){option_email.ajax.post($("#profile_email_value").val())},send_auth:function(){profile_option.ajax.post($("#profile_login_value").val(),$("#profile_pass_value").val())},send_pass:function(){profile_option.ajax.send_pass()},del_email:function(){profile_option.ajax.del_email()},subscr:function(){var a=$("#subscr_status_on"),b=$("#subscr_status_off");"включены"==a.text()?(b.text("отключены"),a.text("")):(b.text(""),a.text("включены")),profile_option.ajax.subscr()}}},report={is_report:0,init:function(){$("#send_question").click(function(){report.show_quest()}),$("#send_report").click(function(){report.show_report()}),$("#send_reset").click(function(){report.hide()}),$("#report_text").unbind("click"),$("#hint_close").click(function(){report.hint_hide()})},show:function(){$("#report_send").off("click"),$("#report_block").show("blind")},hide:function(){$("#report_block").hide("blind")},show_quest:function(){report.show(),$("#report_send").val("Отправить вопрос"),$("#report_send").on("click",report.post_quest)},show_report:function(){report.show(),$("#report_send").val("Отправить отзыв"),$("#report_send").on("click",report.post_report)},hint_show:function(){$("#hint_block").show("blind")},hint_hide:function(){$("#hint_block").hide("fade")},post_quest:function(){report.hide();var a=$("#report_text").val();$.post("/mailer/post/",{mess:a,id:10336,hash:hash},report.on_post),report.hint_show()},post_report:function(){report.hide();var a=$("#report_text").val();$.post("/details.php?reviews",{text_reviews:a,hash:hash}),report.hint_show(),$("#report_text").val("")},on_post:function(a){if(!a)return 0;var b=JSON.parse(a);"reload"==b.error&&(location.href="/10336?text="+encodeURIComponent($("#report_text").val())),$("#report_text").val("")}},result_list={init:function(){},ajax:{load_visited:function(){$.get("/contact/visited/uid/",result_list.ajax.parse_visited)},parse_visited:function(a){a&&(result_list.visited=JSON.parse(a))}},action:{visited:function(a){a&&a.length&&$(".user").each(result_list.action.select)},select:function(a,b){var c=$(b).data("num")+"";c!=uid&&(visited.list.indexOf(c)<0?$("i",$(b)).addClass("list_user_new"):$("i",$(b)).removeClass("list_user_new"))}}},slider={timer:null,context:0,next:0,init:function(){return $("div").is("#top_intro_info_block")?($("#top_intro_info_block").on("mouseover",slider.stop),$("#top_intro_info_block").on("mouseout",slider.start),void setInterval(function(){var a=slider.next+1<5?slider.next+1:0,b=new Image;b.src="/img/board/top_intro_info_"+a+".jpg"},1e4)):null},slide:function(a,b){var c=[],d=[];d[0]="Позволит познакомиться с парнем или девушкой для секса, найти партнёра в соседнем подъезде или доме напротив. Знакомиться в собственном дворе или районе уже сегодня",c[0]="Уникальный способ знакомства",c[1]="Знакомства без регистрации",d[1]="Начинайте использовать всё и сразу, на полную, лишь только зайдя на сайт. Без подтверждений регистрации, без активации анкет. Лёгкий и быстрый поиск новых знакомств",c[2]="Секс знакомства без смс",d[2]="Ни номеров телефонов, ни подтверждений, ни смс. 100% анонимность, лёгкое и раскрепощённое общение. Онлайн обмен любыми фотографиями. E-mail адрес и всё остальное указывается по желанию",c[3]="Онлайн общение, интимные темы",d[3]="То что вы хотели спросить, то о чём вы хотели поговорить. Получайте прямо сейчас. Комфортное онлайн общение, интимные беседы, уютная обстановка и приятные собеседники уже ждут вас",c[4]="Секс знакомства бесплатно",d[4]="Здесь всё бесплатно. Вам доступны все сервисы сайта полностью, уже сейчас. Ваша анкета всегда наверху. Vip аккаунтов нет, открытый доступ ко всем анкетам и безграничные возможности",a>4&&(a=0);for(var e=0;e<5;e++)$("#board_img_"+e).removeClass("show"),$("#board_img_"+e).attr("src","");$("#board_img_"+a).addClass("show active"),$("#board_img_"+a).attr("src","/img/board/top_intro_info_"+a+".jpg"),slider.context&&($("#top_intro_info_block_caption").text(c[a]),$("#top_intro_info_block_context").text(d[a])),slider.next=a},start:function(){slider.timer=setInterval(function(){slider.slide(++slider.next,0)},2e4)},stop:function(){clearTimeout(slider.timer)}},storage={enable:0,init:function(){storage.is_enable()&&(storage.enable=1)},is_enable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},save:function(a,b){storage.enable&&localStorage.setItem(a,b)},load:function(a,b){var c=b?b:null;return storage.enable&&localStorage.getItem(a)&&(c=localStorage.getItem(a)),c},array:{load:function(a){var b=[],c=null;return c=storage.load(a),c=json.parse(c),c&&(b=c),b},save:function(a,b){storage.save(a,json.encode(b))},add:function(a,b){}}},city_suggest={click_enable:null,active_elem:null,timer_id:null,init:function(){return $(".city_suggest").length?void $(".city_suggest").each(function(a,b){b=$(b),b.data("active")||(b.on("mouseover",city_suggest.enabled),b.on("blur",city_suggest.blur),
b.on("keyup",city_suggest.ajax_load),b.attr("autocomplete","off"),b.wrap($('<div class="suggest_wrap">')),b.parent().append($('<div class="small_loader">')),b.parent().append($('<div class="suggest_block">')),b.data("active",1))}):null},enabled:function(){$(this).data("click")||($(this).on("click",city_suggest.ajax_load),$(this).data("click",1))},ajax_load:function(a){city_suggest.active_elem=$(this);var b=city_suggest.active_elem.val();$.get("/town/suggest/",{q:b,hash:hash},city_suggest.on_load)},on_load:function(a){if(a){var b=JSON.parse(a);b.cities&&(city_suggest.hide_suggest(),city_suggest.show_suggest(b.cities))}},blur:function(){$(".suggest_block").hide("fade")},hide_suggest:function(){$(".suggest_block").empty(),$(".suggest_block").hide()},show_suggest:function(a){for(var b="",c=city_suggest.active_elem.parent(),d=0;d<a.length;d++)a[d]&&(b=$('<div class="suggest_line" data-city="'+a[d]+'">').text(a[d]),b.on("click",city_suggest.print),$(".suggest_block",c).append(b));$(".suggest_line",c).length&&$(".suggest_block",c).show()},print:function(){city_suggest.active_elem.val($(this).data("city")),city_suggest.hide_suggest()}},name_suggest={click_enable:null,active_elem:null,timer_id:null,init:function(){return $(".name_suggest").length?void $(".name_suggest").each(function(a,b){b=$(b),b.data("active")||(b.on("mouseover",name_suggest.enabled),b.on("blur",name_suggest.blur),b.on("keyup",name_suggest.ajax_load),b.attr("autocomplete","off"),b.wrap($('<div class="suggest_wrap">')),b.parent().append($('<div class="small_loader">')),b.parent().append($('<div class="suggest_block">')),b.data("active",1))}):null},enabled:function(){$(this).data("click")||($(this).on("click",name_suggest.ajax_load),$(this).data("click",1))},ajax_load:function(a){name_suggest.active_elem=$(this);var b=name_suggest.active_elem.val();$.post("/ajax/name.php",{name:b,hash:hash},name_suggest.on_load)},on_load:function(a){if(a){var b=JSON.parse(a);b.names&&(name_suggest.hide_suggest(),name_suggest.show_suggest(b.names))}},blur:function(){$(".suggest_block").hide("fade")},hide_suggest:function(){$(".suggest_block").empty(),$(".suggest_block").hide()},show_suggest:function(a){for(var b="",c=name_suggest.active_elem.parent(),d=0;d<a.length;d++)a[d]&&(b=$('<div class="suggest_line" data-name="'+a[d]+'">').text(a[d]),b.on("click",name_suggest.print),$(".suggest_block",c).append(b));$(".suggest_line",c).length&&$(".suggest_block",c).show()},print:function(){name_suggest.active_elem.val($(this).data("name")),name_suggest.hide_suggest()}},tag_suggest={click_enable:null,active_elem:null,timer_id:null,init:function(){return $(".tag_suggest").length?void $(".tag_suggest").each(function(a,b){b=$(b),b.data("active")||(b.on("mouseover",tag_suggest.enabled),b.on("blur",tag_suggest.blur),b.on("keyup",tag_suggest.ajax_load),b.attr("autocomplete","off"),b.wrap($('<div class="suggest_wrap">')),b.parent().append($('<div class="small_loader">')),b.parent().append($('<div class="suggest_block">')),b.data("active",1))}):null},enabled:function(){$(this).data("click")||($(this).on("click",tag_suggest.ajax_load),$(this).data("click",1))},ajax_load:function(a){tag_suggest.active_elem=$(this);var b=tag_suggest.active_elem.val();$.post("/tag/suggest/",{tag:b,hash:hash},tag_suggest.on_load)},on_load:function(a){tag_suggest.hide_suggest(),a=json.parse(a),a.tags.length>0&&tag_suggest.show_suggest(a.tags)},blur:function(){$(".suggest_block").hide("fade")},hide_suggest:function(){$(".suggest_block").empty(),$(".suggest_block").hide()},show_suggest:function(a){for(var b="",c=tag_suggest.active_elem.parent(),d=0;d<a.length;d++)b=$('<div class="suggest_line" data-tag="'+a[d]+'">').text(a[d]),b.on("click",tag_suggest.print),$(".suggest_block",c).append(b);$(".suggest_line",c).length&&$(".suggest_block",c).show()},print:function(){tag_suggest.active_elem.val($(this).data("tag")),tag_suggest.hide_suggest()}},user_menu={init:function(){},ajax:{},action:{sets:{search:function(){var a="/index.php?view=simple&town="+userinfo.data.town+"&years_up="+userinfo.data.years_up+"&years_to="+userinfo.data.years_to+"&who="+userinfo.data.who;$("#menu_user_button_search").attr("href",a)},contact:function(){var a="/mail.php";$("#menu_message").attr("href",a)}}},option:{act:{show_reg:function(){$("#menu_user_action_new").show(),$("#menu_user_action_block").hide()},show_opt:function(){$("#menu_user_action_new").hide(),$("#menu_user_action_block").show()}},se:function(){}}},user_tag={list:[],idls:[],sync:0,count:0,init:function(){user_tag.list=storage.array.load("user_tag_list"),user_tag.sync=storage.load("sync_taglist"),user_tag.count=storage.load("user_tag_count")},action:{store:function(){storage.array.save("user_tag_list",user_tag.list),storage.save("user_tag_count",user_tag.count),storage.save("sync_taglist",user_tag.sync)},ids:function(){user_tag.idls=[];for(var a=0;a<user_tag.list.length;a++)user_tag.list[a].id&&user_tag.idls.push(user_tag.list[a].id);return user_tag.idls}},option:{set_count:function(){user_tag.list.length&&$("#user_desire_count").text(user_tag.list.length)}}},userinfo={data:{uid:0,sex:0,age:0,name:"",city:"",city_id:0,verify:0,name_mod:0,apromt:0,daily:0,town:"",who:0,years_up:0,years_to:0,virt:0,close:0,dating:"",setting:0,assist:0,intim:0,second:0,time:0,email:""},init:function(){userinfo.ajax.load()},ajax:{load:function(a){$.get("/sync/sess/",userinfo.ajax.on_load)},on_load:function(a){a=json.parse(a),a&&a.uid?(userinfo.data=a,userinfo.action.set_data(a),master_info.init()):(storage.save("auth",0),user_menu.option.act.show_reg(),userinfo.action.set_string())},save:{sex:function(a){$.post("/option/sex/",{sex:userinfo.data.sex},a)},age:function(a){$.post("/option/age/",{age:userinfo.data.age},a)},name:function(a){$.post("/option/name/",{name:userinfo.data.name},a)},city:function(a){$.post("/option/city/",{city:userinfo.data.city},a)}}},action:{set_data:function(a){storage.save("auth",a.uid),user_menu.option.act.show_opt(),user_menu.action.sets.search(),userinfo.action.set_sex(),userinfo.action.set_age(),userinfo.action.set_name(),userinfo.action.set_city(),userinfo.action.set_string()},set_name:function(){userinfo.data.name&&userinfo.data.name.length>2&&($(".user_name_option").text(userinfo.data.name),$(".name_suggest").val(userinfo.data.name)),userinfo.action.set_string()},set_age:function(a){userinfo.data.age>0&&$(".user_age_option").text(userinfo.data.age),a&&$(".user_age_say").text(a),userinfo.action.set_string()},set_city:function(){userinfo.data.city&&userinfo.data.city.length>3&&($(".user_city_option").text(userinfo.data.city),$(".city_suggest").val(userinfo.data.city)),userinfo.action.set_string()},set_sex:function(){var a;0==userinfo.data.sex?a="Парень или девушка":1==userinfo.data.sex?a="Парень":2==userinfo.data.sex&&(a="Девушка"),$(".user_sex_option").text(a)},set_string:function(){var a=userinfo.data.name?userinfo.data.name:"";userinfo.data.name||(1==userinfo.data.sex?a="Парень":2==userinfo.data.sex&&(a="Девушка"));var b=userinfo.data.city?userinfo.data.city.length:0;(userinfo.data.age>10||b>3)&&(a+=", "),userinfo.data.age>10&&(a=a+userinfo.data.age+" "),20-a.length-b>=0&&(a+=userinfo.data.city),a||(a="Кто вы?"),userinfo.data.uid?($(".user_string_option").text(a),storage.save("user_string_print",a)):$(".user_string_option").text("")},set_email:function(){$(".option_email_value").val(userinfo.data.email),$(".profile_email_value").text(userinfo.data.email)}}},visited={sync:0,list:[],init:function(){storage.enable&&(visited.list=storage.array.load("visitor_list"),result_list.action.visited(visited.list),visited.ajax.sync())},ajax:{sync:function(){$.get("/sync/visitor/"+uid+"/",visited.ajax.parse_sync)},parse_sync:function(a){a&&(visited.sync=JSON.parse(a),visited.action.check())},load:function(){$.get("/contact/visited/"+uid+"/",visited.ajax.on_load)},on_load:function(a){a&&(visited.list=JSON.parse(a),storage.array.save("visitor_list",visited.list),result_list.action.visited(visited.list))},save:function(a){$.get("/contact/addvisit/"+uid+"/",{tid:a},visited.ajax.parse_save)},parse_save:function(a){if(a){var b=1*JSON.parse(a);b&&(visited.sync=b,storage.save("visitor_sync",visited.sync))}}},index:function(a){var b=0;return visited.action.load_cache(),visited.list.length&&visited.list.indexOf(a+"")&&(b=1),b},action:{check:function(){visited.sync!=storage.load("visitor_sync")&&(visited.ajax.load(),storage.save("visitor_sync",visited.sync))},save:function(a){console.log("save",a),visited.list=storage.array.load("visitor_list"),visited.list.indexOf(a+"")<0&&(visited.list.push(json.encode(a)),storage.array.save("visitor_list",visited.list),visited.ajax.save(a))},load_cache:function(){storage.enable?visited.list=storage.array.load("visitor_list"):visited.list=[]}}};