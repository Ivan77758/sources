"use strict";function _possibleConstructorReturn(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function simple_hash(){var a=new Date;hash=a.getTime()}function disabled_with_timeout(a,b){a.prop("disabled",!0),setTimeout(function(){a.prop("disabled",!1)},1e3*b)}function get_cookie(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");return b?unescape(b[2]):null}function del_cookie(a){var b=new Date;b.setTime(b.getTime()-1e3),document.cookie=a+"=; expires="+b.toGMTString()+"; path=/"}function set_cookie(a,b,c){var d=new Date;d.setTime(d.getTime()+6e4*c),document.cookie=a+"="+b+"; expires="+d.toGMTString()+"; path=/"}var _get=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();Vue.component("account-activity",{props:["humanId"],data:function(){return{loading:!1}},mounted:function(){this.load()},computed:{human:function(){return this.$store.state.search.human},age:function(){return this.human.age?moment.duration(this.human.age,"years").humanize():null},tags:function(){return"tags"in this.human?this.human.tags:[]},social:function(){var a=this.human,b=a.em,c=a.vk,d=a.ok,e=a.fb,f=a.go;return b||c||d||e||f?{em:b,vk:c,ok:d,fb:e,go:f}:null},interact:function(){var a=this.human,b=a.ph,c=a.sk;return b||c?{ph:b,sk:c}:null},figure:function(){var a=this.human.anketa?this.human.anketa.figure:null,b=a;switch(a){case 2:b="спортивного";break;case 3:b="обычного";break;case 5:b="полного";break;case 6:b="худого"}return b},hold:function(){return this.ignore?0:this.human.hold},who:function(){var a="Парня или девушку ";return this.human.who&&(a=1==this.human.who?"Парня ":"Девушку "),(this.human.up||this.human.to)&&(a+=" в возрасте ",a+=this.human.up?" от "+this.human.up:"",a+=this.human.to?" до "+this.human.to:"",a+=" лет "),a},ago:function(){var a=this.human.last,b="Онлайн";return a>2592e3&&(b=null),a>777&&(b=moment.duration(0-a,"seconds").humanize(!0)),b}},methods:{close:function(){this.$emit("close")},loaded:function(){this.loading=!1,console.log(this.human)},hope:function(){var a=this;setTimeout(function(){return a.loading=!1},4e3)},load:function(){var a=this;this.loading=!0,this.hope(),store.dispatch("HUMAN",this.humanId).then(function(b){a.loaded()}).catch(function(b){console.log(b),a.loading=!1})}},template:"#account-activity"});var DefaultActivity=Vue.component("closed-activity",{props:["show"],methods:{close:function(){this.$emit("close")}},template:"#closed-activity"}),DefaultActivity=Vue.component("default-activity",{props:["show"],methods:{close:function(){this.$emit("close")}},template:"#default-activity"});Vue.component("messages-activity",{props:["humanId","title"],data:function(){return{message:"",reply:"",code:"",show:!0,process:!1,approve:!0,dirt:!1,captcha:!1,account:!1,uploads:!1,incoming:!1,preview:!1,photo:!1}},mounted:function(){},methods:{reset:function(){this.show=!0,this.process=!1,this.approve=!0,this.message=""},isDirt:_.debounce(function(){var a=/\w{0,5}[хx]([хx\s\!@#\$%\^&*+-\|\/]{0,6})[уy]([уy\s\!@#\$%\^&*+-\|\/]{0,6})[ёiлeеюийя]\w{0,7}|\w{0,6}[пp]([пp\s\!@#\$%\^&*+-\|\/]{0,6})[iие]([iие\s\!@#\$%\^&*+-\|\/]{0,6})[3зс]([3зс\s\!@#\$%\^&*+-\|\/]{0,6})[дd]\w{0,10}|[сcs][уy]([уy\!@#\$%\^&*+-\|\/]{0,6})[4чkк]\w{1,3}|\w{0,4}[bб]([bб\s\!@#\$%\^&*+-\|\/]{0,6})[lл]([lл\s\!@#\$%\^&*+-\|\/]{0,6})[yя]\w{0,10}|\w{0,8}[её][bб][лске@eыиаa][наи@йвл]\w{0,8}|\w{0,4}[еe]([еe\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[uу]([uу\s\!@#\$%\^&*+-\|\/]{0,6})[н4ч]\w{0,4}|\w{0,4}[еeё]([еeё\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[нn]([нn\s\!@#\$%\^&*+-\|\/]{0,6})[уy]\w{0,4}|\w{0,4}[еe]([еe\s\!@#\$%\^&*+-\|\/]{0,6})[бb]([бb\s\!@#\$%\^&*+-\|\/]{0,6})[оoаa@]([оoаa@\s\!@#\$%\^&*+-\|\/]{0,6})[тnнt]\w{0,4}|\w{0,10}[ё]([ё\!@#\$%\^&*+-\|\/]{0,6})[б]\w{0,6}|\w{0,4}[pп]([pп\s\!@#\$%\^&*+-\|\/]{0,6})[иeеi]([иeеi\s\!@#\$%\^&*+-\|\/]{0,6})[дd]([дd\s\!@#\$%\^&*+-\|\/]{0,6})[oоаa@еeиi]([oоаa@еeиi\s\!@#\$%\^&*+-\|\/]{0,6})[рr]\w{0,12}/i;return this.dirt=!!a.test(this.message),this.dirt},700),close:function(){this.$emit("close")},cancel:function(){this.captcha=!1,this.confirm=!1,this.ignore=!0,console.log("cancel")},select:function(a){this.photo=a,this.preview=a},sendMessage:function(){var a=this,b={id:this.humanId,captcha_code:this.code};this.photo&&this.photo.alias?b.photo=this.photo.alias:(b.mess=this.message,b.re=this.reply),api.messages.send(b).then(function(b){a.onMessageSend(b.data)}).catch(function(){a.onError()}),this.preview=null,this.process=!0},setCode:function(a){this.code=a,this.sendMessage()},onMessageSend:function(a){!a.saved&&a.error?("need_captcha"==a.error&&(this.captcha=!0),this.onError()):this.sended(a),this.process=!1},sended:function(a){this.$refs.messages.reload(),giper_chat.timer_cut(),this.reset()},onError:function(){this.process=!1},videochat:function(){window.open("/videochat.php?to="+this.humanId,"videochat","width=432, height=280, resizable=yes, scrollbars=yes")}},template:"#messages-activity"}),Vue.component("search-activity",{props:[],data:function(){return{loading:!1,users:[],response:null,error:0,next:null,newCount:0,batch:15,received:0,attention:!1,toSlow:!1,humanId:null,account:null,sended:!1}},mounted:function(){this.load(),this.visitedSync()},computed:{more:function(){return!(!this.received||this.received!=this.batch)},visited:function(){return this.$store.state.visited.list},accept:function(){return this.$store.state.accepts.search}},methods:{close:function(){this.$emit("close")},reload:function(){this.next=0,this.users=[],this.load()},visitedSync:function(){this.$store.dispatch("visited/SYNC")},load:function(){var a=this;this.response=0;var b=this.$store.state.search.settings,c=b.who,d=b.city,e=b.up,f=b.to,g=this.$store.state.user.sex,h=this.next;e=e||null,f=f||null,api.search.load({sex:g,who:c,city:d,up:e,to:f,next:h}).then(function(b){a.onLoad(b.data)})},loadNext:function(){this.load()},onLoad:function(a){var b=a.users;this.received=b?b.length:0,b||this.users.length?(this.received&&(this.users=_.union(this.users,b)),this.next+=this.batch):this.noResult(),this.response=200,this.toSlow=!1},openMessage:function(a){this.humanId=a},noResult:function(){},old:function(a){return _.contains(this.visited,a)},approve:function(){this.$store.commit("accepts/search")}},template:"#search-activity"}),Vue.component("search-item",{props:["human","visited"],data:function(){return{first:null,second:null,third:null,social:{first:["em","ok","vk","fb","go","sk","ph"],second:["vk","ok","fb","go","sk","ph"],third:["sk","ph","em","ok","vk","fb","go"]}}},mounted:function(){var a=this;_.find(_.pick(this.human,this.social.first),function(b,c){return!!b&&(a.first=c)}),_.find(_.pick(this.human,this.social.second),function(b,c){return!!(b=a.first!=c&&b)&&(a.second=c)}),_.find(_.pick(this.human,this.social.second),function(b,c){return b=a.first!=c&&b,!!(b=a.second!=c&&b)&&(a.third=c)})},computed:{search:function(){var a="парня или девушку ";return this.human.who&&(a=1==this.human.who?"парня ":"девушку "),a="Ищет "+a,(this.human.up||this.human.to)&&(a+=this.human.up?" от "+this.human.up:"",a+=this.human.to?" до "+this.human.to:"",a+=" лет "),a},name:function(){var a=1==this.human.sex?"Парень":"Девушка";return this.human.name?this.human.name:a},tags:function(){return this.human.tags.length},differ:function(){return result=!1,this.human.who&&this.human.who!=this.$store.state.user.sex&&(result=!0),result}},methods:{close:function(){this.$emit("close")},load:function(){var a=this;api.search.load(null).then(function(b){a.users=b.data.users})}},template:"#search-item"}),Vue.component("api-key-update",{props:["item"],data:function(){return{showOption:!1}},methods:{upKey:function(){var a=this;console.log("upKey"),axios.get("/sync/sess/").then(function(b){a.$store.dispatch("LOAD_API_TOKEN"),a.upUser(b.data),a.upSettings(b.data)})},upUser:function(a){var b=a.uid,c=a.city,d=a.sex,e=a.age,f=a.name,g=a.contacts;console.log("upUser",a),this.$store.commit("resetUser",{uid:b,city:c,sex:d,age:e,name:f,contacts:g})},upSettings:function(a){var b=a.who,c=a.years_up,d=a.years_to,e=a.close,f=a.virt;this.$store.commit("settings",{who:b,up:c,to:d,virt:f,town:e})}},mounted:function(){var a=this;this.upKey(),setInterval(function(){a.upKey()},6e5)},template:"#api-key-update"}),Vue.component("attention-wall",{props:["show","text"],data:function(){return{content:{1:{caption:"Предупреждение",text:"На сообщения от этого пользователя поступают жалобы. Возможно его сообщения имеют грубый тон,\n                    могут оскорбить, содержат интим фотографии, бессмысленные или резкие предложения."},8:{caption:"Внимание",text:"Действия пользователя нарушают правила. Сообщения пользователя намеренно оскорбительны,\n                    имеют противоправное содержание, обман или предложение оплаты услуг."}}}},computed:{caption:function(){return this.content[this.show].caption},text:function(){return this.content[this.show].text}},methods:{close:function(){this.$emit("close")},remove:function(){this.$emit("remove"),this.close()}},template:"#attention-wall"}),Vue.component("captcha-dialog",{data:function(){return{code:"",inc:0}},computed:{src:function(){return"/secret_pic.php?inc="+this.inc}},methods:{close:function(){this.$emit("cancel")},send:function(){this.$emit("send",this.code),this.update(),this.close()},update:function(){this.inc++}},template:"#captcha-dialog"}),Vue.component("city-suggest",{props:["value"],data:function(){return{query:"",cities:[],enable:!0}},mounted:function(){this.value&&this.value.length>2&&(this.query=this.value)},computed:{suggested:function(){return this.cities.length}},methods:{load:function(){var a=this;if(!this.query.length)return this.reset();api.user.get({q:this.query,hash:hash},"town/suggest").then(function(b){a.loaded(b.data.cities)})},reset:function(){this.cities=[]},select:function(a){this.query=a,this.$emit("select",a),this.reset()},loaded:function(a){a&&a.length?this.cities=a:this.reset()}},template:"#city-suggest"});var ContactDialog={props:["quick"],data:function(){return{response:!1,slow:!1,error:!1,amount:0,offset:0,batch:10,max:100,dialog:!1}},computed:{showLoader:function(){return this.slow&&!this.response},showAlert:function(){return this.error&&this.response},showHint:function(){return this.count<1},count:function(){return this.contacts?this.contacts.length:0},more:function(){var a=this.offset<=this.max-this.batch;return this.amount>=this.batch&&a}},methods:{close:function(){this.$emit("close")},reset:function(){this.response=!1,this.error=!1,this.slow=!1},hope:function(){var a=this;setTimeout(function(){return a.slow=!0},2e3),this.reset()},loaded:function(a){this.offset+=this.batch,this.amount=this.count,this.response=!0,this.slow=!1},bun:function(a){var b=this.contacts[a];console.log("bun",b),this.remove(a)},splice:function(a){this.$store.commit("delete",a)},error:function(a){this.response=!0,this.error=!0,console.log(a)},dialogOpen:function(a){this.dialog=a.id,this.title=a.title}},mounted:function(){this.load()}},InitialDialog=Vue.component("initial-dialog",{extends:ContactDialog,computed:{initial:function(){return!0},simple:function(){return!0},contacts:function(){return this.$store.state.contacts.initial.list}},methods:{load:function(){var a=this;this.$store.dispatch("initial/LOAD").then(function(b){a.loaded()}),this.amount=this.count,this.hope()},next:function(){var a=this;this.$store.dispatch("initial/NEXT",this.offset).then(function(b){a.loaded()}),this.reset()},remove:function(a){this.$store.dispatch("initial/DELETE",a)},read:function(a){console.log("initial=read",a),this.$store.dispatch("initial/READ",a)},splice:function(a){this.$store.commit("initial/delete",a)}},template:"#initial-dialog"}),IntimateDialog=Vue.component("intimate-dialog",{extends:ContactDialog,data:function(){return{max:100}},computed:{initial:function(){return!0},simple:function(){return!1},contacts:function(){return this.$store.state.contacts.intimate.list}},methods:{load:function(){var a=this;this.$store.dispatch("intimate/LOAD",this.next).then(function(b){a.loaded()}).catch(function(b){return a.error=b}),this.amount=this.count,this.hope()},next:function(){var a=this;this.$store.dispatch("intimate/NEXT",this.offset).then(function(b){a.loaded()}),this.hope()},remove:function(a){console.log("imm=remove",a),this.$store.dispatch("intimate/DELETE",a)},read:function(a){console.log("intimate=read",a),this.$store.dispatch("intimate/READ",a)},splice:function(a){this.$store.commit("intimate/delete",a)}},template:"#intimate-dialog"}),SendsDialog=Vue.component("sends-dialog",{extends:ContactDialog,computed:{initial:function(){return!1},simple:function(){return!1},contacts:function(){return this.$store.state.contacts.sends.list}},methods:{load:function(){var a=this;this.$store.dispatch("sends/LOAD",this.next).then(function(b){a.loaded()}),this.amount=this.count,this.hope()},next:function(){var a=this;this.$store.dispatch("sends/NEXT",this.offset).then(function(b){a.loaded()}),this.reset()},remove:function(a){this.$store.dispatch("sends/DELETE",a)},splice:function(a){this.$store.commit("sends/delete",a)}},template:"#initial-dialog"});Vue.component("contact-item",{props:["item","index","quick"],data:function(){return{account:!1,detail:!1,confirm:!1}},computed:{name:function(){var a="Парень или девушка";return this.item.user&&(a=2==this.item.user.sex?"Девушка":"Парень",this.item.user.name&&(a=this.item.user.name)),a},age:function(){return this.item.user&&this.item.user.age?this.item.user.age:""},city:function(){return this.item.user&&this.item.user.city?this.item.user.city:""},title:function(){return this.name+" "+this.age+" "+this.city},message:function(){return this.item.message?this.item.message.text:""},unread:function(){return this.item.message?this.item.message.unread:0},sent:function(){return this.item.message?this.item.message.sender==this.$store.state.user.uid:0},humanId:function(){return this.item.human_id}},methods:{show:function(){this.quick?this.reply():this.dialog()},confirmBun:function(){this.confirm="doit"},dialog:function(){this.$emit("read",this.index),this.$emit("dialog",{id:this.humanId,title:this.title})},confirmRemove:function(){this.confirm=this.quick?"must":"some"},reply:function(){this.detail=!0,this.$emit("read",this.index)},close:function(){this.detail=!1,console.log("close")},bun:function(){console.log("bun1",this.index),this.$emit("bun",this.index)},remove:function(){console.log("remove=remove",this.index),this.$emit("remove",this.index)},cancel:function(){this.confirm=!1,console.log("cancel")},sended:function(){this.$emit("sended",this.index),this.close()}},template:"#contact-item"}),Vue.component("desire-tag-item",{props:["id","tag"],data:function(){return{active:!1,error:!1}},methods:{select:function(){this.$emit("select")}},template:"#desire-tag-item"}),Vue.component("email-sended",{template:"#email-sended"}),Vue.component("inform-dialog",{props:["loader","alert","hint"],computed:{hasContext:function(){return!!this.$slots.context},hasHint:function(){return!!this.$slots.hint}},methods:{close:function(){this.$emit("close")}},template:"#inform-dialog"}),Vue.component("intro-info",{data:function(){return{slide:1}}}),Vue.component("loading-cover",{props:["show","text"],computed:{loader:function(){return this.text?this.text:"Отправляю"}},template:"#loading-cover"}),Vue.component("loading-wall",{props:["show","text"],data:function(){return{hope:!1}},computed:{loader:function(){return this.text?this.text:"Загружаем"}},mounted:function(){var a=this;this.hope=!1,setTimeout(function(){return a.hope=!0},3e3)},template:"#loading-wall"}),Vue.component("menu-user",{data:function(){return{message:8,contact:8}},store:store,computed:{authorized:function(){return store.state.user.uid>0?1:0},newMessage:function(){return 0==this.message||this.message<8},newContact:function(){return 0==this.contact||this.contact<8},signature:function(){var a="Кто вы?",b=this.$store.state.user,c=b.name,d=b.city,e=b.age,f=b.sex;return f&&(a=1==f?"Парень":"Девушка",a=c||a),a+" "+(e||"")+" "+(d||"")}},methods:{initial:function(){var a=this;console.log("initial"),store.commit("showInitial",1),axios.get("/mailer/check_contact").then(function(){a.contact=8})},intimate:function(){var a=this;store.commit("showIntimate",1),axios.get("/mailer/check_message").then(function(){a.message=8})},loadStatus:function(){var a=this;axios.get("/mailer/status").then(function(b){a.message=b.data.message,a.contact=b.data.contact})},account:function(){this.$emit("account")},login:function(){this.$emit("login")},regmy:function(){window.location="/?regmy"}},mounted:function(){var a=this;this.loadStatus(),setInterval(function(){a.loadStatus()},15e3)}});var fdate=null,prev=null;Vue.component("message-item",{props:["item","index","count","alert","first_date"],template:"#messages-item",data:function(){return{showOption:!1,fixOption:!1,alertOption:!1,showDialog:!1,photo:!1}},methods:{fix:function(){this.showOption=!0,this.alertOption=!1,this.alert?this.$emit("admit"):this.fixOption=!this.alert&&!this.fixOption},bun:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken}},c={id:this.item.id,tid:this.item.from};axios.post("/mess/bun/",c,b).then(function(b){a.$emit("remove",a.index)}).catch(function(a){console.log("error")})},cancel:function(){this.showDialog=!1,console.log("cancel")},remove:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken}},c={id:this.item.id};axios.post("/mess/delete/",c,b).then(function(b){a.$emit("remove",a.index)}).catch(function(a){console.log(a)}),console.log("remove")},play:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{tid:this.item.from}},c=this.$store.state.photoServer,d="http://"+c+"/api/v1/users/"+this.uid+"/sends/"+this.alias+".jpg";axios.get(d,b).then(function(b){a.preview(b.data.photo)}).catch(function(a){console.log(a)})},preview:function(a){var b=a._links;b.origin.href&&(this.photo={thumb:b.thumb.href,photo:b.origin.href,alias:a.alias,height:a.height,width:a.width})},pathName:function(a){return!a||a.length<10?null:[a.substr(0,2),a.substr(2,2),a.substr(4,3)].join("/")+"/"+a}},mounted:function(){!this.sent&&!this.index&&this.count<5&&(this.fix(),this.alertOption=!0),this.sent||this.read||this.$emit("set-new")},beforeUpdate:function(){},computed:{uid:function(){return this.$store.state.user.uid},attention:function(){return this.alert||this.alertOption?1:0},option:function(){return!(this.index||!this.alert)||(this.showOption||this.fixOption?1:0)},sent:function(){return this.uid&&this.uid!=this.item.from?0:1},read:function(){return 0!=this.item.read},time:function(){return moment(this.item.date).format("HH:mm")},date:function(){var a=moment(this.item.date),b=a.date(),c=fdate;fdate=b,b=fdate==c?"":fdate;var d=moment().date(),e=moment().subtract(1,"day").date();return b=b===d?"Сегодня":b,b=b===e?"Вчера":b,a=a.date()+" "+a.format("MMMM").substring(0,3),b=_.isString(b)?b:a,b},alias:function(){var a=!1,b=this.item.mess,c=/.+images.intim?.(.{32})\.(jpg)/i,d=/\[\[IMG:(.{32})\]\]/i;return a=!!c.test(b)&&c.exec(b),a=!a&&d.test(b)?d.exec(b):a,a&&(a=a[1]),a},image:function(){var a=this.$store.state.photoServer,b=this.pathName(this.alias);return!!b&&"http://"+a+"/res/photo/preview/"+b+".png"},previous:function(){var a=prev;return prev=this.item.from,!a||a==prev}}}),Vue.component("message-list",{props:["humanId"],data:function(){return{messages:[],response:null,error:0,next:0,newCount:0,batch:15,received:0,attention:!1,uid:null,date:null,toSlow:!1,skipScroll:!1}},mounted:function(){this.load()},methods:{reload:function(){this.next=0,this.newCount=0,this.messages=[],this.load(),fdate=null,prev=null},load:function(){var a=this;this.response=0;var b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{id:this.humanId,next:this.next,hash:hash}};axios.get("/ajax/messages_load.php",b).then(function(b){a.onLoad(b)}).catch(function(b){a.error=10,console.log(b)}),setTimeout(function(){return a.toSlow=!0},7e3)},loadNext:function(){this.skipScroll=!0,this.load()},onLoad:function(a){var b=this,c=a.data.messages;this.received=c?c.length:0,c||this.messages.length?(this.received&&(this.messages=_.union(this.messages,c)),this.next+=this.batch):this.noMessages(),this.response=200,this.toSlow=!1,this.$nextTick(function(){b.scroll()})},scroll:function(){if(this.skipScroll)return this.skipScroll=!1;var a=document.getElementById("dialog-history");a.scrollTop=a.scrollHeight+30},noMessages:function(){store.commit("intimated",!1)},setDate:function(a){},remove:function(a){console.log("remove("+a+")"),this.messages.splice(a,1)},admit:function(){console.log("itOk false"),this.attention=!1},setNew:function(){console.log("new"),this.newCount+=1}},computed:{items:function(){return this.messages.slice().reverse()},more:function(){return!(!this.received||this.received!=this.batch)},uid:function(){return(void 0).store.user.uid}},template:"#message-list"}),Vue.component("modal-dialog",{methods:{close:function(){this.$emit("close")}},mounted:function(){var a=this;document.addEventListener("keydown",function(){a.show&&27===event.keyCode&&a.close()})},template:"#modal-dialog"}),Vue.component("modal-super",{template:"#modal-super"}),Vue.component("option-dialog",{template:"#option-static__dialog-window",methods:{close:function(){this.$emit("close")}},created:function(){var a=this;document.addEventListener("keydown",function(){a.show&&27===event.keyCode&&a.close()})},updated:function(){this.show&&$("html, body").animate({scrollTop:0},"slow")}}),Vue.component("photo-send",{props:["photo","options"],data:function(){return{remove:!1}},methods:{close:function(){this.$emit("close")}},template:"#photo-send"}),Vue.component("photo-view",{props:["photo","thumb","maxWidth","bypass"],methods:{approve:function(){this.$store.commit("accepts/photo")},close:function(){this.$emit("close")}},computed:{accept:function(){return!(!this.$store.state.accepts.photo&&!this.bypass)}},template:"#photo-view"}),Vue.directive("resized",{bind:function(a){$(a).on("change",function(){a.style.height="1px",a.style.height=a.scrollHeight+"px"})},componentUpdated:function(a){$(a).change()}});var QuickMessage=Vue.component("quick-message",{props:["humanId"],data:function(){return{text:"",account:0,captcha:!1,process:!1,loading:!1,confirm:!1,ignore:!1,code:null}},computed:{human:function(){return this.$store.state.search.human},user:function(){return this.$store.state.user},tags:function(){return"tags"in this.human?this.human.tags:[]},hold:function(){return this.ignore?0:this.human.hold},warning:function(){var a="",b={1:"парни",2:"девушки"};if(this.human.close&&this.user.city&&this.user.city!=this.human.city&&(a="Мне интересно общение только в моём городе"),this.human.who&&this.human.who!=this.user.sex)a="Мне интересны только "+b[this.human.who];else if(this.human.who){var c=this.user.age;this.human.up&&c&&this.human.up>c&&(a="Мне интересны "+b[this.human.who]+" в возрасте от "+this.human.up+" лет "),this.human.to&&c&&this.human.to<c&&(a="Мне интересны "+b[this.human.who]+" в возрасте до "+this.human.to+" лет ")}return this.user.age||(a="Укажите ваш возраст в анкете, для меня это важно"),this.user.city||(a="Укажите ваш город в анкете, для меня это важно"),a}},mounted:function(){this.reload()},methods:{reload:function(){var a=this;this.loading=!0,setTimeout(function(){return a.loading=!1},4e3),store.dispatch("HUMAN",this.humanId).then(function(b){a.loaded()}).catch(function(b){console.log(b),a.loading=!1}),console.log("reload*reload")},loaded:function(){this.loading=!1,this.visited()},close:function(){this.$emit("close")},remove:function(){console.log("::remove:: (!)"),this.$emit("remove")},cancel:function(){this.captcha=!1,this.confirm=!1,this.ignore=!0,console.log("cancel")},inProcess:function(a){var b=this;this.process=!0,setTimeout(function(){return b.process=!1},1e3*a)},send:function(){var a=this,b={id:this.humanId,mess:this.text,captcha_code:this.code};api.messages.send(b).then(function(b){a.onMessageSend(b.data)}).catch(function(b){a.onError(b)}),this.inProcess(5)},setCode:function(a){this.code=a,this.send()},onMessageSend:function(a){!a.saved&&a.error?("need_captcha"==a.error&&(this.captcha=!0),this.onError()):this.sended(),this.process=!1},sended:function(){this.$emit("sended"),this.close()},onError:function(){this.process=!1},visited:function(){this.$store.dispatch("visited/ADD",this.humanId)}},template:"#quick-message"});Vue.component("quick-reply",{props:["humanId","message"],extends:QuickMessage,template:"#quick-reply"}),Vue.component("quick-write",{props:["humanId"],data:function(){return{account:!1,open:!1,sended:!1}},template:"#quick-write"}),Vue.component("remind-login",{data:function(){return{email:"",hint:"Введите ваш емайл",confirm:!1}},computed:{},methods:{close:function(){this.$emit("close")},send:function(){var a=this;this.email&&(this.hint="Отправляю...",api.user.post({email:this.email},null,"sync/remind").then(function(b){a.hint=b.data.say,a.error=b.data.err,a.sended()}))},sended:function(){this.error||(this.hint="Успешно. Подождите.",this.confirm=!0)}},template:"#remind-login"});var RemoveConfirm=Vue.component("remove-confirm",{props:["show","item"],data:function(){return{content:{doit:{caption:"Наказывайте как следует",text:"За резкие слова, за оскорбления или хамство,\n                    за фотографии не в тему или бессмысленные сообщения, наказывайте всех, кого\n                    считаете нужным. Наказание действует сразу.",action:"Удалить и наказать"},must:{caption:"Может стоит наказать?",text:'Нажмите "Дизлайк" у сообщения или контакта, которое вызвало негативные эмоции.\n                    Наказание действует сразу же. Мы никогда не узнаем о нарушениях, если удалить без наказания.',action:"Удалить и забыть"},some:{caption:"Удалить навсегда",text:"Ваше сообщение будет удалено отовсюду, без возможности восстановить. Сообщение\n                    пропадет как из вашей истории переписки, так и из переписки вашего собеседника.",action:"Удалить навсегда"}}}},computed:{variant:function(){return this.show?this.show:"some"},caption:function(){return this.content[this.variant].caption},text:function(){return this.content[this.variant].text},action:function(){return this.content[this.variant].action}},methods:{close:function(){this.$emit("close")},bun:function(){console.log("bun0"),this.$emit("bun"),this.close()},remove:function(){this.$emit("remove"),this.close()}},template:"#remove-confirm"});Vue.component("remove-contact",{extends:RemoveConfirm,data:function(){return{content:{some:{caption:"Удалить навсегда",text:"Контакт будет удален без возможности восстановить. Дальнейшее общение с собеседником станет невозможно.\n                    Обменивайтесь реальными контактами с теми кто вам интересен всегда.",action:"Удалить навсегда"}}}},methods:{remove:function(){this.$emit("remove"),this.close()}},template:"#remove-confirm"}),Vue.component("search-wizard",{data:function(){return{}},store:store,computed:Vuex.mapState({range:function(a){var b=a.search.settings,c="";return b.up&&b.to?c=b.up+" - "+b.to:b.up&&!b.to?c=" от "+b.up:!b.up&&b.to&&(c=" до "+b.to),c?" в возрасте "+c+" лет ":""},who:function(a){var b=a.search.settings,c=" знакомства с кем угодно ";return b.who&&(c=1==b.who?" знакомства с парнем ":" знакомства с девушкой "),c},say:function(a){var b=a.user.city?"":", из любого города ";return this.who+this.range+b}}),mounted:function(){}}),Vue.component("about-settings",{props:[],data:function(){return{inputGrowth:"",inputWeight:"",selectFigure:null,process:!1,virgin:!0}},computed:Vuex.mapState({growth:function(a){return a.about.growth},weight:function(a){return a.about.weight},figure:function(a){return a.about.figure}}),mounted:function(){var a=this;this.$store.dispatch("about/SYNC").then(function(){a.init(),a.process=!1}).catch(function(){a.process=!1}),this.process=!0,this.init()},methods:{init:function(){this.inputGrowth=this.growth?this.growth:"",this.inputWeight=this.weight?this.weight:"",this.selectFigure=this.figure},deflower:function(){this.virgin=!1},close:function(){this.save(),this.$emit("close")},save:function(){this.virgin||this.$store.dispatch("about/SAVE",{growth:this.inputGrowth,weight:this.inputWeight,figure:this.selectFigure})}},template:"#about-settings"}),Vue.component("account-settings",{props:[],data:function(){return{selectCity:"",selectSex:0,selectAge:0,selectName:""}},computed:Vuex.mapState({sex:function(a){var b=Number(a.user.sex);return b?1==b?1:2:0},city:function(a){return a.user.city},age:function(a){return a.user.age},name:function(a){var b=[];b[1]=["Саша","Дима","Сергей","Иван","Максим","Валера","Николай"],b[2]=["Оля","Юля","Настя","Алена","Катя","Маргарита","Татьяна"];var c=Math.floor(7*Math.random()),d=a.user.name,e=this.sex?b[this.sex][c]:"";return d||e}}),mounted:function(){this.selectCity=this.city,this.selectSex=this.sex,this.selectAge=this.age,this.selectName=this.name},methods:{saveSex:function(){this.$store.dispatch("SAVE_SEX",this.selectSex),this.resetName()},saveCity:function(a){this.$store.dispatch("SAVE_CITY",a)},saveAge:function(){this.$store.dispatch("SAVE_AGE",this.selectAge)},saveName:function(){this.$store.dispatch("SAVE_NAME",this.selectName)},resetName:function(){this.selectName=this.name},save:function(){this.saveName()},close:function(){this.save(),this.$emit("close")},login:function(){this.$emit("login"),this.$emit("close")},settings:function(){this.$emit("settings")}},template:"#account-settings"}),Vue.component("desires-settings",{props:[],data:function(){return{process:!1,desire:"",confirmRemove:null}},computed:Vuex.mapState({tags:function(a){return a.desires.list}}),mounted:function(){var a=this;this.process=!0,this.$store.dispatch("desires/SYNC").then(function(b){a.process=!1})},methods:{close:function(){this.$emit("close")},add:function(a){var b=this;this.process=!0,this.$store.dispatch("desires/ADD",a).then(function(a){b.process=!1})},remove:function(){this.$store.dispatch("desires/DELETE",this.confirmRemove),this.confirmRemove=null}},template:"#desires-settings"}),Vue.component("incoming-photo",{props:["humanId"],data:function(){return{photos:[],user:0,server:null,preview:null}},created:function(){this.server=this.$store.state.photoServer},mounted:function(){this.loadPhoto()},computed:{uid:function(){return this.$store.state.user.uid}},methods:{loadPhoto:function(){var a=this,b={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{tid:this.humanId,hash:hash}};axios.get("http://"+this.server+"/api/v1/users/"+this.uid+"/sends",b).then(function(b){a.photos=b.data.photos}).catch(function(a){console.log(a)})},show:function(a){var b=this.photos[a],c=b._links;if(c.origin.href){var d={thumb:c.thumb.href,photo:c.origin.href,alias:b.alias,height:b.height,width:b.width};this.preview=d}},close:function(){this.$emit("close")}},template:"#incoming-photo"}),Vue.component("login-account",{props:[],data:function(){return{login:"",password:"",captcha:!1,code:"",error:!1,remind:!1,hint:"Введите данные"}},
computed:Vuex.mapState({city:function(a){return a.user.city}}),mounted:function(){},methods:{close:function(){this.$emit("close")},send:function(){var a=this,b={login:this.login,pass:this.password,captcha:this.code};api.user.post(b,null,"sync/login").then(function(b){a.hint=b.data.say,a.error=b.data.err,a.captcha=b.data.captcha,a.onLogin()})},onLogin:function(){this.$refs.captcha.update(),this.error||(this.hint="Успешно. Подождите.",location.href=location.href)},setCode:function(a){this.code=a}},template:"#login-account"}),Vue.component("other-settings",{props:[],data:function(){return{}},computed:Vuex.mapState({uid:function(){return this.$store.state.user.uid}}),methods:{close:function(){this.$emit("close")},logout:function(){window.location="/logout.php"}},template:"#other-settings"}),Vue.component("photo-settings",{data:function(){return{photos:[]}},computed:Vuex.mapState({}),mounted:function(){console.log("fileupload");var a=this;$("#fileupload").fileupload({dataType:"json",add:function(b,c){var d=a.$store.state.photoServer,e=a.$store.state.user.uid;c.url="http://"+d+"/api/v1/users/"+e+"/photos?jwt="+a.$store.state.apiToken,c.submit()},done:function(b,c){a.preview(c.result.photo)}}),this.loadPhoto()},methods:{close:function(){this.$emit("close")},loadPhoto:function(){var a=this,b=this.$store.state.photoServer,c=this.$store.state.user.uid,d={headers:{Authorization:"Bearer "+this.$store.state.apiToken},params:{hash:hash}};axios.get("http://"+b+"/api/v1/users/"+c+"/photos",d).then(function(b){var c=b.data.photos;c&&c.length&&(a.photos=b.data.photos),console.log(a.photos)}).catch(function(a){console.log(a)})},upload:function(a){$("#fileupload").click()},show:function(a){this.preview(this.photos[a])},preview:function(a){var b=a._links;if(b.origin.href){var c={photo:b.origin.href,thumb:b.thumb.href,alias:a.alias,height:a.height,width:a.width};this.$emit("select",c)}this.close()}},template:"#photo-settings"}),Vue.component("search-settings",{data:function(){return{ageRange:[0,16,17,18,20,23,25,27,30,35,40,45,50,60,80],selectWho:0,selectUp:0,selectTo:0,selectCity:"",checkedTown:0,checkedVirt:0}},computed:Vuex.mapState({who:function(a){var b=Number(a.search.settings.who);return b?1==b?1:2:0},city:function(a){return a.user.city},up:function(a){return this.age(a.search.settings.up)},to:function(a){return this.age(a.search.settings.to)},town:function(a){return 1==a.search.settings.town},virt:function(a){return 1==a.search.settings.virt},virgin:function(a){return a.search.settings.city==this.city&&(this.selectCity==this.city&&this.selectWho==this.who&&this.selectUp==this.up&&this.selectTo==this.to&&this.checkedTown==this.town&&this.checkedVirt==this.virt)}}),mounted:function(){this.selectCity=this.city,this.selectWho=this.who,this.selectUp=this.up,this.selectTo=this.to,this.checkedTown=this.town,this.checkedVirt=this.virt},methods:{age:function(a){if(!(a=Number(a)))return 0;var b=_.min(this.ageRange),c=_.max(this.ageRange);return a<=b?b:a>=c?c:_.find(this.ageRange,function(b,c,d){if(c&&c<d.length&&a>d[c-1]&&a<d[c+1])return!0})},save:function(){var a={who:this.selectWho,city:this.city,up:this.selectUp,to:this.selectTo,town:this.checkedTown,virt:this.checkedVirt};this.virgin||this.$store.dispatch("SAVE_SEARCH",a)},account:function(){this.$emit("account")},close:function(){this.save(),this.$emit("close")}},template:"#search-settings"}),Vue.component("security-settings",{props:[],data:function(){return{inputLogin:"",inputPasswd:"",inputEmail:"",checkSubscribe:!1,process:!1,processLogin:!1,processPasswd:!1,processEmail:!1,confirmRemove:!1,virgin:!0}},computed:Vuex.mapState({login:function(a){return a.auth.login},passwd:function(a){return a.auth.pass},email:function(a){return a.auth.email},promt:function(a){return a.auth.promt},subscr:function(a){return a.auth.subscr}}),mounted:function(){var a=this;this.$store.dispatch("auth/SYNC").then(function(){a.init(),a.process=!1}).catch(function(){a.process=!1}),this.process=!0,this.init()},methods:{init:function(){this.inputLogin=this.login,this.inputPasswd=this.passwd,this.inputEmail=this.email,this.checkSubscribe=this.subscr},deflower:function(){this.virgin=!1},saveLogin:function(){var a=this;this.processLogin=!0,this.$store.dispatch("auth/SAVE_LOGIN",this.inputLogin).then(function(b){var c=b.data;c.err&&a.$emit("warning",c.say),a.processLogin=!1}).catch(function(){a.processLogin=!1})},savePasswd:function(){var a=this;this.processPasswd=!0,this.$store.dispatch("auth/SAVE_PASSWD",this.inputPasswd).then(function(b){var c=b.data;c.err&&a.$emit("warning",c.say),a.processPasswd=!1}).catch(function(){a.processPasswd=!1})},saveEmail:function(){var a=this;this.processEmail=!0,this.$store.dispatch("auth/SAVE_EMAIL",this.inputEmail).then(function(b){var c=b.data;c.err&&a.$emit("warning",c.say),a.processEmail=!1}).catch(function(){a.processEmail=!1})},removeEmail:function(){var a=this;this.confirmRemove=!1,this.processEmail=!0,console.log("REMOVE_EMAIL"),this.$store.dispatch("auth/REMOVE_EMAIL").then(function(b){var c=b.data;c.err&&a.$emit("warning",c.say),a.processEmail=!1}).catch(function(){a.processEmail=!1})},saveSubscribe:function(){this.$store.dispatch("auth/SAVE_SUSCRIBE")},close:function(){this.processLogin||this.processPasswd||this.processEmail?this.$emit("alert","Подождите, сохраняю."):this.$emit("close")}},template:"#security-settings"}),Vue.component("social-settings",{props:[],data:function(){return{checkedContact:{em:0,vk:0,ok:0,fb:0,go:0,sk:0,ph:0},virgin:!0}},computed:Vuex.mapState({contacts:function(a){return a.user.contacts}}),mounted:function(){console.log("user",this.contacts),this.checkedContact=this.contacts},methods:{close:function(){this.save(),this.$emit("close")},deflower:function(){this.virgin=!1},save:function(){this.virgin||this.$store.dispatch("SAVE_CONTACTS",this.checkedContact)}},template:"#social-settings"}),Vue.component("sex-confirm",{props:["show"],computed:{variant:function(){return this.show?this.show:"message"},caption:function(){return this.content[this.variant].caption},text:function(){return this.content[this.variant].text}},methods:{close:function(){this.$emit("close")},save:function(a){this.$store.dispatch("SAVE_SEX",a),this.$emit("select",this.show),this.close()},login:function(){this.$emit("login"),this.$emit("close")}},data:function(){return{content:{search:{caption:"Подтвердите",text:"Для правильного отображения результатов поиска необходимо указать пол. Вы парень или девушка?"},contacts:{caption:"Вы девушка?",text:"Начало быстрого общения в один клик. Хотите получать сообщения и новые знакомства. Достаточно подтвердить, парень вы или девушка."},message:{caption:"Подтвердите",text:"Все пользователи желают знать с кем будут общаться. Чтобы продолжить укажите, парень вы или девушка."},account:{caption:"Кто вы?",text:"Приватная анкета в один клик. Самое быстрое общение. Достаточно указать кто вы, парень или девушка. И начинайте общаться."}}}},template:"#sex-confirm"}),Vue.component("simple-captcha",{props:[],data:function(){return{code:"",inc:0}},computed:{src:function(){return"/capcha_pic.php?inc="+this.inc}},mounted:function(){},methods:{close:function(){this.$emit("close")},update:function(){this.inc++},input:function(){this.$emit("input",this.code)}},template:"#simple-captcha"}),Vue.component("slider-vertical",{data:function(){return{slide:1}}}),Vue.component("snackbar",{methods:{close:function(){this.$emit("close")}},mounted:function(){_.delay(this.close,3e3)},template:"#snackbar"}),Vue.component("suggest-input",{props:["url","disabled"],data:function(){return{query:"",items:[],enable:!0}},computed:{suggested:function(){return this.items.length}},methods:{load:function(){var a=this;api.user.get({q:this.query},"tag/suggest").then(function(b){a.loaded(b.data)})},reset:function(){this.query="",this.items=[]},select:function(a){this.query=a,this.$emit("select",a),this.reset()},loaded:function(a){a&&a.length?(this.items=a,console.log("loaded",a)):this.reset()}},template:"#suggest-input"}),Vue.component("toast",{methods:{close:function(){this.$emit("close")}},mounted:function(){_.delay(this.close,2e3)},template:"#toast"}),Vue.component("upload-dialog",{template:"#upload-dialog",data:function(){return{photos:[],server:null}},created:function(){this.server=this.$store.state.photoServer},methods:{show:function(a){this.preview(this.photos[a])},preview:function(a){var b=a._links;if(b.origin.href){var c={photo:b.origin.href,thumb:b.thumb.href,alias:a.alias,height:a.height,width:a.width};this.$store.commit("sendPhoto",c)}this.close()}}}),Vue.component("photo-dialog",{methods:{close:function(){this.$emit("close"),store.commit("viewPhoto",{photo:null})}},computed:Vuex.mapState({config:function(a){return a.photoView}}),template:"#photo-dialog"});var router=new VueRouter({mode:"history",routes:[]}),storage={enable:0,init:function(){storage.is_enable()&&(storage.enable=1)},is_enable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},save:function(a,b){storage.enable&&localStorage.setItem(a,b)},load:function(a,b){var c=b||null;return storage.enable&&localStorage.getItem(a)&&(c=localStorage.getItem(a)),c},set:function(a,b){storage.save(a,b)},get:function(a,b){storage.load(a,b)},array:{load:function(a){var b=[],c=null;return c=storage.load(a),c=json.parse(c),c&&(b=c),b},save:function(a,b){storage.save(a,json.encode(b))},add:function(a,b){}}};storage.init();var about={namespaced:!0,state:{growth:0,weight:0,figure:0},actions:{SYNC:function(a){var b=(a.rootState,a.commit);a.getters;return api.user.syncAbout().then(function(a){b("update",a.data)})},SAVE:function(a,b){var c=(a.state,a.commit);api.user.saveAbout({anketa:b}).then(function(a){c("update",b)})}},mutations:{update:function(a,b){b&&_.assign(a,b)}}},accepts={namespaced:!0,state:{photo:!1,search:!1},actions:{LOAD:function(){var a=ls.get("accepts");a&&(state=a.slice()),console.log(state)}},mutations:{photo:function(a){a.photo=!0,ls.set("accepts",a)},search:function(a){a.search=!0,ls.set("accepts",a)}}},auth={namespaced:!0,state:{iss:"",exp:"",iat:"",sid:"",uid:"",auth:"",ip:"",login:"",pass:"",email:"",promt:"",subscr:!1,last:"",error:""},actions:{SYNC:function(a){var b=a.commit;return api.user.syncAuth().then(function(a){b("update",a.data)})},SAVE_LOGIN:function(a,b){a.commit;return api.user.saveLogin(b)},SAVE_PASSWD:function(a,b){a.commit;return api.user.savePasswd(b)},SAVE_EMAIL:function(a,b){a.commit;return api.user.saveEmail(b)},REMOVE_EMAIL:function(a){a.commit;return api.user.removeEmail()},SAVE_SUSCRIBE:function(a,b){a.commit;return api.user.saveSubscribe()}},mutations:{update:function(a,b){b&&_.assign(a,b)}}},mutations={load:function(a,b){b&&b instanceof Array&&b.length>0&&(a.list=b)},add:function(a,b){b&&b instanceof Array&&b.length>0&&(a.list=_.union(a.list,b))}},initial=_.extend({namespaced:!0,state:{list:[]},actions:{LOAD:function(a){var b=a.state,c=a.commit,d=a.rootState;return c("load",ls.get("initial-contacts")),api.contacts.initial.cget({uid:d.user.uid,offset:0}).then(function(a){c("load",a.data),ls.set("initial-contacts",b.list)})},NEXT:function(a,b){var c=(a.state,a.commit),d=a.rootState;return api.contacts.initial.cget({uid:d.user.uid,offset:b}).then(function(a){c("add",a.data)})},DELETE:function(a,b){var c=a.state,d=a.commit,e=a.rootState,f=api.contacts.initial.delete({uid:e.user.uid,resource_id:c.list[b].id});return d("delete",b),f},READ:function(a,b){var c=a.state,d=a.commit,e=a.rootState,f=api.contacts.initial.put(null,{uid:e.user.uid,resource_id:c.list[b].id});return d("read",b),f}},mutations:_.extend({delete:function(a,b){a.list.splice(b,1),ls.set("initial-contacts",a.list)},read:function(a,b){a.list[b].message.unread=0,ls.set("initial-contacts",a.list)}},mutations)}),intimate=_.extend({namespaced:!0,state:{list:[]},actions:{LOAD:function(a){var b=a.state,c=a.commit,d=a.rootState;return c("load",ls.get("intimate-contacts")),api.contacts.intimate.cget({uid:d.user.uid,offset:0}).then(function(a){c("load",a.data),ls.set("intimate-contacts",b.list)})},NEXT:function(a,b){var c=(a.state,a.commit),d=a.rootState;return api.contacts.intimate.cget({uid:d.user.uid,offset:b}).then(function(a){c("add",a.data)})},DELETE:function(a,b){var c=a.state,d=a.commit,e=a.rootState,f=api.contacts.intimate.delete({uid:e.user.uid,resource_id:c.list[b].id});return d("delete",b),f},READ:function(a,b){var c=a.state,d=a.commit,e=a.rootState,f=api.contacts.intimate.put(null,{uid:e.user.uid,resource_id:c.list[b].id});return d("read",b),f}},mutations:_.extend({delete:function(a,b){a.list.splice(b,1),ls.set("intimate-contacts",a.list)},read:function(a,b){a.list[b].message.unread=0,ls.set("intimate-contacts",a.list)}},mutations)}),sends=_.extend({namespaced:!0,state:{list:[]},actions:{LOAD:function(a){var b=a.state,c=a.commit,d=a.rootState;return c("load",ls.get("sends-contacts")),api.contacts.sends.cget({uid:d.user.uid,offset:0}).then(function(a){c("load",a.data),ls.set("sends-contacts",b.list)})},NEXT:function(a,b){var c=(a.state,a.commit),d=a.rootState;return api.contacts.sends.cget({uid:d.user.uid,offset:b}).then(function(a){c("add",a.data)})},DELETE:function(a,b){var c=a.state,d=a.commit,e=a.rootState,f=api.contacts.sends.delete({uid:e.user.uid,resource_id:c.list[b].id});return d("delete",b),f}},mutations:_.extend({delete:function(a,b){a.list.splice(b,1),ls.set("sends-contacts",a.list)}},mutations)}),contacts={modules:{initial:initial,intimate:intimate,sends:sends}},credits={state:{count:0,info:""},actions:{},mutations:{}},desires={namespaced:!0,state:{list:[]},actions:{SYNC:function(a){var b=(a.rootState,a.commit);a.getters;return api.user.desireList().then(function(a){b("update",a.data)})},ADD:function(a,b){var c=(a.state,a.commit);return api.user.desireAdd(b).then(function(a){var d=a.data.id;c("add",{id:d,tag:b})})},DELETE:function(a,b){var c=a.state,d=a.commit,e=api.user.desireDelete(c.list[b].id);return d("delete",b),e}},mutations:{update:function(a,b){b&&b.length&&(a.list=b.slice())},add:function(a,b){a.list.unshift(b)},delete:function(a,b){a.list.splice(b,1)}}},modals={state:{initial:!1,intimate:!1,sends:!1},mutations:{showInitial:function(a,b){store.commit("closeAll"),a.initial=1==b},showIntimate:function(a,b){store.commit("closeAll"),a.intimate=1==b},showSends:function(a,b){store.commit("closeAll"),a.sends=1==b},closeAll:function(a){a.initial=!1,a.intimate=!1,a.sends=!1}}},moderator={state:{promt:0,rank:0,resident:0,action:0,effect:0,bunn:0,rang:""},actions:{},mutations:{}},search={state:{list:[],url:"",human:{name:"",age:0,city:""},settings:{who:0,city:"",up:null,to:null,town:!1,virt:!1}},actions:{HUMAN:function(a,b){var c=a.commit,d="human.data."+b;return c("resetHuman",b),c("setHuman",ls.get(d)),api.search.get({tid:b}).then(function(a){c("setHuman",a.data),ls.set(d,a.data,1500)})},SETTINGS:function(a){var b=a.commit;b("settingsCookies"),b("settings",ls.get("search.settings"))},SAVE_SEARCH:function(a,b){a.state;return(0,a.commit)("settings",b),ls.set("search.settings",b),api.user.saveSearch(b).then(function(a){})}},mutations:{resetHuman:function(a,b){a.human&&a.human.id!=b&&(a.human={})},setHuman:function(a,b){b&&(a.human=b)},settings:function(a,b){b&&_.assign(a.settings,b)},settingsCookies:function(a){var b=get_cookie("mail_sett");if(b){try{b=JSON.parse(b)}catch(a){}a.settings.city=b.city,a.settings.who=Number(b.who),a.settings.up=Number(b.up),a.settings.to=Number(b.to),a.settings.town=Boolean(b.town),a.settings.virt=Boolean(b.virt)}}},getters:{searchURL:function(a,b,c){var d=a.settings;return"/index.php?view=simple&town="+c.user.city+"&years_up="+d.up+"&years_to="+d.to+"&who="+d.who}}},user={state:{uid:0,sex:0,age:0,name:"",city:"",contacts:{em:0,vk:0,ok:0,fb:0,go:0,sk:0,ph:0},tags:{str:""},status:0,last:""},actions:{LOAD_USER:function(a){(0,a.commit)("loadUser",ls.get("user.data"))},SAVE_SEX:function(a,b){var c=a.state,d=a.commit;b&&c.sex!=b&&(api.user.saveSex(b).then(function(a){}),d("loadUser",{sex:b})),d("loadUser",{name:""})},SAVE_AGE:function(a,b){var c=a.state,d=a.commit;b&&c.age!=b&&(api.user.saveAge(b).then(function(a){}),d("loadUser",{age:b}))},SAVE_NAME:function(a,b){var c=a.state,d=a.commit;b&&c.name!=b&&(api.user.saveName(b).then(function(a){}),d("loadUser",{name:b}))},SAVE_CITY:function(a,b){var c=a.state,d=a.commit;b&&c.city!=b&&(api.user.saveCity(b).then(function(a){}),d("loadUser",{city:b}))},SAVE_CONTACTS:function(a,b){var c=(a.state,a.commit);api.user.saveContacts(b).then(function(a){}),c("loadUser",{contacts:b})}},mutations:{loadUser:function(a,b){_.assign(a,b),ls.set("user.data",a,23456)},resetUser:function(a,b){_.assign(a,b),ls.set("user.data",b,23456)}}},visited={namespaced:!0,state:{list:[]},actions:{SYNC:function(a){var b=a.rootState,c=a.state,d=a.commit,e="visited-"+b.user.uid;return d("update",ls.get(e)),api.user.visitedList().then(function(a){var b=a.data;d("update",b),ls.set(e,c.list,2678400)})},ADD:function(a,b){var c=a.rootState,d=a.state,e=a.commit,f=c.user.uid,g="visited-"+f;return e("add",b),ls.set(g,d.list,2678400),api.user.visitedAdd(f,b).then(function(a){})}},mutations:{update:function(a,b){b&&b.length&&(a.list=_.union(a.list,b))},add:function(a,b){a.list.unshift(b)}}};moment.locale("ru");var ls=lscache,store=new Vuex.Store({modules:{user:user,auth:auth,about:about,search:search,contacts:contacts,desires:desires,visited:visited,accepts:accepts,modals:modals},state:{apiToken:"",photoServer:"195.154.54.70",count:0,optionStatic:{view:null},photoView:{thumb:null,photo:null,height:null},uploadView:{show:!1},contactView:{show:!1},formMess:{sendTo:null,sendPhoto:{thumb:null,photo:null,height:null,width:null},intimate:!0}},actions:{LOAD_API_TOKEN:function(a){(0,a.commit)("setApiToken",{apiToken:get_cookie("jwt")})}},mutations:{setApiToken:function(a,b){b&&_.assign(a,b)},viewPhoto:function(a,b){_.assign(a.photoView,b)},viewUpload:function(a,b){a.uploadView.show=!0===b},sendPhoto:function(a,b){console.log("sendPhoto"),_.assign(a.formMess.sendPhoto,b)},intimated:function(a,b){a.formMess.intimate=!0===b},optionDialog:function(a,b){a.optionStatic.view=b||null}},getters:{accept:function(){}}});store.dispatch("LOAD_API_TOKEN"),store.dispatch("accepts/LOAD"),store.dispatch("LOAD_USER"),store.dispatch("SETTINGS");var Api=function(){function a(b,c,d,e){_classCallCheck(this,a),this.setDelay("0"),this.setRoot(b,d),this.setConfig(this.root,c),this.setRouting(e)}return _createClass(a,[{key:"setDelay",value:function(a){this.wait=1e3*a}},{key:"setRouting",value:function(a){this.routing={route:"",load:"",get:"{resource_id}",cget:"",send:"",post:"",save:"",remove:"",delete:"{resource_id}",put:"{resource_id}",patch:"{resource_id}",option:"{resource_id}"},_.extend(this.routing,a)}},{key:"setRoot",value:function(a,b){var c=b?"v"+b+"/":"";this.root=a+c}},{key:"setConfig",value:function(a,b){this.config={baseURL:a,headers:{Authorization:"Bearer "+b}}}},{key:"setBaseURL",value:function(a){_.extend(this.config,{baseURL:a})}},{key:"setAuthKey",value:function(a){_.extend(this.config.headers,{Authorization:"Bearer "+a}),this.key=a}},{key:"setParams",value:function(a,b){var c=b.replace(/\{(.*?)\}/gi,function(b,c){var d=a[c];return delete a[c],d});return this.config.params=a||{},c}},{key:"setUrl",value:function(a,b,c){this.refresh();var d=this.routing.route;if(c)result=c;else{var e=this.routing[a];result=d||"",result&&e?result=result+"/"+e:e&&(result=e)}return result=this.setParams(b,result),this.root+result}},{key:"get",value:function(a,b){return this.delay(axios.get(this.setUrl("get",a,b),this.config),0)}},{key:"load",value:function(a,b){return this.delay(axios.get(this.setUrl("load",a,b),this.config),0)}},{key:"cget",value:function(a,b){return this.delay(axios.get(this.setUrl("cget",a,b),this.config),0)}},{key:"send",value:function(a,b){return this.delay(axios.get(this.setUrl("send",a,b),this.config),0)}},{key:"post",value:function(a,b,c){return this.delay(axios.post(this.setUrl("post",b,c),a,this.config),0)}},{key:"save",value:function(a,b,c){return this.delay(axios.post(this.setUrl("save",b,c),a,this.config),0)}},{key:"remove",value:function(a,b,c){return this.delay(axios.post(this.setUrl("remove",b,c),a,this.config),0)}},{key:"delete",value:function(a,b){return this.delay(axios.delete(this.setUrl("delete",a,b),this.config),0)}},{key:"put",value:function(a,b,c){return this.delay(axios.put(this.setUrl("put",b,c),a,this.config),0)}},{key:"patch",value:function(a,b,c){return this.delay(axios.patch(this.setUrl("patch",b,c),a,this.config),0)}},{key:"request",value:function(a,b,c,d,e){return c?this.delay(axios[a](this.setUrl(b,d,e),c,this.config),0):this.delay(axios[a](this.setUrl(b,d,e),this.config),0)}},{key:"option",value:function(){}},{key:"delay",value:function(a,b){var c=b||this.wait;return c<this.wait&&(c=this.wait),0==c||"undefined"==typeof Promise?a:new Promise(function(b,d){_.delay(b,c,a)})}},{key:"refresh",value:function(){store.dispatch("LOAD_API_TOKEN")}}]),a}(),ApiBun=function(a){function b(){_classCallCheck(this,b);return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"/","1234"))}return _inherits(b,a),_createClass(b,[{key:"send",value:function(a){return axios.post("mess/bun/",a,this.config)}}]),b}(Api),ApiMessages=function(a){function b(){_classCallCheck(this,b);return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"/","1234"))}return _inherits(b,a),_createClass(b,[{key:"send",value:function(a){return this.post(a,null,"mailer/post/")}}]),b}(Api),ApiUser=function(a){function b(){_classCallCheck(this,b);return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"/","1234",null,null))}return _inherits(b,a),_createClass(b,[{key:"saveSex",value:function(a){return this.save({sex:a},null,"option/sex")}},{key:"saveAge",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{age:a},null,"option/age")}},{key:"saveName",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{name:a},null,"option/name")}},{key:"saveCity",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{city:a},null,"option/city")}},{key:"saveContacts",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{contact:a},null,"option/contact")}},{key:"saveSearch",value:function(a){return a={search_sex:a.who,years_up:a.up,years_to:a.to,option_mess_town:a.town,option_virt_accept:a.virt},_get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,a,null,"msett/save")}},{key:"syncAbout",value:function(){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"load",this).call(this,null,"sync/anketa")}},{key:"saveAbout",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,a,null,"option/anketa")}},{key:"syncAuth",value:function(){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"load",this).call(this,null,"sync/authdata")}},{key:"saveLogin",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{login:a},null,"option/login")}},{key:"savePasswd",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{pass:a},null,"option/passwd")}},{key:"saveEmail",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{email:a},null,"option/email")}},{key:"removeEmail",value:function(){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"remove",this).call(this,null,null,"option/demail")}},{key:"saveSubscribe",value:function(){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,null,null,"option/subscr")}},{key:"desireList",value:function(){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"load",this).call(this,null,"tag/user")}},{key:"desireAdd",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"save",this).call(this,{tag:a},null,"tag/add")}},{key:"desireDelete",value:function(a){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"remove",this).call(this,{id:a},null,"tag/del")}},{key:"visitedList",value:function(){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"load",this).call(this,null,"contact/visited")}},{key:"visitedAdd",value:function(a,c){return _get(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"send",this).call(this,{tid:c,uid:a},"contact/addvisit/{uid}")}}]),b}(Api),ApiSearch=function(a){function b(){_classCallCheck(this,b);var a={route:"users",get:"{tid}"};return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"http://212.83.162.58/","1234",null,a))}return _inherits(b,a),b}(Api),ApiContact=function(a){function b(a){_classCallCheck(this,b);var c=store.state.apiToken;return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,"http://212.83.134.89:9000/",c,null,a))}return _inherits(b,a),_createClass(b,[{key:"refresh",value:function(){store.dispatch("LOAD_API_TOKEN"),this.setAuthKey(store.state.apiToken)}}]),b}(Api),ApiInitial=function(a){function b(){_classCallCheck(this,b);var a={route:"users/{uid}/initials"};return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),b}(ApiContact),ApiIntimate=function(a){function b(){_classCallCheck(this,b);var a={route:"users/{uid}/intimates"};return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),b}(ApiContact),ApiSends=function(a){function b(){_classCallCheck(this,b);var a={route:"users/{uid}/sends"};return _possibleConstructorReturn(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}return _inherits(b,a),b}(ApiContact),api={user:new ApiUser,search:new ApiSearch,bun:new ApiBun,contacts:{initial:new ApiInitial,intimate:new ApiIntimate,sends:new ApiSends},messages:new ApiMessages};new Vue({data:{searchSettings:!1,accountSettings:!1,sexConfirm:!1,logIn:!1,search:!1,warning:"",alert:"",account:!1,securitySettings:!1,desiresSettings:!1,socialSettings:!1,aboutSettings:!1,otherSettings:!1},computed:{initial:function(){return this.$store.state.modals.initial},intimate:function(){return this.$store.state.modals.intimate},sends:function(){return this.$store.state.modals.sends},view:function(){return this.$store.state.optionStatic.view},isSex:function(){return this.$store.state.user.sex},humanId:function(){return Number(this.$route.path.substr(1))}},methods:{searchOpen:function(){this.search&&this.$refs.search.reload(),this.search=1},close:function(){this.$store.commit("closeAll"),store.commit("optionDialog",!1)},confirmSex:function(a){return!!this.isSex||(this.sexConfirm=a,!1)},selectSex:function(a){"search"==a&&this.openSearchSettings(),"account"==a&&this.openAccountSettings()},openSearchSettings:function(){this.confirmSex("search")&&(this.searchSettings=!0)},openAccountSettings:function(){this.confirmSex("account")&&(this.accountSettings=!0)},openLogIn:function(){this.logIn=!0},showSnackbar:function(a){this.warning=a},showToast:function(a){this.alert=a},showAccount:function(a){this.account=a}},el:"#app",store:store,router:router}),$(document).ready(function(){slider.init(),notepad.init(),mailsett.init(),report.init(),navigate.init(),name_suggest.init(),city_suggest.init(),option_static.init(),option_sex.init(),profile_alert.init(),profile_option.init()});var hash,auto_gen={name:function(a){var b=[];b[0]=["Онилиона","Безимени","Неуказано","Хуисзиз","Незнаю","Неизвестно","Несонено"],b[1]=["Саша","Дима","Сергей","Иван","Максим","Валера","Николай"],b[2]=["Оля","Юля","Настя","Алена","Катя","Маргарита","Татьяна"];var c=Math.floor(7*Math.random());return b[a][c]},age:function(a){var b=[];b[0]=[18,21,24,25,27,28,31],b[1]=[a+3,a+2,a+1,a,a-1,a-2,a-3];var c=a?1:0,d=Math.floor(7*Math.random());return b[c][d]}},cookie_storage={enabled:0,init:function(){},get_cookie:function(a){var b=document.cookie.match("(^|;) ?"+a+"=([^;]*)(;|$)");return b?unescape(b[2]):null},del_cookie:function(a){var b=new Date;b.setTime(b.getTime()-1e3),document.cookie=a+"=; expires="+b.toGMTString()+"; path=/"},set_cookie:function(a,b,c){var d=new Date;d.setTime(d.getTime()+6e4*c),document.cookie=a+"="+b+"; expires="+d.toGMTString()+"; path=/"},get_data:function(a){var b=get_cookie(a),c=null;if(b)try{c=JSON.parse(b)}catch(a){}return c},set_data:function(){}},desire_clip={sync_taglist:0,init:function(){desire_clip.action.set(),desire_clip.ajax.sync()},ajax:{sync:function(){$.get("/sync/taglist/",desire_clip.ajax.parse)},parse:function(a){(a=json.parse(a))&&a.id&&user_tag.sync!=a.id&&(user_tag.sync=a.id,user_tag.action.store(),desire_clip.ajax.load())},load:function(){$.get("/tag/user/",desire_clip.ajax.on_load)},on_load:function(a){a=json.parse(a),void 0!=a.tags&&(user_tag.list=a.tags,user_tag.option.set_count(),user_tag.action.store()),a.tags.length>0&&desire_clip.action.set()},add:function(a){$.post("/tag/add/",{tag:a})}},action:{set:function(){user_tag.action.ids(),$(".desire_clip").each(function(a,b){$(b).off("click"),$(b).removeClass("desire_user"),user_tag.idls.indexOf($(b).data("id"))>=0?$(b).addClass("desire_user"):$(b).on("click",desire_clip.action.add)}),user_tag.option.set_count()},add:function(){desire_clip.ajax.add($(this).data("tag")),desire_clip.option.toggle(this);var a={tag:$(this).data("tag"),id:$(this).data("id")};user_tag.list.push(a)},del:function(){option_tag.ajax.del($(this).data("id")),desire_clip.option.toggle(this),user_tag.list.splice($(this).data("num"),1),$(this).on("click",desire_clip.action.add)}},option:{toggle:function(a){$(a).off("click"),$(a).toggleClass("desire_user")}}},device={init:function(){},width:function(){return $(window).width()},height:function(){return $(window).height()}},active_textarea,giper_chat={open_mess:0,idle_round:0,count_unread:0,cascade:0,round_time:0,round_open:1,timer_id:null,mess_block:null,mess_stock:[],prev_title:null,init:function(){device.width()>1200&&(giper_chat.mess_stock=storage.array.load("mess_stock"),giper_chat.remind()),$('<div id="block_timer" class="timer">').appendTo("body"),giper_chat.timer_set(),giper_chat.new_round(),$("#giper_reply .post").on("click",giper_chat.reply_show),storage.load("reply_all")&&$("#giper_reply textarea").val(storage.load("reply_all")),giper_chat.prev_title=document.title},set_unread:function(){giper_chat.count_unread>0?($("#menu_message_unread b").text(giper_chat.count_unread),$("#menu_message_unread").show(),$("#menu_message").attr("title","Новых сообщений "+giper_chat.count_unread)):($("#menu_message_unread").text(""),$("#menu_message_unread").hide(),$("#menu_message").attr("title","Новых сообщений нет"))},on_timer:function(){giper_chat.title_blink(),giper_chat.round_open&&0==giper_chat.cascade&&giper_chat.round_time--,giper_chat.trace(),giper_chat.round_time<1&&giper_chat.new_round()},new_round:function(){giper_chat.timer_stop(),giper_chat.ajax_new()},trace:function(){$("#block_timer").text(giper_chat.round_time)},ajax_new:function(){simple_hash(),giper_chat.round_open=0,$.get("/ajax/new_mess.php",{hash:hash},giper_chat.on_load).always(function(){giper_chat.round_open=1})},on_load:function(a){if(a){var b=json.parse(a);giper_chat.route_xz(b),giper_chat.count_unread=b.count_unread,giper_chat.set_unread()}setTimeout(function(){giper_chat.timer_set()},5e3)},route_xz:function(a){device.width()>1200&&a.type&&giper_chat.open_mess<9&&("air_user"==a.type||a.type,giper_chat.mess_stock.push(a),giper_chat.stock.store(),giper_chat.new_message(a))},reply_enable:function(){0==giper_chat.cascade&&(giper_chat.open_mess>2&&$("#giper_reply").show("blind"),giper_chat.open_mess>5&&$("#giper_reply textarea").show("blind")),
giper_chat.open_mess<3&&$("#giper_reply").hide("blind"),0==giper_chat.open_mess&&(giper_chat.cascade=0)},reply_show:function(){var a=$("#giper_reply textarea");$(a).is(":visible")?giper_chat.reply_all():(active_textarea=a,a.show("blind"),a.focus(),notepad.show())},reply_all:function(){var a=$("#giper_reply textarea"),b=a.val();if(b){var c=$("#giper_stock").children().filter(":first");giper_chat.cascade=b,storage.save("reply_all",b),$("textarea",c).val(b),$(".post",c).click(),a.hide("blind")}giper_chat.reply_enable()},new_message:function(a){giper_chat.open_mess++,giper_chat.reply_enable();var b=giper_chat.create_message(a);b.prependTo($("#giper_stock")),b.show("blind"),setTimeout(function(){$(".sound",b).show()},500),giper_chat.idle_round=0},remind:function(){jQuery.each(giper_chat.mess_stock,function(a,b){giper_chat.new_message(b)})},stock:{store:function(){storage.array.save("mess_stock",giper_chat.mess_stock)},remove:function(a){var b=null;jQuery.each(giper_chat.mess_stock,function(c,d){d.mess_id==a&&(b=c)}),(b||0==b)&&(giper_chat.mess_stock.splice(b,1),giper_chat.mess_stock.length-$(".new_message").length>1&&(giper_chat.mess_stock=[]),giper_chat.stock.store())}},create_message:function(a){a.reply||(a.reply="");var b=$("#new_message_ex").clone().attr("id",a.type+"_"+a.mess_id).data("number",a.mess_id).data("user",a.user).addClass(a.type);return $(".mess_text",b).html(a.text),$(".close",b).click(function(){giper_chat.close_message($(b))}),"new_message"!=a.type&&"old_message"!=a.type||("old_message"==a.type&&($(".title",b).text("Есть сообщение без ответа"),$(".sound",b).remove()),$(".post",b).click(function(){giper_chat.post_mess(a)}),$("textarea",b).val(a.reply),$(".user_name",b).text(a.name+":"),$(".history",b).click(function(){giper_chat.follow_message(a.user,a.mess_id)}),$(".bunn",b).click(function(){giper_chat.ajax_bun(a.user,a.mess_id,a.type),giper_chat.open_mess--}),"new_message"==a.type&&$("#contact_update").show("fade")),"server_mess"==a.type&&($(".sound",b).remove(),$(".title",b).text(a.reply),$(".bunn",b).remove(),$(".post",b).val("Хорошо"),$(".post",b).click(function(){send_serv_mess($("#"+a.type+"_"+a.mess_id),"tip_user_bun_close")}),$(".history",b).text("Подробнее..."),$(".history",b).attr("href","/блог/наказывайте-кого-следует/"),$(".history",b).attr("target","_blank")),"air_user"!=a.type&&"new_client"!=a.type||("air_user"==a.type&&$(".title",b).text("Сейчас на сайте"),"new_client"==a.type&&$(".title",b).text("Зарегистрировалась сегодня"),$(".mess_text",b).html(a.age+" "+a.city+" "+a.text),$(".sound",b).remove(),$(".bunn",b).remove(),$(".user_name",b).text(a.name+","),$(".user_name",b).text(a.name+","),$(".post",b).val("Написать"),$(".post",b).click(function(){giper_chat.post_mess(a)}),$(".history",b).text("Смотреть анкету"),$(".history",b).click(function(){giper_chat.follow_message(a.user,a.mess_id)}),a.type),$(b).draggable({handle:".title",stop:function(a,c){$(".sound",b).remove();var d=$(this).offset().top-$(window).scrollTop(),e=$(this).offset().left;$(this).css("top",d).css("left",e).css("position","fixed"),$(this).appendTo("body")}}),b},close_message:function(a){$(".sound",a).remove(),a.hide("blind"),giper_chat.open_mess--,giper_chat.stock.remove(a.data("number")),setTimeout(function(){a.remove()},500)},close_all:function(a){},follow_message:function(a,b){giper_chat.stock.remove(b),location.href="/"+a},ajax_bun:function(a,b,c){giper_chat.close_message($("#"+c+"_"+b)),$.post("/mess/bun/",{id:b,tid:a})},timer_set:function(){giper_chat.timer_stop(),0==giper_chat.idle_round?giper_chat.round_time=10:1==giper_chat.idle_round?giper_chat.round_time=10:2==giper_chat.idle_round?giper_chat.round_time=5:3==giper_chat.idle_round?giper_chat.round_time=25:4==giper_chat.idle_round?giper_chat.round_time=35:giper_chat.idle_round>11?giper_chat.round_time=300:giper_chat.idle_round>4&&(giper_chat.round_time=60),giper_chat.idle_round++,giper_chat.timer_id=window.setInterval("giper_chat.on_timer()",1e3)},timer_stop:function(){window.clearInterval(giper_chat.timer_id)},timer_cut:function(){giper_chat.idle_round>0&&giper_chat.round_time>10&&(giper_chat.round_time=10),giper_chat.idle_round=0},toggle_text:function(){var a=$("textarea",giper_chat.mess_block),b=$(a).val();return $(a).is(":visible")?b:(active_textarea=a,$(a).show("blind"),$(a).focus(),notepad.show(),0)},post_mess:function(a){giper_chat.mess_block=$("#"+a.type+"_"+a.mess_id);var b,c;0!=giper_chat.cascade?(b=giper_chat.cascade,c=""):(b=giper_chat.toggle_text(),c=b),b&&(simple_hash(),$.post("/mailer/post/",{mess:b,id:a.user,re:c,captcha_code:$(".code",giper_chat.mess_block).val(),hash:hash},giper_chat.on_post),disabled_with_timeout($(".post",giper_chat.mess_block),5),giper_chat.timer_cut())},on_post:function(a){if(!a)return 0;var b=JSON.parse(a);"captcha"==b.error&&($("textarea",giper_chat.mess_block).show("blind"),$(".captcha_block",giper_chat.mess_block).show("blind"),$(".captcha",giper_chat.mess_block).get(0).src="/secret_pic.php?hash="+hash),"1"==b.saved&&(giper_chat.idle_round=0,$("#contact_update").show("fade"),giper_chat.close_message(giper_chat.mess_block),notepad.hide(),setTimeout(function(){0!=giper_chat.cascade&&giper_chat.reply_all()},700)),"reload"==b.error&&(giper_chat.idle_round=0,location.href="/"+user+"?text="+text),disabled_with_timeout($(".post",giper_chat.mess_block),.05)},title_blink:function(){if(0==giper_chat.count_unread)return document.title=giper_chat.prev_title,!1;"Вам сообщение!"!=document.title?document.title="Вам сообщение!":document.title=" * * * * * * * * * * * * "},post_serv:function(a,b){giper_chat.close_message($(a)),set_cookie("user_bun","1",259200)}};$(document).ready(function(){});var json={parse:function(a){var b=null;try{b=JSON.parse(a)}catch(a){}return b},encode:function(a){return JSON.stringify(a)}},mailsett={init:function(){$("#link_virt_turn").on("click",mailsett.turn_virt),$("#link_close_turn").on("click",mailsett.turn_close)},turn_virt:function(){"неприемлемо"==$("#text_virt_turn").text()?($("#text_virt_turn").text("возможен"),mailsett.send_virt(1)):($("#text_virt_turn").text("неприемлемо"),mailsett.send_virt(0))},turn_close:function(){"ограничить"==$("#text_close_turn").text()?($("#text_close_turn").text("разрешить"),mailsett.send_close(0)):($("#text_close_turn").text("ограничить"),mailsett.send_close(1))},send_close:function(a){function b(a){}$.post("/msett/close/",{option_mess_town:a},b)},send_virt:function(a){function b(a){}$.post("/msett/virt/",{option_virt_accept:a},b)}},master_info={init:function(){userinfo.data.sex?!userinfo.data.city&&$("#human_print_city").text()?master_info.ajax.load_city():userinfo.data.age?userinfo.data.second>300&&userinfo.data.contact.mc<20&&master_info.ajax.load_contact():master_info.ajax.load_age():master_info.ajax.load_sex()},ajax:{load_contact:function(){$("#anketa_master_info").load("/static/htm/master_contact.html",master_info.ajax.on_contact)},on_contact:function(){master_contact.action.sett(0),master_contact.option.print()},load_city:function(){$("#anketa_master_info").load("/static/htm/master_city.html",master_info.ajax.on_city)},on_city:function(){master_city.init(),option_static.init()},load_age:function(){$("#anketa_master_info").load("/static/htm/master_age.html",master_info.ajax.on_age)},on_age:function(){master_age.init(),option_static.init()},load_sex:function(){$("#anketa_master_info").load("/static/htm/master_sex.html",master_info.ajax.on_sex)},on_sex:function(){master_sex.init(),option_static.init()}}},navigate={enable:0,init:function(){$(document).on("keydown",function(){navigate.through(event)})},post_form:function(a,b){!a.ctrlKey||10!=a.keyCode&&13!=a.keyCode||b.submit()},through:function(a){if(window.event&&(a=window.event),a.ctrlKey){var b=null;switch(a.keyCode?a.keyCode:a.which?a.which:null){case 37:b="#previous_page";break;case 39:b="#next_page";break;case 38:b="#up_page";break;case 40:b="#down_page";break;case 36:b="#home_page"}$("a").is(b)&&(document.location=$(b).attr("href"))}}},notepad={note_block:null,last_click:null,disibled:0,create:0,init:function(){device.width()<1e3&&(notepad.disibled=1),notepad.disibled=1*get_cookie("note_vis")?1:0,active_textarea=$("#mess_text_val"),notepad.note_block=$(".notepad"),$("textarea").click(function(){active_textarea=this,notepad.show()}),$("#notepad_on").click(function(){notepad.toggle_disable("on"),notepad.show("force")}),$(".close",notepad.note_block).click(function(){notepad.hide()}),$(".post",notepad.note_block).click(function(){notepad.toggle_disable("off"),notepad.hide()}),$(".bunn",notepad.note_block).click(function(){notepad.toggle_disable("off"),notepad.hide()})},hide:function(){notepad.note_block.hide("fade")},show:function(a){notepad.disibled||(a||active_textarea&&notepad.last_click!=active_textarea)&&(notepad.create?(notepad.note_block.show("fade"),notepad.last_click=active_textarea):notepad.ajax_load())},toggle_disable:function(a){"off"==a&&(notepad.disibled=1),"on"==a&&(notepad.disibled=0),a&&set_cookie("note_vis",notepad.disibled,259200)},ajax_load:function(){simple_hash(),$.get("/ajax/load_notepad.php",{hash:hash},notepad.on_load)},remind:function(){var a=storage.load("notepad_top"),b=storage.load("notepad_left");a&&a<40&&(a=50),b&&b<10&&(b=10),a>device.height()-300&&(a=0),b>device.width()-300&&(b=0),a&&notepad.note_block.css("top",a+"px"),b&&notepad.note_block.css("left",b+"px")},on_load:function(a){a.indexOf("div")>0&&(notepad.create=1,$(".notes",notepad.note_block).html(a),$(".note_line",notepad.note_block).click(function(){var a=$(this).text();$(active_textarea).val(a).focus(),"mess-text-area"==$(active_textarea).attr("id")&&(FormMess.message=a)}),notepad.remind(),notepad.note_block.draggable({handle:".title",stop:function(a,b){var c=$(this).offset().top-$(window).scrollTop();notepad.note_block.css("top",c),storage.save("notepad_top",c),storage.save("notepad_left",$(this).offset().left)}}),notepad.show())}},option_age={init:function(){$("#option_age_value").val(userinfo.data.age),$("#option_age_button").off("click").on("click",option_age.action.send_age),$(".opt_age_val").off("click").on("click",option_age.action.send_link)},ajax:{on_save:function(a){a=json.parse(a),a.age&&(userinfo.data.age=a.age,userinfo.action.set_age(a.say))}},action:{save:function(a){userinfo.data.age=a,userinfo.ajax.save.age(option_age.ajax.on_save),userinfo.action.set_age(),option_static.action.close()},send_link:function(){option_age.action.save($(this).text())},send_age:function(){option_age.action.save($("#option_age_value").val())}}},option_anketa={anketa:{growth:0,weight:0,figure:0},init:function(){$("#option_anketa input").prop("disabled",!0),$("#option_anketa input:radio").on("click",option_anketa.action.set),$("#option_anketa_button").on("click",option_anketa.action.send),option_anketa.ajax.load()},ajax:{load:function(){$.get("/sync/anketa/",option_anketa.ajax.on_load)},on_load:function(a){option_anketa.action.print(json.parse(a))},save:function(a){$.post("/option/anketa/",{anketa:a},option_anketa.ajax.on_save),option_static.action.close()},on_save:function(a){a=json.parse(a),void 0!=a.alert&&(profile_alert.option.show(a.alert),option_anketa.action.set_anketa(a.text))}},action:{set_anketa:function(a){$("#user_anketa_option").text(a)},set:function(){option_anketa.anketa.figure=$(this).val()},send:function(){option_anketa.anketa.growth=$("#option_anketa_growth").val(),option_anketa.anketa.weight=$("#option_anketa_weight").val(),option_anketa.ajax.save(option_anketa.anketa)},print:function(a){if(void 0!=a.figure){option_anketa.anketa=a;$("#option_anketa input:radio[name=figure]").filter("[value="+1*a.figure+"]").prop("checked",!0),$("#option_anketa_growth").val(1*a.growth),$("#option_anketa_weight").val(1*a.weight)}$("#option_anketa input").prop("disabled",!1)}}},option_chlogin={init:function(){$(".option_chlogin_toggle").on("click",option_chlogin.option.toggle),$("#option_chpass_send").on("click",option_chlogin.action.chpass),$("#option_chlogin_send").on("click",option_chlogin.action.chlogin)},ajax:{chpass:function(a){$.post("/option/auth/",{pass:a},option_chlogin.ajax.on_pass)},chlogin:function(a){$.post("/option/auth/",{login:a},option_chlogin.ajax.on_login)},on_pass:function(a){option_chlogin.ajax.on_err(a),disabled_with_timeout($("#option_chpass_send"),.5)},on_login:function(a){option_chlogin.ajax.on_err(a),disabled_with_timeout($("#option_chlogin_send"),.5)},on_err:function(a){a=json.parse(a),void 0!=a.err&&a.err>0?option_chlogin.option.text(a.say):option_static.action.close()}},action:{chlogin:function(){option_chlogin.option.text(""),disabled_with_timeout($("#option_chlogin_send"),5),option_chlogin.ajax.chlogin($("#option_chlogin_value").val())},chpass:function(){option_chlogin.option.text(""),disabled_with_timeout($("#option_chpass_send"),5),option_chlogin.ajax.chpass($("#option_chpass_value").val())}},option:{toggle:function(){option_chlogin.option.text(""),$("#option_tab_chlogin").toggle("blind"),$("#option_tab_chpass").toggle("blind")},text:function(a){function b(b){return a.apply(this,arguments)}return b.toString=function(){return a.toString()},b}(function(a){$(".option_chlogin_text").text(a)})}},option_city={init:function(){$("#option_city_value").val(userinfo.data.city),$("#option_city_button").off("click").on("click",option_city.action.send_city),$(".opt_city_val").off("click").on("click",option_city.action.send_link)},ajax:{on_save:function(a){a=json.parse(a),a.city&&(userinfo.data.city=a.city,userinfo.data.city_id=a.city_id,userinfo.data.verify=a.verify,userinfo.action.set_city())}},action:{save:function(a){userinfo.data.city=a,userinfo.ajax.save.city(option_city.ajax.on_save),userinfo.action.set_city(),option_static.action.close()},send_link:function(){option_city.action.save($(this).text())},send_city:function(){option_city.action.save($("#option_city_value").val())}}},option_contact={init:function(){$("#option_contact input").prop("disabled",!0),$("#option_contact input:checkbox").on("click",option_contact.action.set),$("#option_contact_button").on("click",option_contact.action.send),option_contact.action.print()},ajax:{save:function(a){$.post("/option/contact/",{contact:a},option_contact.ajax.on_save)},on_save:function(a){mess=json.parse(a),$("#user_contact_option").text(mess.count),profile_alert.option.show(mess.alert),option_static.action.close()}},action:{set:function(){userinfo.data.contact[$(this).data("val")]=1*$(this).prop("checked")},send:function(){option_contact.ajax.save(userinfo.data.contact)},print:function(){void 0!=userinfo.data.contact&&($("#option_contact_em").prop("checked",1*userinfo.data.contact.em),$("#option_contact_vk").prop("checked",1*userinfo.data.contact.vk),$("#option_contact_ok").prop("checked",1*userinfo.data.contact.ok),$("#option_contact_fb").prop("checked",1*userinfo.data.contact.fb),$("#option_contact_go").prop("checked",1*userinfo.data.contact.go),$("#option_contact_sk").prop("checked",1*userinfo.data.contact.sk),$("#option_contact_ph").prop("checked",1*userinfo.data.contact.ph),$("#option_contact input").prop("disabled",!1))}}},option_email={init:function(){$(".option_email_button").off("click"),$(".option_email_button").on("click",option_email.action.send_email),userinfo.data.email&&$(".option_email_value").val(userinfo.data.email),option_email.ajax.load()},ajax:{load:function(){$.post("/sync/email/",option_email.ajax.on_load)},post:function(a){$.post("/option/email/",{email:a},option_email.ajax.on_save),userinfo.data.email=data.email,userinfo.action.set_email(),option_static.action.close()},on_save:function(a){profile_alert.option.show(json.parse(a))},on_load:function(a){(a=json.parse(a))&&""!=a.email&&(userinfo.data.email=a.email,userinfo.action.set_email())}},action:{send_email:function(){option_email.ajax.post($(".option_email_value").val())}}},option_intro={name:"",city:"",age:0,sex:0,init:function(){$("#option_intro input").prop("disabled",!0),$("#option_intro input:radio").on("click",option_intro.action.set_sex),$("#option_intro_button").on("click",option_intro.action.send),option_intro.action.print()},action:{set_sex:function(){var a=$(this).val();a!=userinfo.data.sex&&(userinfo.data.sex=a,userinfo.ajax.save.sex(option_sex.ajax.on_save),userinfo.action.set_sex())},set_name:function(){var a=$("#option_intro_name").val();a!=userinfo.data.name&&(userinfo.data.name=a,userinfo.ajax.save.name(option_name.ajax.on_save),userinfo.action.set_name())},set_city:function(){var a=$("#option_intro_city").val();a!=userinfo.data.city&&(userinfo.data.city=a,userinfo.ajax.save.city(option_city.ajax.on_save),userinfo.action.set_city())},set_age:function(){var a=$("#option_intro_age").val();a!=userinfo.data.age&&(userinfo.data.age=a,userinfo.ajax.save.age(option_age.ajax.on_save),userinfo.action.set_age())},send:function(){option_intro.action.set_name(),option_intro.action.set_city(),option_intro.action.set_age(),option_static.action.close()},print:function(){option_intro.name=userinfo.data.name,option_intro.city=userinfo.data.city,option_intro.age=userinfo.data.age,option_intro.sex=userinfo.data.sex,$("#option_intro_name").val(userinfo.data.name),$("#option_intro_city").val(userinfo.data.city),$("#option_intro_age").val(userinfo.data.age),$("#option_intro input:radio[name=sex]").filter("[value="+1*userinfo.data.sex+"]").prop("checked",!0),$("#option_intro input").prop("disabled",!1)}}},option_login={init:function(){$("#hide_char").on("click",option_login.action.hide_char),$("#option_login_send").on("click",option_login.action.send),$("#option_remind_send").on("click",option_login.action.remind),$(".option_login_toggle").on("click",option_login.option.toggle),$("#option_login_reset").on("click",option_login.option.reset)},ajax:{send:function(a,b,c){$.post("/sync/login/",{login:a,pass:b,captcha:c},option_login.ajax.on_save)},on_save:function(a){a=json.parse(a),void 0!=a.err&&("0"!=a.err?(option_login.option.captcha.reload(),option_login.option.captcha.show(),option_login.option.say_login(a.say)):(option_login.option.say_login(a.say),location.href=location.href)),disabled_with_timeout($("#option_login_send"),.1)},remind:function(a){$.post("/sync/remind/",{email:a},option_login.ajax.on_load)},on_load:function(a){a=json.parse(a),void 0!=a.err&&("0"!=a.err?option_login.option.say_remind(a.say):option_login.option.posted()),disabled_with_timeout($("#option_remind_send"),.1)}},action:{hide_char:function(){var a=$("#password_input");"password"==a.attr("type")?a.attr("type","text"):a.attr("type","password")},send:function(){var a=$("#login_input").val(),b=$("#password_input").val(),c=$("#captcha_input").val();disabled_with_timeout($("#option_login_send"),7),option_login.ajax.send(a,b,c)},remind:function(){var a=$("#option_remind_email").val();disabled_with_timeout($("#option_remind_send"),7),option_login.ajax.remind(a)}},option:{captcha:{show:function(){$("#captcha_pass_block").show()},reload:function(){$("#captcha_code").is(":visible")&&($("#captcha_code").get(0).src="/capcha_pic.php?hash="+hash)}},say_login:function(a){$("#option_login_text").text(a)},say_remind:function(a){$("#option_remind_text").text(a)},toggle:function(){$("#option_tab_login").toggle("blind"),$("#option_tab_remind").toggle("blind"),$("#option_tab_posted").hide("blind")},posted:function(){$("#option_tab_posted").show("blind"),$("#option_tab_remind").hide("blind"),$("#option_tab_login").hide("blind")},reset:function(){$("#option_tab_posted").hide("blind"),$("#option_tab_remind").hide("blind"),$("#option_tab_login").show("blind")}}},option_name={init:function(){$("#option_name_value").val(userinfo.data.name),$("#option_name_button").off("click").on("click",option_name.action.send_name),option_name.option.namelist()},ajax:{on_save:function(a){a=json.parse(a),a.name&&(userinfo.data.name=a.name,userinfo.action.set_name())}},action:{save:function(a){userinfo.data.name=a,userinfo.ajax.save.name(option_name.ajax.on_save),userinfo.action.set_name(),option_static.action.close()},send_link:function(){option_name.action.save($(this).text())},send_name:function(){option_name.action.save($("#option_name_value").val())}},option:{namelist:function(){1==userinfo.data.sex&&$("#man_opt_name").show(),2==userinfo.data.sex&&$("#woman_opt_name").show(),userinfo.data.sex,$(".opt_name_val").on("click",option_name.action.send_link)}}},option_sex={init:function(){$(".option_sex_change").off("click").on("click",option_sex.action.send_sex)},ajax:{on_save:function(a){userinfo.data.name=auto_gen.name(userinfo.data.sex),userinfo.ajax.save.name(option_name.ajax.on_save),a=json.parse(a),a.sex&&(userinfo.data.sex=a.sex,userinfo.action.set_sex())}},action:{send_sex:function(){0==userinfo.data.sex?userinfo.data.sex=2:1==userinfo.data.sex?userinfo.data.sex=2:2==userinfo.data.sex&&(userinfo.data.sex=1),userinfo.ajax.save.sex(option_sex.ajax.on_save),userinfo.action.set_sex()},save:function(a){userinfo.data.sex=a,userinfo.ajax.save.sex(option_sex.ajax.on_save),userinfo.action.set_sex()}}},option_static={click_enable:null,active_elem:null,timer_id:null,form:null,init:function(){if(!$(".option_static").length)return null;$(".option_static").each(function(a,b){b=$(b),b.data("active")||(b.on("click",option_static.action.preload),b.data("active",1))}),$("#option-static__close").on("click",option_static.action.close)},ajax:{load:function(a){option_static.option.form.trash(),$("#option-static__container").load("/static/htm/option_"+a+".html",option_static.ajax.on_load)},on_load:function(a){a&&(option_static.action.router(),option_static.action.show_form(),$("html, body").animate({scrollTop:0},"slow"))},save:function(a){}},option:{loader:{show:function(){$("#option-static__loader").delay(1e3).show("fade")},hide:function(){$("#option-static__loader").clearQueue(),$("#option-static__loader").hide("fade")}},form:{show:function(){$("#option-static__container").show("fade")},hide:function(){$("#option-static__container").hide("fade")},trash:function(){$("#option-static__container").empty()}},block:{show:function(){$("#option-static").show("fade")},hide:function(){$("#option-static").hide("fade")}}},action:{show_form:function(){option_static.option.form.show(),option_static.option.loader.hide()},preload:function(){var a=$(this).data("option");option_static.form=a,a&&(option_static.ajax.load(a),option_static.option.block.show(),option_static.option.loader.show())},close:function(){option_static.option.form.hide(),option_static.option.loader.hide(),option_static.option.block.hide()},router:function(){"login"==option_static.form&&option_login.init(),"contact"==option_static.form&&option_contact.init(),"age"==option_static.form&&option_age.init(),"name"==option_static.form&&(option_name.init(),name_suggest.init(),city_suggest.init()),"city"==option_static.form&&(option_city.init(),city_suggest.init()),"hidepass"==option_static.form&&option_email.init(),"anketa"==option_static.form&&(option_anketa.init(),name_suggest.init(),city_suggest.init()),"chlogin"==option_static.form&&option_chlogin.init(),"introduce"==option_static.form&&(option_intro.init(),name_suggest.init(),city_suggest.init()),"desire"==option_static.form&&(option_tag.init(),tag_suggest.init())}}},option_tag={loaded:0,init:function(){$("#option_tag input").prop("disabled",!0),$("#option_tag_button").on("click",option_tag.action.send),option_tag.action.remind(),option_tag.ajax.load()},ajax:{load:function(){$.get("/tag/user/",option_tag.ajax.on_load)},on_load:function(a){a=json.parse(a),a.tags.length>0&&(option_tag.action.print(a.tags),user_tag.list=a.tags,user_tag.action.store()),$("#option_tag input").prop("disabled",!1)},add:function(a){$.post("/tag/add/",{tag:a},option_tag.ajax.on_save)},on_save:function(a){a=json.parse(a),a.id?(user_tag.list[user_tag.list.length-1].id=a.id,user_tag.option.set_count(),option_tag.action.remind()):option_tag.option.error(option_tag.loaded),$("#option_tag_value").val(""),user_tag.action.store()},del:function(a){$.post("/tag/del/",{id:a})}},action:{remind:function(){user_tag.list.length>0&&option_tag.action.print(user_tag.list)},send:function(){var a=$("#option_tag_value").val(),b={tag:a,id:0};user_tag.list.push(b),option_tag.action.remind(),option_tag.ajax.add(a)},set:function(){userinfo.data.contact[$(this).data("val")]=1*$(this).prop("checked")},print:function(a){$("#option_tag_list").empty();for(var b=0;b<a.length;b++){var c=$('<i class="desire_tag">').text(a[b].tag);a[b].id||c.addClass("desire_onload"),c.data("id",a[b].id),c.data("num",b),c.data("tag",a[b].tag),c.attr("id","utag"+b),c.on("click",option_tag.action.del),$("#option_tag_list").append(c)}},add:function(){option_tag.ajax.add($(this).data("tag")),option_tag.option.toggle(this),$(this).on("click",option_tag.action.del);var a={tag:$(this).data("tag"),id:$(this).data("id")};user_tag.list.splice($(this).data("num"),0,a)},del:function(){option_tag.ajax.del($(this).data("id")),option_tag.option.toggle(this),user_tag.list.splice($(this).data("num"),1),user_tag.option.set_count(),$(this).on("click",option_tag.action.add)},ids:function(){user_tag.idls=[];for(var a=0;a<user_tag.list;a++)user_tag.list[a].id&&user_tag.idls.push(user_tag.list[a].id);return user_tag.idls}},option:{toggle:function(a){$(a).off("click"),$(a).toggleClass("deleted_tag")},error:function(a){$("#utag"+[a]).off("click"),$("#utag"+[a]).toggleClass("error_tag")}}},profile_alert={init:function(){$("#profile_alert").on("click",profile_alert.option.hide)},option:{show:function(a){if(a){var b=$("#profile_alert");b.clearQueue(),b.html(a),$("#profile_alert").show("fade"),$("html, body").animate({scrollTop:0},"slow"),b.delay(5e3).queue(profile_alert.option.hide)}},hide:function(){var a=$("#profile_alert");a.clearQueue(),a.hide("fade"),a.delay(500).queue(profile_alert.option.clear)},clear:function(){$("#profile_alert").empty()}}},profile_option={init:function(){$("#profile_auth_button").on("click",profile_option.action.send_auth),$("#profile_send_pass").on("click",profile_option.action.send_pass),$("#profile_del_email").on("click",profile_option.action.del_email),$("#profile_subscr_send").on("click",profile_option.action.subscr)},ajax:{post:function(a,b){$.post("/option/auth/",{login:a,pass:b},profile_option.ajax.on_save)},on_save:function(a){a=json.parse(a),void 0!=a.err&&profile_alert.option.show(a.say)},send_pass:function(){$.post("/option/passend/",profile_option.ajax.alert)},del_email:function(){$.post("/option/demail/",profile_option.ajax.alert)},subscr:function(a){$.post("/option/subscr/",profile_option.ajax.error)},alert:function(a){a=json.parse(a),void 0!=a.err&&profile_alert.option.show(a.say)},error:function(a){a=json.parse(a),void 0!=a.err&&a.err>1&&profile_alert.option.show(a.say)}},action:{send_email:function(){option_email.ajax.post($("#profile_email_value").val())},send_auth:function(){profile_option.ajax.post($("#profile_login_value").val(),$("#profile_pass_value").val())},send_pass:function(){profile_option.ajax.send_pass()},del_email:function(){profile_option.ajax.del_email()},subscr:function(){var a=$("#subscr_status_on"),b=$("#subscr_status_off");"включены"==a.text()?(b.text("отключены"),a.text("")):(b.text(""),a.text("включены")),profile_option.ajax.subscr()}}},report={is_report:0,init:function(){$("#send_question").click(function(){report.show_quest()}),$("#send_report").click(function(){report.show_report()}),$("#send_reset").click(function(){report.hide()}),$("#report_text").unbind("click"),$("#hint_close").click(function(){report.hint_hide()})},show:function(){$("#report_send").off("click"),$("#report_block").show("blind")},hide:function(){$("#report_block").hide("blind")},show_quest:function(){report.show(),$("#report_send").val("Отправить вопрос"),$("#report_send").on("click",report.post_quest)},show_report:function(){report.show(),$("#report_send").val("Отправить отзыв"),$("#report_send").on("click",report.post_report)},hint_show:function(){$("#hint_block").show("blind")},hint_hide:function(){$("#hint_block").hide("fade")},post_quest:function(){report.hide();var a=$("#report_text").val();$.post("/mailer/post/",{mess:a,id:10336,hash:hash},report.on_post),report.hint_show()},post_report:function(){report.hide();var a=$("#report_text").val();$.post("/details.php?reviews",{text_reviews:a,hash:hash}),report.hint_show(),$("#report_text").val("")},on_post:function(a){if(!a)return 0;"reload"==JSON.parse(a).error&&(location.href="/10336?text="+encodeURIComponent($("#report_text").val())),$("#report_text").val("")}},slider={timer:null,context:0,next:0,init:function(){if(!$("div").is("#top_intro_info_block"))return null;$("#top_intro_info_block").on("mouseover",slider.stop),$("#top_intro_info_block").on("mouseout",slider.start),setInterval(function(){var a=slider.next+1<5?slider.next+1:0;(new Image).src="/img/board/top_intro_info_"+a+".jpg"},1e4)},slide:function(a,b){var c=[],d=[];d[0]="Позволит познакомиться с парнем или девушкой для секса, найти партнёра в соседнем подъезде или доме напротив. Знакомиться в собственном дворе или районе уже сегодня",c[0]="Уникальный способ знакомства",c[1]="Знакомства без регистрации",d[1]="Начинайте использовать всё и сразу, на полную, лишь только зайдя на сайт. Без подтверждений регистрации, без активации анкет. Лёгкий и быстрый поиск новых знакомств",c[2]="Секс знакомства без смс",d[2]="Ни номеров телефонов, ни подтверждений, ни смс. 100% анонимность, лёгкое и раскрепощённое общение. Онлайн обмен любыми фотографиями. E-mail адрес и всё остальное указывается по желанию",c[3]="Онлайн общение, интимные темы",d[3]="То что вы хотели спросить, то о чём вы хотели поговорить. Получайте прямо сейчас. Комфортное онлайн общение, интимные беседы, уютная обстановка и приятные собеседники уже ждут вас",c[4]="Секс знакомства бесплатно",d[4]="Здесь всё бесплатно. Вам доступны все сервисы сайта полностью, уже сейчас. Ваша анкета всегда наверху. Vip аккаунтов нет, открытый доступ ко всем анкетам и безграничные возможности",a>4&&(a=0);for(var e=0;e<5;e++)$("#board_img_"+e).removeClass("show"),$("#board_img_"+e).attr("src","");$("#board_img_"+a).addClass("show active"),$("#board_img_"+a).attr("src","/img/board/top_intro_info_"+a+".jpg"),slider.context&&($("#top_intro_info_block_caption").text(c[a]),$("#top_intro_info_block_context").text(d[a])),slider.next=a},start:function(){slider.timer=setInterval(function(){slider.slide(++slider.next,0)},2e4)},stop:function(){clearTimeout(slider.timer)}},storage={enable:0,init:function(){storage.is_enable()&&(storage.enable=1)},is_enable:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(a){return!1}},save:function(a,b){storage.enable&&localStorage.setItem(a,b)},load:function(a,b){var c=b||null;return storage.enable&&localStorage.getItem(a)&&(c=localStorage.getItem(a)),c},array:{load:function(a){var b=[],c=null;return c=storage.load(a),c=json.parse(c),c&&(b=c),b},save:function(a,b){storage.save(a,json.encode(b))},add:function(a,b){}}};storage.init();var city_suggest={click_enable:null,active_elem:null,timer_id:null,init:function(){if(!$(".city_suggest").length)return null;$(".city_suggest").each(function(a,b){b=$(b),b.data("active")||(b.on("mouseover",city_suggest.enabled),b.on("blur",city_suggest.blur),b.on("keyup",city_suggest.ajax_load),b.attr("autocomplete","off"),b.wrap($('<div class="suggest_wrap">')),b.parent().append($('<div class="small_loader">')),b.parent().append($('<div class="suggest_block">')),b.data("active",1))})},enabled:function(){$(this).data("click")||($(this).on("click",city_suggest.ajax_load),$(this).data("click",1))},ajax_load:function(a){city_suggest.active_elem=$(this);var b=city_suggest.active_elem.val();$.get("/town/suggest/",{q:b,hash:hash},city_suggest.on_load)},on_load:function(a){if(a){var b=JSON.parse(a);b.cities&&(city_suggest.hide_suggest(),city_suggest.show_suggest(b.cities))}},blur:function(){$(".suggest_block").hide("fade")},hide_suggest:function(){$(".suggest_block").empty(),$(".suggest_block").hide()},show_suggest:function(a){
for(var b="",c=city_suggest.active_elem.parent(),d=0;d<a.length;d++)a[d]&&(b=$('<div class="suggest_line" data-city="'+a[d]+'">').text(a[d]),b.on("click",city_suggest.print),$(".suggest_block",c).append(b));$(".suggest_line",c).length&&$(".suggest_block",c).show()},print:function(){city_suggest.active_elem.val($(this).data("city")),city_suggest.hide_suggest()}},name_suggest={click_enable:null,active_elem:null,timer_id:null,init:function(){if(!$(".name_suggest").length)return null;$(".name_suggest").each(function(a,b){b=$(b),b.data("active")||(b.on("mouseover",name_suggest.enabled),b.on("blur",name_suggest.blur),b.on("keyup",name_suggest.ajax_load),b.attr("autocomplete","off"),b.wrap($('<div class="suggest_wrap">')),b.parent().append($('<div class="small_loader">')),b.parent().append($('<div class="suggest_block">')),b.data("active",1))})},enabled:function(){$(this).data("click")||($(this).on("click",name_suggest.ajax_load),$(this).data("click",1))},ajax_load:function(a){name_suggest.active_elem=$(this);var b=name_suggest.active_elem.val();$.post("/ajax/name.php",{name:b,hash:hash},name_suggest.on_load)},on_load:function(a){if(a){var b=JSON.parse(a);b.names&&(name_suggest.hide_suggest(),name_suggest.show_suggest(b.names))}},blur:function(){$(".suggest_block").hide("fade")},hide_suggest:function(){$(".suggest_block").empty(),$(".suggest_block").hide()},show_suggest:function(a){for(var b="",c=name_suggest.active_elem.parent(),d=0;d<a.length;d++)a[d]&&(b=$('<div class="suggest_line" data-name="'+a[d]+'">').text(a[d]),b.on("click",name_suggest.print),$(".suggest_block",c).append(b));$(".suggest_line",c).length&&$(".suggest_block",c).show()},print:function(){name_suggest.active_elem.val($(this).data("name")),name_suggest.hide_suggest()}},tag_suggest={click_enable:null,active_elem:null,timer_id:null,init:function(){if(!$(".tag_suggest").length)return null;$(".tag_suggest").each(function(a,b){b=$(b),b.data("active")||(b.on("mouseover",tag_suggest.enabled),b.on("blur",tag_suggest.blur),b.on("keyup",tag_suggest.ajax_load),b.attr("autocomplete","off"),b.wrap($('<div class="suggest_wrap">')),b.parent().append($('<div class="small_loader">')),b.parent().append($('<div class="suggest_block">')),b.data("active",1))})},enabled:function(){$(this).data("click")||($(this).on("click",tag_suggest.ajax_load),$(this).data("click",1))},ajax_load:function(a){tag_suggest.active_elem=$(this);var b=tag_suggest.active_elem.val();$.post("/tag/suggest/",{tag:b,hash:hash},tag_suggest.on_load)},on_load:function(a){tag_suggest.hide_suggest(),a=json.parse(a),a.tags.length>0&&tag_suggest.show_suggest(a.tags)},blur:function(){$(".suggest_block").hide("fade")},hide_suggest:function(){$(".suggest_block").empty(),$(".suggest_block").hide()},show_suggest:function(a){for(var b="",c=tag_suggest.active_elem.parent(),d=0;d<a.length;d++)b=$('<div class="suggest_line" data-tag="'+a[d]+'">').text(a[d]),b.on("click",tag_suggest.print),$(".suggest_block",c).append(b);$(".suggest_line",c).length&&$(".suggest_block",c).show()},print:function(){tag_suggest.active_elem.val($(this).data("tag")),tag_suggest.hide_suggest()}},user_menu={init:function(){},ajax:{},action:{sets:{search:function(){},contact:function(){}}},option:{act:{},se:function(){}}},user_tag={list:[],idls:[],sync:0,count:0,init:function(){user_tag.list=storage.array.load("user_tag_list"),user_tag.sync=storage.load("sync_taglist"),user_tag.count=storage.load("user_tag_count")},action:{store:function(){storage.array.save("user_tag_list",user_tag.list),storage.save("user_tag_count",user_tag.count),storage.save("sync_taglist",user_tag.sync)},ids:function(){user_tag.idls=[];for(var a=0;a<user_tag.list.length;a++)user_tag.list[a].id&&user_tag.idls.push(user_tag.list[a].id);return user_tag.idls}},option:{set_count:function(){user_tag.list.length&&$("#user_desire_count").text(user_tag.list.length)}}},userinfo={data:{uid:0,sex:0,age:0,name:"",city:"",city_id:0,verify:0,name_mod:0,apromt:0,daily:0,town:"",who:0,years_up:0,years_to:0,virt:0,close:0,dating:"",setting:0,assist:0,intim:0,second:0,time:0,email:""},init:function(){userinfo.ajax.load()},ajax:{load:function(a){$.get("/sync/sess/",userinfo.ajax.on_load)},on_load:function(a){a=json.parse(a),a&&a.uid?(userinfo.data=a,userinfo.action.set_data(a),master_info.init()):(storage.save("auth",0),user_menu.option.act.show_reg(),userinfo.action.set_string())},save:{sex:function(a){$.post("/option/sex/",{sex:userinfo.data.sex},a)},age:function(a){$.post("/option/age/",{age:userinfo.data.age},a)},name:function(a){$.post("/option/name/",{name:userinfo.data.name},a)},city:function(a){$.post("/option/city/",{city:userinfo.data.city},a)}}},action:{set_data:function(a){storage.save("auth",a.uid),user_menu.option.act.show_opt(),user_menu.action.sets.search(),userinfo.action.set_sex(),userinfo.action.set_age(),userinfo.action.set_name(),userinfo.action.set_city(),userinfo.action.set_string()},set_name:function(){userinfo.data.name&&userinfo.data.name.length>2&&($(".user_name_option").text(userinfo.data.name),$(".name_suggest").val(userinfo.data.name)),userinfo.action.set_string()},set_age:function(a){userinfo.data.age>0&&$(".user_age_option").text(userinfo.data.age),a&&$(".user_age_say").text(a),userinfo.action.set_string()},set_city:function(){userinfo.data.city&&userinfo.data.city.length>3&&($(".user_city_option").text(userinfo.data.city),$(".city_suggest").val(userinfo.data.city)),userinfo.action.set_string()},set_sex:function(){var a;0==userinfo.data.sex?a="Парень или девушка":1==userinfo.data.sex?a="Парень":2==userinfo.data.sex&&(a="Девушка"),$(".user_sex_option").text(a)},set_string:function(){var a=userinfo.data.name?userinfo.data.name:"";userinfo.data.name||(1==userinfo.data.sex?a="Парень":2==userinfo.data.sex&&(a="Девушка"));var b=userinfo.data.city?userinfo.data.city.length:0;(userinfo.data.age>10||b>3)&&(a+=", "),userinfo.data.age>10&&(a=a+userinfo.data.age+" "),20-a.length-b>=0&&(a+=userinfo.data.city),a||(a="Кто вы?"),userinfo.data.uid?($(".user_string_option").text(a),storage.save("user_string_print",a)):$(".user_string_option").text("")},set_email:function(){$(".option_email_value").val(userinfo.data.email),$(".profile_email_value").text(userinfo.data.email)}}};